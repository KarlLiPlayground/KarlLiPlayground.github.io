var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r["throw"](t))}catch(e){s(e)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,a)}l((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,s&&(o=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(r){i=[6,r],s=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},CarEntity=function(){function t(){this.is_destroyed=!1}return t.prototype.car_init=function(){this.s=new CarStatus,this.view=this._create_view(),this.view.bind_ee(this),this.view.visible=!1},t.prototype._update_fr=function(){},t.prototype.frame_update=function(){this._update_fr(),this._syn_pos()},t.prototype._syn_pos=function(){this.is_destroyed||(this.view.x=this.s.pos.x,this.view.y=this.s.pos.y)},t.prototype.destroy=function(){this.is_destroyed=!0,this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.s=null},t}();__reflect(CarEntity.prototype,"CarEntity");var CarDisplay=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._create_bg_display=function(t,e){var i=new eui.Rect;this.addChild(i),i.fillColor=16777215*Math.random(),i.width=t,i.height=e,i.x=-Math.round(.5*t),i.y=-Math.round(.5*e),this.bgrect=i},e.prototype.bind_ee=function(t){var e=t.s.size.width,i=t.s.size.height;this._create_bg_display(e,i),this.lbl=new eui.Label,this.addChild(this.lbl),this.lbl.width=e,this.lbl.height=i,this.lbl.x=-Math.round(.5*e),this.lbl.y=-Math.round(.5*i),this.lbl.textAlign="center",this.lbl.verticalAlign="middle",this.lbl.text=t.s.health+""},e.prototype.update_health=function(t){this.lbl.text=t+""},e}(eui.Group);__reflect(CarDisplay.prototype,"CarDisplay");var game_config;!function(t){function e(){t.min_x=t.player_hw+t.gap_horizontal,t.max_x=t.sw-t.player_hw-t.gap_horizontal,t.min_y=t.player_hh+t.gap_vertical,t.max_y=t.sh-t.player_hh-t.gap_vertical,t.dead_line=t.sh+t.player_h}t.sw=640,t.sh=1136,t.player_w=50,t.player_h=100,t.player_hw=25,t.player_hh=50,t.gap_horizontal=10,t.gap_vertical=10,t.min_x=0,t.max_x=0,t.min_y=0,t.max_y=0,t.dead_line=0,t.config_init=e}(game_config||(game_config={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var l=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(l,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var CarStatus=function(){function t(){this.sinit()}return t.prototype.sinit=function(){this.size=new ns_sirius.Size(70,140),this.rec=new egret.Rectangle,this.rec.width=this.size.width,this.rec.height=this.size.height,this.pos=new egret.Point,this.pos.y=-140,this.health=Math.round(200*Math.random()+100)},t.prototype.cal_rect=function(){this.rec.x=this.pos.x-.5*this.size.width,this.rec.y=this.pos.y-.5*this.size.height},t}();__reflect(CarStatus.prototype,"CarStatus");var EnemyCar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._create_view=function(){return gp_core.view.create_enemy()},e.prototype.show=function(){this.s.pos.x=ns_sirius.random_region(game_config.min_x,game_config.max_x),this.view.visible=!0},e.prototype._update_fr=function(){this.s.pos.y+=3,this.s.cal_rect(),this.s.pos.y>game_config.dead_line&&gp_core.destroy_enemy(this)},e.prototype.receive_dmg=function(t){this.s.health-=t,this.view.update_health(this.s.health),this.s.health<=0&&gp_core.destroy_enemy(this)},e}(CarEntity);__reflect(EnemyCar.prototype,"EnemyCar");var PlayerCar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.car_init=function(){t.prototype.car_init.call(this),this._emit_pos=new egret.Point,this._emitter=new BulletEmitter,this._emitter.emitter_init(this)},e.prototype._create_view=function(){return gp_core.view.create_player()},e.prototype.show=function(){this._syn_player_pos(),this.view.visible=!0},e.prototype.frame_update=function(){this._syn_player_pos();var t=this._judge_contract();return t?void app_main.game_over():void this._emitter.frame_update()},e.prototype._syn_player_pos=function(){var t=gp_core.ih.player_pos;this.s.pos.copyFrom(t),this.s.cal_rect(),this._syn_pos(),this._emit_pos.x=t.x,this._emit_pos.y=t.y-game_config.player_hh},e.prototype._judge_contract=function(){if(this.is_destroyed)return null;for(var t=gp_core.enemies,e=0;e<t.length;e++){var i=t[e],r=i.s.rec;if(this.s.rec.intersects(r))return i}return null},e}(CarEntity);__reflect(PlayerCar.prototype,"PlayerCar");var BulletEntity=function(){function t(){this.is_destroyed=!1}return t.prototype.bullet_init=function(t,e,i){this.car=e,this.e=i,this.s=new BulletStatus,this.s.pos.x=this.car._emit_pos.x,this.s.pos.y=this.car._emit_pos.y-this.s.size.height,this.view=t,this.view.bind_ee(this),this._syn_pos()},t.prototype.destroy=function(){this.is_destroyed=!0,this.view.parent&&this.view.parent.removeChild(this.view),this.car=null,this.view=null,this.s=null,this.e=null},t.prototype.frame_update=function(){this.s.pos.y-=15,this.s.cal_rect();var t=this._judge_contract();return t?(t.receive_dmg(12),void this.e.destroy_bullet(this)):this.s.pos.y<0?void this.e.destroy_bullet(this):void this._syn_pos()},t.prototype._syn_pos=function(){this.is_destroyed||(this.view.x=this.s.pos.x,this.view.y=this.s.pos.y)},t.prototype._judge_contract=function(){if(this.is_destroyed)return null;for(var t=gp_core.enemies,e=0;e<t.length;e++){var i=t[e],r=i.s.rec;if(this.s.rec.intersects(r))return i}return null},t}();__reflect(BulletEntity.prototype,"BulletEntity");var BulletStatus=function(){function t(){this.pos=new egret.Point,this.size=new ns_sirius.Size(5,10),this.rec=new egret.Rectangle,this.rec.width=this.size.width,this.rec.height=this.size.height}return t.prototype.cal_rect=function(){this.rec.x=this.pos.x-.5*this.size.width,this.rec.y=this.pos.y-.5*this.size.height},t}();__reflect(BulletStatus.prototype,"BulletStatus");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GamePlayCore=function(){function t(){this._frame_cursor=0}return t.prototype.core_init=function(t,e,i){this.view=t,this.sw=e,this.sh=i,this.ih=new InputHandler,this.ih.session_start(t,e,i),this.player=new PlayerCar,this.player.car_init(),this.player.show(),this.enemies=new Array},t.prototype.game_start=function(){egret.Ticker.getInstance().register(function(t){dragonBones.WorldClock.clock.advanceTime(t/1e3),ns_sirius.world_clock.update(t)},this),ns_sirius.world_clock.add(this)},t.prototype.update=function(t){this._frame_cursor++,this._frame_cursor%80===0&&this._born_enemy();for(var e=0;e<this.enemies.length;e++){var i=this.enemies[e];i.is_destroyed?console.error("is_destroyed"):this.enemies[e].frame_update()}this.player.frame_update()},t.prototype._born_enemy=function(){var t=new EnemyCar;t.car_init(),t.show(),this.enemies.push(t)},t.prototype.destroy_enemy=function(t){t.destroy();var e=this.enemies.indexOf(t);0>e||this.enemies.splice(e,1)},t}();__reflect(GamePlayCore.prototype,"GamePlayCore",["ns_sirius.IAnimatable"]);var BulletEmitter=function(){function t(){this._born_cursor=0}return t.prototype.emitter_init=function(t){this.car=t,this.bullets=new Array},t.prototype.frame_update=function(){this._born_cursor++,this._born_cursor>4&&(this._born_cursor=0,this._born_bullet());for(var t=0;t<this.bullets.length;t++){var e=this.bullets[t];e.is_destroyed||e.frame_update()}},t.prototype._born_bullet=function(){var t=new BulletEntity,e=gp_core.view.create_bullet();t.bullet_init(e,this.car,this),this.bullets.push(t)},t.prototype.destroy_bullet=function(t){t.destroy();var e=this.bullets.indexOf(t);0>e||this.bullets.splice(e,1)},t}();__reflect(BulletEmitter.prototype,"BulletEmitter");var InputHandler=function(){function t(){this._start_player=new egret.Point,this._start_mouse=new egret.Point}return t.prototype.session_start=function(t,e,i){this.cw=e,this.ch=i,this.player_pos=new egret.Point(.5*e,.9*i),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._handle_touch_down,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._handle_touch_move,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this._handle_touch_up,this)},t.prototype._handle_touch_down=function(t){this._start_mouse.x=t.stageX,this._start_mouse.y=t.stageY,this._start_player.copyFrom(this.player_pos)},t.prototype._handle_touch_move=function(t){var e=t.stageX-this._start_mouse.x,i=t.stageY-this._start_mouse.y,r=this._start_player.x+1.5*e,n=this._start_player.y+1.5*i;r<game_config.min_x&&(r=game_config.min_x),n<game_config.min_y&&(n=game_config.min_y),r>game_config.max_x&&(r=game_config.max_x),n>game_config.max_y&&(n=game_config.max_y),this.player_pos.x=r,this.player_pos.y=n},t.prototype._handle_touch_up=function(t){},t}();__reflect(InputHandler.prototype,"InputHandler");var BulletDisplay=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._create_bg_display=function(t,e){var i=new eui.Rect;this.addChild(i),i.fillColor=0,i.width=t,i.height=e,i.x=-Math.round(.5*t),i.y=-Math.round(.5*e),this.bgrect=i},e.prototype.bind_ee=function(t){var e=t.s.size.width,i=t.s.size.height;this._create_bg_display(e,i)},e}(egret.DisplayObjectContainer);__reflect(BulletDisplay.prototype,"BulletDisplay");var gp_core,app_main,Main=function(t){function e(){var e=t.call(this)||this;return app_main=e,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),this.startAnimation(t),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){game_config.config_init();var t=new eui.Rect;this.addChild(t),t.fillColor=3704527,t.width=game_config.sw,t.height=game_config.sh;var e=new Playground;this.addChild(e),e.width=game_config.sw,e.height=game_config.sh,gp_core=new GamePlayCore,gp_core.core_init(e,game_config.sw,game_config.sh),setTimeout(function(){gp_core.game_start()},500)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,r=t.map(function(t){return i.parse(t)}),n=this.textfield,s=-1,o=function(){s++,s>=r.length&&(s=0);var t=r[s];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,e)};o()},e.prototype.onButtonClick=function(t){},e.prototype.game_over=function(){ns_sirius.world_clock.time_scale=0;var t=new eui.Panel;t.title="GameOver",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var PlayerDisplay=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.bind_ee=function(t){this._create_bg_display(game_config.player_w,game_config.player_h),this.bgrect.fillColor=458496},e}(CarDisplay);__reflect(PlayerDisplay.prototype,"PlayerDisplay");var Playground=function(t){function e(){var e=t.call(this)||this,i=new eui.Rect;return e.addChild(i),i.percentWidth=100,i.percentHeight=100,i.fillAlpha=0,i.fillColor=0,e._bullets_container=new eui.Group,e.addChild(e._bullets_container),e._bullets_container.percentWidth=100,e._bullets_container.percentHeight=100,e}return __extends(e,t),e.prototype.create_player=function(){var t=new PlayerDisplay;return this.addChild(t),t},e.prototype.create_enemy=function(){var t=new CarDisplay;return this.addChild(t),t},e.prototype.create_bullet=function(){var t=new BulletDisplay;return this.addChild(t),t},e}(eui.Group);__reflect(Playground.prototype,"Playground");var math_lib;!function(t){function e(t,e){return t.containsRect(e)}t.aabb=e}(math_lib||(math_lib={}));var ns_sirius;!function(t){function e(t,e){for(var i=Object.keys(t),r=i.length,n=0;r>n;n++){var s=i[n],o=t[s],a=e(o);if(a===!0)break}}function i(t,e){for(var i=Object.keys(t),r=i.length,n=0;r>n;n++){var s=i[n],o=t[s],a=e(s,o);if(a===!0)break}}function r(t,e){var i=t.indexOf(e);0>i||t.splice(i,1)}function n(t,e){var i=Math.floor(Math.random()*(e-t))+t;return i}t.loop_values=e,t.loop_pps=i,t.arr_robj=r,t.random_region=n}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(){this._animatebles=new Array,this._timeScale=1}return t.frame_to_ms=function(t){return Math.round(1e3*t/60)},Object.defineProperty(t.prototype,"time_scale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(1!==this._timeScale&&(t*=this._timeScale),0!=t&&!(0>t)){for(var e=0,i=0,r=this._animatebles.length;r>e;++e){var n=this._animatebles[e];null!==n?(i>0&&(this._animatebles[e-i]=n,this._animatebles[e]=null),n.update(t)):i++}if(i>0){for(r=this._animatebles.length;r>e;++e){var s=this._animatebles[e];null!==s?this._animatebles[e-i]=s:i++}this._animatebles.length-=i}}},t.prototype.add=function(t){t&&this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.removeAt=function(t){t>=0&&(this._animatebles[t].clock=null,this._animatebles[t]=null)},t}();t.anim_clock=e,__reflect(e.prototype,"ns_sirius.anim_clock"),t.world_clock=new e}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e}return t}();t.Size=e,__reflect(e.prototype,"ns_sirius.Size")}(ns_sirius||(ns_sirius={}));