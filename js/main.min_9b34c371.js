var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(_,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function n(t){try{a(o["throw"](t))}catch(e){r(e)}}function a(t){t.done?_(t.value):new i(function(e){e(t.value)}).then(s,n)}a((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(_)throw new TypeError("Generator is already executing.");for(;a;)try{if(_=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(o){i=[6,o],r=0}finally{_=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var _,r,s,n,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},ns_sirius;!function(t){var e=function(){function t(){this._is_destroyed=!1}return t.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},t.prototype._before_destroy=function(){},t}();t.sirius_base_object=e,__reflect(e.prototype,"ns_sirius.sirius_base_object",["ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e.mark_as_fullfill(),console.log("[ "+e.constructor.name+" ] ALLOC"),e}return __extends(e,t),e.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent(),this.init_param=null,this.pair_vm=null},e.prototype.view_pre_init=function(t,e,i){this.init_param=t,this.pair_vm=e,this._sirius=i.sirius_public,this._view_before_init()},e.prototype.view_init=function(){this._view_start_init()},e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e.prototype.remove_all_children=function(){this.removeChildren()},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.update_visible=function(t){this.visible=t},e.prototype.mark_as_fullfill=function(){this.percentWidth=100,this.percentHeight=100,this.x=0,this.y=0},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e}(eui.Component);t.sirius_module_view=e,__reflect(e.prototype,"ns_sirius.sirius_module_view",["ns_sirius.Isirius_view_base","ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return console.log("[ "+e.constructor.name+" ] ALLOC"),e.pair_view=null,e.init_param=null,e}return __extends(e,t),e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._vm_before_destroy(),this.init_param=null,this.pair_view=null},e.prototype.vm_pre_init=function(t,e,i){this.init_param=t,this.pair_view=e,this._sirius=i.sirius_public,this._vm_before_init()},e.prototype.vm_init=function(){this._vm_start_init()},e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(t.sirius_base_object);t.module_vm_base=e,__reflect(e.prototype,"ns_sirius.module_vm_base")}(ns_sirius||(ns_sirius={}));var AppModuleViewBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(ns_sirius.sirius_module_view);__reflect(AppModuleViewBase.prototype,"AppModuleViewBase");var AppModuleVMBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(ns_sirius.module_vm_base);__reflect(AppModuleVMBase.prototype,"AppModuleVMBase");var PopupVMBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(AppModuleVMBase);__reflect(PopupVMBase.prototype,"PopupVMBase");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._machine=null,e}return __extends(e,t),e.prototype._before_destroy=function(){this._machine=null},e.prototype.state_init=function(t,e){this._machine=t,this._convert_context(e),this._behaviors_init(),this._after_state_init()},e.prototype._convert_context=function(t){},e.prototype._behaviors_init=function(){},e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return""},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype.state_update=function(){},e}(t.sirius_base_object);t.GP_StateBase=e,__reflect(e.prototype,"ns_sirius.GP_StateBase")}(ns_sirius||(ns_sirius={}));var PopupViewBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.set_bg_color(0,.4),this._create_module_background()},e.prototype.static_title_name=function(){return"Base"},e.prototype._create_module_background=function(){var t=this,e=540*COMMON_consts.scaleW,i=723*COMMON_consts.scaleW,o=38*COMMON_consts.scaleW,_=500*COMMON_consts.scaleW,r=655*COMMON_consts.scaleW,s=new eui.Group;s.width=e,s.height=i,s.top=.21*sirius.device_info.safe_height,s.horizontalCenter=0;var n=new game.BaseLabel;n.width=e,n.height=o,n.textAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.size=38,n.textColor=1513239,n.text=this.static_title_name(),this.containGroup=new eui.Group,this.containGroup.width=_,this.containGroup.height=r,this.containGroup.top=o,this.containGroup.horizontalCenter=0;var a=new eui.Image;a.width=e,a.height=.43*i,a.source="battleSettlement_panel_02";var l=new eui.Image;l.width=e,l.height=.25*i,l.bottom=.33*i,l.source="battleSettlement_panel_02";var c=new eui.Image;c.width=e,c.height=.34*i,c.bottom=0,c.source="battleSettlement_panel_03";var u=new eui.Image;u.width=50*COMMON_consts.scaleW,u.height=47*COMMON_consts.scaleW,u.right=0,u.top=-20,u.source="common_button_close",u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click close"),t.destroy()},this),s.addChildAt(n,1),s.addChildAt(a,0),s.addChildAt(l,0),s.addChildAt(c,0),s.addChildAt(u,4),s.addChildAt(this.containGroup,3),this.addChildAt(s,1)},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e}(AppModuleViewBase);__reflect(PopupViewBase.prototype,"PopupViewBase");var GamePlayEntityBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++)t[i]&&t[i].destroy()},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(ns_sirius.sirius_base_object);__reflect(GamePlayEntityBase.prototype,"GamePlayEntityBase");var GC_Ele_BaseView=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];o.destroy()}},e.prototype.destroy=function(){this._before_destroy(),this.parent&&this.parent.removeChild(this),this._is_destroyed=!0},e.prototype._before_destroy=function(){},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Group);__reflect(GC_Ele_BaseView.prototype,"GC_Ele_BaseView");var TableViewBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this._create_table()},e.prototype.stactic_table_name=function(){var t=[];return t.push("One"),t.push("Two"),t.push("Three"),t.push("Four"),t},e.prototype._create_table=function(){var t=[];t=this.stactic_table_name();var e=t.length,i=this.containGroup.width,o=new eui.Group;o.width=i,o.height=50*COMMON_consts.scaleW;var _=i/e,r=o.height;for(var s in t)o.addChild(this._create_title_name(_,r,t[s],parseInt(s)*_,s));this.containGroup.addChild(o),this.tabContainGroup=new eui.Group,this.tabContainGroup.width=this.containGroup.width,this.tabContainGroup.height=this.containGroup.height-o.height,this.tabContainGroup.top=o.height,this.containGroup.addChild(this.tabContainGroup);var n=new game.BaseLabel;n.width=this.tabContainGroup.width,n.height=this.tabContainGroup.height,n.background=!0,n.backgroundColor=16777215,console.log("====width"+this.tabContainGroup.width),console.log("====height"+this.tabContainGroup.height),this.tabContainGroup.addChild(n)},e.prototype.touchClick=function(t){},e.prototype._create_title_name=function(t,e,i,o,_){var r=this,s=new game.BaseLabel;return s.width=t,s.height=e,s.left=o,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.size=28,s.text=i,s.background=!0,s.backgroundColor=1513239,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.touchClick(_)},this),s},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e}(PopupViewBase);__reflect(TableViewBase.prototype,"TableViewBase");var TableVMBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(PopupVMBase);__reflect(TableVMBase.prototype,"TableVMBase");var GC_SkillBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._clear_outputs(),this._process_outputs=null,this._destroy_arr(this._processes),this._processes=null},e.prototype.skill_init=function(t,e){this._runnable=!1,this._process_outputs=Object.create(null);var i=e.processes.length;if(0!=i){this._processes=new Array;for(var o=0;i>o;o++){var _=e.processes[o],r=GC_ProcessBase.new_process(_);r&&(r.process_init(t,_),this._processes.push(r))}this._process_count=this._processes.length,0!=this._process_count&&(this._runnable=!0)}},e.prototype._clear_outputs=function(){for(var t=0;t<this._process_count;t++)this._process_outputs[t]=null},e}(GamePlayEntityBase);__reflect(GC_SkillBase.prototype,"GC_SkillBase");var CharacterStateBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._character=t},e.prototype.state_update=function(){this._syn_character_pos()},e.prototype._syn_character_pos=function(){this._syn_pos_with_room()},e.prototype._syn_pos_with_room=function(){var t=this._character.current_room();t.layout_info.get_slot_3dpos_by_slot(this._character.get_slot_pos(),this._character._buffer_new_pos_3d),this._character._sm_modify_pos(this._character._buffer_new_pos_3d,t.layout_info.d3_scale)},e}(ns_sirius.GP_StateBase);__reflect(CharacterStateBase.prototype,"CharacterStateBase");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._s_default=new t.GP_State_Default,i._current_state=new t.GP_State_Default,i._listener=null,i._ctx=null,i}return __extends(i,e),i.prototype._before_destroy=function(){this._ctx=null,this._listener=null,this._current_state=null,this._s_default.destroy(),this._s_default=null},i.prototype.get_current_state=function(){return this._current_state},i.prototype.get_current_state_str=function(){return this._current_state.state_str()},i.prototype.get_current_state_enum=function(){return this._current_state.state_enum()},i.prototype.machine_initialize=function(t,e,i){void 0===i&&(i=null),this._listener=t,this._ctx=e,this._s_default.state_init(this,e),this._states_init(e)},i.prototype._states_init=function(t){},i.prototype.get_state_by_enum=function(t){return null},i.prototype.state_change=function(t,e){void 0===e&&(e=null);var i=this.get_state_by_enum(t);i||console.log("invalid game machine enum "+t);var o=this._current_state;this._current_state=i,this._listener.sm_state_changed(o,i,e),o.state_leave(i,e),i.state_enter(o,e)},i.prototype.machine_update=function(){this._current_state.state_update()},i}(t.sirius_base_object);t.GP_StateMachine=e,__reflect(e.prototype,"ns_sirius.GP_StateMachine")}(ns_sirius||(ns_sirius={}));var GameActor=function(t){function e(){var i=t.call(this)||this;return i.actor_uid=0,i._is_dead=!1,e._actor_counter++,i.actor_uid=e._actor_counter,i}return __extends(e,t),e.prototype.is_dead=function(){return this._is_dead},e.prototype.sentence_to_death=function(){this._is_dead=!0},e.prototype.frame_update=function(){},e._actor_counter=0,e}(GamePlayEntityBase);__reflect(GameActor.prototype,"GameActor");var GC_ProcessBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._binded_character=null},e.prototype.process_init=function(t,e){this._binded_character=t,this._init(e)},e.new_process=function(t){var e=t.type,i=null;switch(e){case GC_Process_Metadata.GC_ProcessType.dmg:i=new GC_LP_dmg;break;case GC_Process_Metadata.GC_ProcessType.ik:break;case GC_Process_Metadata.GC_ProcessType.heal:break;case GC_Process_Metadata.GC_ProcessType.character_modify:break;case GC_Process_Metadata.GC_ProcessType.se_modify:break;case GC_Process_Metadata.GC_ProcessType.se_add:break;case GC_Process_Metadata.GC_ProcessType.se_remove:break;case GC_Process_Metadata.GC_ProcessType.cd_modify:break;case GC_Process_Metadata.GC_ProcessType.cd_terminate:break;case GC_Process_Metadata.GC_ProcessType.selector:i=new GC_Process_Selector;break;case GC_Process_Metadata.GC_ProcessType.conditional:i=new GC_Process_Conditional;break;case GC_Process_Metadata.GC_ProcessType.probability:i=new GC_Process_Probability}return i},e}(GamePlayEntityBase);__reflect(GC_ProcessBase.prototype,"GC_ProcessBase");var Character_State_Battle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_behavior_battle=function(){return this._behavior_battle},e.prototype._before_destroy=function(){this._behavior_battle.destroy(),this._behavior_battle=null,t.prototype._before_destroy.call(this)},e.prototype._behaviors_init=function(){this._behavior_battle=new BattleBehavior(this._character,this)},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._behavior_battle.behavior_active()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null),this._behavior_battle.behavior_deactive()},e}(CharacterStateBase);__reflect(Character_State_Battle.prototype,"Character_State_Battle");var RoomTypeEnum=function(){function t(){}return t.UNINITED=-1,t.EMPTY=0,t.ARENA=1,t.FACILITY=2,t.BOSS=999,t}();__reflect(RoomTypeEnum.prototype,"RoomTypeEnum");var FacilityTypeEnum=function(){function t(){}return t.UNINITED=-1,t}();__reflect(FacilityTypeEnum.prototype,"FacilityTypeEnum");var RoomEntity=function(t){function e(){var e=t.call(this)||this;return e._has_init=!1,e._room_type=RoomTypeEnum.UNINITED,e._facility_type=FacilityTypeEnum.UNINITED,e}return __extends(e,t),e.prototype._before_destroy=function(){this.layout_info.destroy(),this.layout_info=null,this.link&&(this.link.destroy(),this.link=null)},e.prototype.room_layout_init=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.layout_init(t,e)},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.link_init(t,this.layout_info.room_pos.row_index,this.layout_info.room_pos.column_index)},e.prototype.room_type_init=function(t,e){this._room_type=t,this._facility_type=e,this._has_init=!0},e.prototype.is_boss_room=function(){return!1},e.prototype.is_born_room=function(){return!1},e.prototype._link_asymmetrical=function(t,e){t.active_battle_behavior(e)},e.prototype._unlink=function(t){t.deactive_battle_behavior()},e.prototype._init_arr_by_null=function(t,e){for(var i=0;e>i;i++)t[i]=null},e.SlotsMax=3,e}(GamePlayEntityBase);__reflect(RoomEntity.prototype,"RoomEntity");var RoomLayoutInfo=function(t){function e(){var e=t.call(this)||this;return e.view_pos=new egret.Point,e.center_pos=new egret.Point,e.d3_point_local=new egret.Point,e.d3_scale=new egret.Point,e}return __extends(e,t),e.prototype._before_destroy=function(){this.room_pos=null,this._slots_def_2d=null,this._slots_assault_2d=null,this._slots_def_3d=null,this._slots_assault_3d=null},e.prototype.layout_init=function(t,e){var i=gp_core.layout_config,o=gp_core.layout_config.rowcolumn_to_uindex(e,t);this.room_pos=new MapRoomPosition(o,t,e),this.view_pos.x=i.room_orig_x+Math.round(t*(i.column_gap+i.cell_w)),this.view_pos.y=i.room_orig_y+Math.round(e*(i.row_gap+i.cell_h)),this.center_pos.x=this.view_pos.x+Math.round(.5*i.cell_w),this.center_pos.y=this.view_pos.y+Math.round(.5*i.cell_h),this.view_w=i.cell_w,this.view_h=i.cell_h,this._def_slots_init(),this._assualt_slots_init()},e.prototype._slot_orig_x=function(){return this.view_pos.x},e.prototype._slot_inner_gap=function(){return 40},e.prototype._def_slots_init=function(){var t=RoomEntity.SlotsMax,e=gp_core.layout_config;this._slots_def_2d=Array(t),this._slots_def_3d=Array(t);for(var i=this._slot_orig_x(),o=0;t>o;o++)this._slots_def_2d[o]=new egret.Point(i+this._slot_inner_gap(),0),this._slots_def_3d[o]=new egret.Point(0,0);var _=e.cell_h,r=Math.floor(e.cell_h/3);this._slots_def_2d[0].y=this.view_pos.y+_-2*r,this._slots_def_2d[1].y=this.view_pos.y+_-r,this._slots_def_2d[2].y=this.view_pos.y+_},e.prototype._assualt_slots_init=function(){var t=RoomEntity.SlotsMax,e=gp_core.layout_config;this._slots_assault_2d=Array(t),this._slots_assault_3d=Array(t);for(var i=this._slot_orig_x(),o=0;t>o;o++)this._slots_assault_2d[o]=new egret.Point(i+e.cell_w-this._slot_inner_gap(),0),this._slots_assault_3d[o]=new egret.Point(0,0);var _=e.cell_h,r=Math.floor(e.cell_h/3);this._slots_assault_2d[0].y=this.view_pos.y+_-2*r,this._slots_assault_2d[1].y=this.view_pos.y+_-r,this._slots_assault_2d[2].y=this.view_pos.y+_},e.prototype.born_layout_init=function(){var t=gp_core.layout_config;this.room_pos=new MapRoomPosition(GameMap.born_room_id),this.view_pos.x=t.pawn_born_x-.5*t.pawn_born_width,this.view_pos.y=t.pawn_born_y-.5*t.pawn_born_height,this.center_pos.x=t.pawn_born_x,this.center_pos.y=t.pawn_born_y,this.view_w=t.pawn_born_width,this.view_h=t.pawn_born_height},e.prototype.update_3d_layout=function(){gp_core.ppc.cal_3d_pos(this.center_pos,this.d3_point_local,this.d3_scale);var t=RoomEntity.SlotsMax;if(this._slots_def_2d)for(var e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_def_2d[e],this._slots_def_3d[e],null);if(this._slots_assault_2d)for(var e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_assault_2d[e],this._slots_assault_3d[e],null)},e.prototype.get_slot_3dpos_by_slot=function(t,e){if(!t||t.slot_index<0)return void e.copyFrom(this.d3_point_local);var i=RoomEntity.SlotsMax;return t.slot_index>i-1?void e.copyFrom(this.d3_point_local):void(t.type==GameCharacterType.Defender?e.copyFrom(this._slots_def_3d[t.slot_index]):t.type==GameCharacterType.Assaulter?e.copyFrom(this._slots_assault_3d[t.slot_index]):e.copyFrom(this.d3_point_local))},e.prototype.get_slot_2dpos_by_index=function(t,e){if(!t||t.slot_index<0)return e.x=this.center_pos.x,void(e.y=this.center_pos.y);var i=RoomEntity.SlotsMax;return t.slot_index>i-1?(e.x=this.center_pos.x,void(e.y=this.center_pos.y)):void(t.type==GameCharacterType.Defender?(e.x=this._slots_def_2d[t.slot_index].x,e.y=this._slots_def_2d[t.slot_index].y):t.type==GameCharacterType.Assaulter?(e.x=this._slots_assault_2d[t.slot_index].x,e.y=this._slots_assault_2d[t.slot_index].y):(e.x=this.center_pos.x,e.y=this.center_pos.y))},e}(GamePlayEntityBase);__reflect(RoomLayoutInfo.prototype,"RoomLayoutInfo");var TestModuleView=function(t){function e(){var e=t.call(this)||this;return e.textField=new egret.TextField,e.addChild(e.textField),e.textField.size=32,e.textField.textAlign="left",e.textField.verticalAlign="top",e.textField.x=50,e.textField.y=100,e.textField.width=400,e.textField.textColor=16777215,e.textField.text=appm.lm.s("global","confirm"),e.textField.background=!0,e.textField.backgroundColor=23223,e.titleField=new egret.TextField,e.addChild(e.titleField),e.titleField.size=22,e.titleField.textAlign="center",e.titleField.verticalAlign="top",e.titleField.x=50,e.titleField.width=400,e.titleField.y=10,e.titleField.height=80,e.titleField.textColor=16777215,e.titleField.text="这是测试模块",setTimeout(function(){e._is_destroyed||e._sirius.debug_foo()},1e3),e}return __extends(e,t),e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(AppModuleViewBase);__reflect(TestModuleView.prototype,"TestModuleView");var GC_dependentSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._cd_counter&&(this._cd_counter.destroy(),this._cd_counter=null),this._SEL_execute=null,t.prototype._before_destroy.call(this)},e.prototype.skill_init=function(e,i){t.prototype.skill_init.call(this,e,i),i.cd>0?(this._cd_counter=new DependentSkillCD,this._cd_counter.init(i.cd),this._SEL_execute=this._execute_cd):this._SEL_execute=this._execute_no_cd},e.prototype.skill_release=function(){this._SEL_execute()},e.prototype._execute_cd=function(){if(this._runnable){var t=this._cd_counter.act();t&&this._skill_execute()}},e.prototype._execute_no_cd=function(){this._runnable&&this._skill_execute()},e.prototype._skill_execute=function(){this._clear_outputs();for(var t=0;t<this._process_count;t++)this._process_outputs[t]=this._processes[t].execute()},e}(GC_SkillBase);__reflect(GC_dependentSkill.prototype,"GC_dependentSkill");var GameWinVM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(AppModuleVMBase);__reflect(GameWinVM.prototype,"GameWinVM");var Tab1View=function(t){function e(e){var i=t.call(this)||this;return i.skinName="resource/YXY/game_skins/tabViewSkin.exml",console.log("name"+e),i}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.additem()},e.prototype.additem=function(){var t=this;this.mapDatas=new eui.ArrayCollection;for(var e=["battleSettlement_expStick_01","battleSettlement_expStick_02","battleSettlement_expStick_03","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04","battleSettlement_expStick_04"],i=["battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01","battleSettlement_expStick_01"],o=0;o<e.length;o++)this.mapDatas.addItem(e[o]);this.mapList.itemRenderer=FightMapItemRenderer,this.mapList.itemRendererSkinName="resource/YXY/game_skins/test_item.exml",this.mapList.dataProvider=this.mapDatas,this.mapList.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){console.log("======"+e.item),console.log("======"+e.itemRenderer),console.log("======"+e.itemIndex),t.mapDatas.replaceAll(i)},this)},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e}(AppModuleViewBase);__reflect(Tab1View.prototype,"Tab1View");var FightMapItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this.bgAsset.source=this.data),console.log("=======data "+this.data)},e}(eui.ItemRenderer);__reflect(FightMapItemRenderer.prototype,"FightMapItemRenderer");var GC_RoomView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_Ele_BaseView);__reflect(GC_RoomView.prototype,"GC_RoomView");var GameCoreResManager=function(){function t(){var t=this._config_file_name(),e=RES.getRes(t).characters;if(!e||0==e.length)return sirius.view_manager.show_popup_text_msg("必须在【"+t+"】文件中配置角色信息"),void console.log("必须在【"+t+"】文件中配置角色信息");this._resources=new Array;var i=(this._resources,e.length);this.res_count=i;for(var o=0;i>o;o++){var _=e[o],r=new AnimRes(o,_.file_key,_.armature_name,_.character_name);this._resources.push(r)}}return t.prototype.get_res_by_index=function(t){return this._resources?t>this._resources.length-1?null:this._resources[t]:null},t.prototype._config_file_name=function(){return"character_config_json"},t.prototype._res_prefix=function(){return"resource/LK/game_core/characters"},t.prototype.load_res=function(t){if(!this._resources||0==this._resources.length)return void t();this._callback=t,this._load_count=this._resources.length;for(var e=0,i=this._resources;e<i.length;e++){var o=i[e];this._load_ske_res(o)}},t.prototype._load_ske_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_ske.json";RES.getResByUrl(i,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_tex.json";RES.getResByUrl(i,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_tex.png";RES.getResByUrl(i,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&(this._callback(),this._callback=null)},t.prototype.remove_all_data=function(){var t=dragonBones.EgretFactory.factory;t.clear()},t}();__reflect(GameCoreResManager.prototype,"GameCoreResManager");var Tab1VM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(AppModuleVMBase);__reflect(Tab1VM.prototype,"Tab1VM");var TestABCView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.touchClick(0)},e.prototype.stactic_table_name=function(){var t=[];return t.push("tab1"),t.push("tab2"),t.push("tab3"),t},e.prototype.touchClick=function(t){if(t!=this.selectID){if(this.tabContainGroup.removeChildren(),0==t)this.tabContent=new Tab1View("123"),sirius.view_manager.show_sub_module_init(this.tabContent,new Tab1VM,this.tabContainGroup);else if(1==t){var e=new game.BaseLabel;e.text="tab2",e.width=199,e.height=60,e.background=!0,e.backgroundColor=10066329,this.tabContainGroup.addChild(e)}else if(2==t){var e=new game.BaseLabel;e.text="tab3",e.width=199,e.height=60,e.background=!0,e.backgroundColor=10066329,this.tabContainGroup.addChild(e)}this.selectID=t}},e.prototype.onComplete=function(){console.log("onComplete")},e.prototype._view_before_init=function(){},e.prototype.static_title_name=function(){return"Title Name"},e.prototype._view_start_init=function(){},e.prototype._view_before_destroy=function(){null!=this.tabContent&&this.tabContent.destroy()},e}(TableViewBase);__reflect(TestABCView.prototype,"TestABCView");var TestABCVM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(TableVMBase);__reflect(TestABCVM.prototype,"TestABCVM");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.ProgressBar);t.CommonProcessBar=e,__reflect(e.prototype,"game.CommonProcessBar")}(game||(game={}));var MWN_State_Base=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._gpcore=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._gpcore=t},e}(ns_sirius.GP_StateBase);__reflect(MWN_State_Base.prototype,"MWN_State_Base");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},e.prototype._before_destroy=function(){console.log("======= sirius_view_base  destroy ======= "),console.log(this.constructor.name+" destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent()},e.prototype.attached_to_display_tree=function(t){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e.prototype.remove_all_children=function(){this.removeChildren()},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.update_visible=function(t){this.visible=t},e.prototype.mark_as_fullfill=function(){this.percentWidth=100,this.percentHeight=100,this.x=0,this.y=0},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e}(eui.Group);t.sirius_view_base=e,__reflect(e.prototype,"ns_sirius.sirius_view_base",["ns_sirius.Isirius_view_base","ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var TestModuleVM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(AppModuleVMBase);__reflect(TestModuleVM.prototype,"TestModuleVM");var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.core_init=function(t){this._sirius=t},e}(t.sirius_base_object);t.sirius_element_module=e,__reflect(e.prototype,"ns_sirius.sirius_element_module")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(t,i,o,_){void 0===t&&(t=null),void 0===i&&(i=null),void 0===o&&(o=0),void 0===_&&(_=null);var r=e.call(this)||this;return r._listener=t,r.anim_id=o,r._param=_,r._target_view=i,r}return __extends(i,e),i.prototype.init=function(t){return void 0===t&&(t=null),this.anim_active(t),this},i.prototype.anim_active=function(e){void 0===e&&(e=null),e?e.add(this):t.world_clock.add(this)},i.prototype.anim_deactive=function(){this._clock&&this._clock.remove(this)},i.prototype._before_destroy=function(){this.stop(),this._clock&&this._clock.remove(this),this._clock=null,this._listener=null,this._param=null,this._target_view=null
},Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock=t},enumerable:!0,configurable:!0}),i.prototype.is_disposable=function(){return!1},Object.defineProperty(i.prototype,"is_animating",{get:function(){return this._is_animating},enumerable:!0,configurable:!0}),i.prototype.start=function(){this._normalized_time=0,this._real_time=0,this._anim_duration=this.animation_duration(),this._is_animating=!0,this._reset_anim_properties()},i.prototype.stop=function(){this._is_animating=!1,this._normalized_time=0,this._real_time=0,this._reset_anim_properties()},i.prototype.update=function(t){this._is_animating&&(this._real_time+=t,this._normalized_time=this._real_time/this._anim_duration,this._normalized_time>1?this._anim_update(1):this._anim_update(this._normalized_time),this._normalized_time<1||(this.stop(),this._listener&&this._listener.single_anim_comp(this),this.is_disposable()&&this.destroy()))},i.prototype._anim_update=function(t){},i}(t.sirius_base_object);t.single_animation=e,__reflect(e.prototype,"ns_sirius.single_animation",["ns_sirius.IAnimatable"])}(ns_sirius||(ns_sirius={}));var GameCharacterType=function(){function t(){}return t.Default=0,t.Defender=1,t.Assaulter=2,t.Boss=999,t}();__reflect(GameCharacterType.prototype,"GameCharacterType");var GameCharacter=function(t){function e(){var e=t.call(this)||this;return e._buffer_new_pos_3d=new egret.Point,e._current_pos_3d=new egret.Point,e._current_scale_3d=new egret.Point,e._buffer_new_slot_pos=new MapRoomSlotPosition,e._buffer_new_slot_pos.type=GameCharacterType.Assaulter,e.md_battle=new Character_RPPS_Battle,e._room_pos=new MapRoomPosition,e._slot_pos=new MapRoomSlotPosition,e}return __extends(e,t),e.prototype._before_destroy=function(){this._binded_view&&(this._binded_view.destroy(),this._binded_view=null),this._machine&&(this._machine.destroy(),this._machine=null),this.skill_m.destroy(),this.skill_m=null,this.md_battle.destroy(),this.md_battle=null,t.prototype._before_destroy.call(this)},e.prototype.get_room_pos=function(){return this._room_pos},e.prototype.get_slot_pos=function(){return this._slot_pos},e.prototype.current_room=function(){return this._room_pos?gp_core.map.get_room_by_pos(this._room_pos):null},e.prototype.skill_hierarchy_establish=function(t){this.skill_m=new CharacterSkillManager,this.skill_m.manager_init(this,t)},e.prototype.put_on_the_map_and_run=function(t,e){this._room_pos.copyp(t),this._slot_pos.copyp(e),this._machine_init(),this._set_machine_initial_state()},e.prototype.prepare_to_die=function(){this._machine.state_change(CharacterMachineState.DYING)},e.prototype.deduct_life=function(t){if(!(0>=t)){this.md_battle.is_immortal||(this.md_battle.current_life-=t);var e=this.md_battle.current_life/this.md_battle.total_life;0>e&&(e=0),this._binded_view.update_health(e),this._binded_view.play_dmg_anim(t),this.md_battle.current_life<=0?this.prepare_to_die():this._binded_view.start_vibration_anim()}},e.prototype.get_battle_behavior=function(){return this._machine.get_battle_behavior()},e.prototype.get_facing_enemy=function(){var t=this._machine.get_battle_behavior();if(t)return t.get_target_character()},e.prototype.active_battle_behavior=function(t){var e=this._machine.get_battle_behavior();e&&e.active(t)},e.prototype.deactive_battle_behavior=function(){var t=this._machine.get_battle_behavior();t&&t.deactive()},e.prototype.target_deduct_life=function(){var t=this._machine.get_battle_behavior();t&&t.target_deduct_life()},e.prototype.sm_state_changed=function(t,e,i){e.state_enum()==CharacterMachineState.MOVING?this._binded_view.change_state(GC_CharacterAnimState.MOVING):e.state_enum()==CharacterMachineState.BATTLE_DEFENDER?this._binded_view.change_state(GC_CharacterAnimState.IDLE):e.state_enum()==CharacterMachineState.BATTLE_ASSAULTER?this._binded_view.change_state(GC_CharacterAnimState.IDLE):e.state_enum()==CharacterMachineState.DYING&&this._binded_view.change_state(GC_CharacterAnimState.DYING)},e.prototype._sm_modify_pos=function(t,e){this._current_pos_3d.x=t.x,this._current_pos_3d.y=t.y,this._current_scale_3d.x=e.x,this._current_scale_3d.y=e.y},e.prototype._sm_modify_view_orientation=function(t){this._binded_view.change_direction(t)},e.prototype.bind_view=function(t){this._binded_view=t},e.prototype.frame_update=function(){t.prototype.frame_update.call(this),this._machine_update(),this._view_update_pos(),this._view_update_frame()},e.prototype._machine_update=function(){this._machine.machine_update()},e.prototype._view_update_pos=function(){this._binded_view.x=this._current_pos_3d.x,this._binded_view.y=this._current_pos_3d.y;var t=gp_core.layout_config.character_global_scale;this._binded_view.scaleX=this._current_scale_3d.x*t,this._binded_view.scaleY=this._current_scale_3d.y*t},e.prototype._view_update_frame=function(){this._binded_view.update_frame()},e}(GameActor);__reflect(GameCharacter.prototype,"GameCharacter",["ns_sirius.IGP_StateMachineListener"]);var Character_Behavior=function(t){function e(e,i){var o=t.call(this)||this;return o._character=e,o._s=i,o}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,this._s=null,t.prototype._before_destroy.call(this)},e}(GamePlayEntityBase);__reflect(Character_Behavior.prototype,"Character_Behavior");var CharacterMachineState=function(){function t(){}return t.DEFAULT=0,t.BORN=1,t.MOVING=2,t.DYING=4,t.BATTLE_ASSAULTER=5,t.BATTLE_DEFENDER=6,t.ERROR=99,t}();__reflect(CharacterMachineState.prototype,"CharacterMachineState");var CharacterMachine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._states_init=function(t){this._s_born=new Character_State_BORN,this._s_born.state_init(this,t),this._s_dying=new Character_State_DYING,this._s_dying.state_init(this,t),this._s_error=new Character_State_ERROR,this._s_error.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case CharacterMachineState.BORN:return this._s_born;case CharacterMachineState.DYING:return this._s_dying;case CharacterMachineState.ERROR:return this._s_error;default:return this._s_default}},e.prototype._before_destroy=function(){this._s_born.destroy(),this._s_born=null,this._s_dying.destroy(),this._s_dying=null,this._s_error.destroy(),this._s_error=null,t.prototype._before_destroy.call(this)},e}(ns_sirius.GP_StateMachine);__reflect(CharacterMachine.prototype,"CharacterMachine");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._mstack=new Array,e._top=-1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype._s_is_empty=function(){return this._top<0?!0:!1},e.prototype._s_push=function(t){this._top<0&&(this._top=-1),this._top++,this._mstack[this._top]=t},e.prototype._s_pop=function(){this._s_is_empty()||(this._mstack[this._top]=null,this._top--)},e.prototype._s_shift=function(){if(!this._s_is_empty()){for(var t=0;t<this._top;t++)this._mstack[t]=this._mstack[t+1];this._top--}},e.prototype._s_clear=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++)this._mstack[t]=null;this._top=-1}},e.prototype._s_top=function(){return this._s_is_empty()?null:this._mstack[this._top]},e.prototype._s_bottom=function(){return this._s_is_empty()?null:this._mstack[0]},e.prototype.show_view=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this._root_view.addChild(t),t.attached_to_display_tree(e),this._s_push(t),this._update_container_visible(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t];e.detaching_from_display_tree(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top();t.detaching_from_display_tree(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom();t.detaching_from_display_tree(),t.destroy(),this._s_shift(),this._update_container_visible()},e.prototype.is_empty=function(){return this._s_is_empty()},e.prototype._update_container_visible=function(){this._s_is_empty()?this._root_view.update_visible(!1):this._root_view.update_visible(!0)},e}(t.sirius_base_object);t.layer_stack_manager=e,__reflect(e.prototype,"ns_sirius.layer_stack_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var GameWinView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e.skinName="resource/YXY/game_skins/win/battle_Win_Skin.exml",e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),console.log("createChildren"),this.win_group_bg_1.height=723*COMMON_consts.scaleW,this.win_group_head.height=342*COMMON_consts.scaleW,this.win_group_name.height=140*COMMON_consts.scaleW,this.win_group_center.height=500*COMMON_consts.scaleW,this.win_close.height=47*COMMON_consts.scaleW,this.win_lv.size=COMMON_consts.font_size_24,this.win_name.size=COMMON_consts.font_size_32,this.win_facility_label.text=appm.lm.s("gamewin","facility","YXY"),this.win_monster_label.text=appm.lm.s("gamewin","monster","YXY"),this.win_reward_label.text=appm.lm.s("gamewin","reward","YXY"),this.win_exp_label.text=appm.lm.s("gamewin","exp","YXY"),this.win_btn.labelDisplay.text=appm.lm.s("gamewin","jump","YXY"),this.win_processbar_facility.value=60,this.win_processbar_monster.value=50,this.EXPValue=2,this.win_processbar_exp.value=this.EXPValue,this.win_processbar_exp.label.text="80/100 (80%)";var i=new egret.Timer(500,1);i.addEventListener(egret.TimerEvent.TIMER,function(){e.win_processbar_exp.setPosition(e.win_processbar_exp.thumb.width,e.EXPValue),i.stop(),i=null},this),i.start(),this.win_icon1.common_icon_text.text="x 10",this.win_icon2.common_icon_text.text="x 2",this.win_icon3.common_icon_text.text="x 1",this.win_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.win_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(){sirius.view_manager.pop_top_module(),sirius.view_manager.show_popup_text_msg("你销毁了模块")},e.prototype.onComplete=function(){console.log("onComplete")},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e}(AppModuleViewBase);__reflect(GameWinView.prototype,"GameWinView");var GC_LogicProcess=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(GC_ProcessBase);__reflect(GC_LogicProcess.prototype,"GC_LogicProcess");var Move_Behavior=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o.can_settle_down=!1,o._anim=new Move_Behavior_Anim(o),o}return __extends(e,t),Object.defineProperty(e.prototype,"anim",{get:function(){return this._anim},enumerable:!0,configurable:!0}),e.prototype._before_destroy=function(){this._anim.destroy(),this._anim=null,t.prototype._before_destroy.call(this)},e.prototype.behavior_active=function(){this._anim.anim_active()},e.prototype.behavior_deactive=function(){this._anim.anim_deactive()},e.prototype.move=function(t,e,i,o,_,r){this.target_room=e.layout_info.room_pos,this.target_slot=o,this.can_settle_down=r;var s=this._anim;i&&i.slot_index>=0?t.layout_info.get_slot_2dpos_by_index(i,s._from_pos):s._from_pos.copyFrom(t.layout_info.center_pos),this.can_settle_down?e.layout_info.get_slot_2dpos_by_index(o,s._to_pos):s._to_pos.copyFrom(e.layout_info.center_pos);var n=s._to_pos.x-s._from_pos.x,a=(s._to_pos.y-s._from_pos.y)*GPC_layout_config.distance_ratio_w_to_h,l=Math.sqrt(n*n+a*a),c=3,u=Math.floor(l/c),h=ns_sirius.anim_clock.frame_to_ms(u);s.start_move(h);var p=1;return _==RoomLinkDirection.RIGHT&&(p=2),p},e.prototype.single_anim_comp=function(t){var e=this._character;if(this.can_settle_down)e.enter_room_and_start_battle(this.target_room,this.target_slot);else{e.enter_room(this.target_room,this.target_slot);var i=this._s;i._continue_move()}},e}(Character_Behavior);__reflect(Move_Behavior.prototype,"Move_Behavior",["ns_sirius.Isingle_animation_listener"]);var FindRoom_Behavior=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixed_direction_weights=[3e4,8e4,3e4,3e4],e.target_direction=0,e._previous_direction=-1,e}return __extends(e,t),e.prototype.behavior_active=function(){},e.prototype.behavior_deactive=function(){},e.prototype.find_next_room=function(t){this.cur_room_pos=t,this.target_room_pos=null;var e=gp_core.map.get_room_by_pos(t),i=this._array_multiply(this.fixed_direction_weights,e.link.availables,4),o=this._cal_direction_by_weights(i,this._previous_direction);this.target_direction=o;var _=e.link.neighbours[o];return _?(this.target_room_pos=_.layout_info.room_pos,this._previous_direction=RoomLinkInfo.reverse_direciton(o),!0):(console.error("未找到下一个房间 : "+o),console.log(e.link.neighbours),!1)},e.prototype._array_multiply=function(t,e,i){for(var o=new Array,_=0;i>_;_++)o[_]=t[_]*e[_];return o},e.prototype._cal_direction_by_weights=function(t,e){for(var i=0,o=new Array(4),_=0;4>_;_++)_==e?o[_]=0:o[_]=Math.random()*t[_];for(var _=1;4>_;_++)o[i]<o[_]&&(i=_);return i},e}(Character_Behavior);__reflect(FindRoom_Behavior.prototype,"FindRoom_Behavior");var GameBossEntity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._machine_init=function(){this._machine=new CharacterMachine_Defender,this._machine.machine_initialize(this,this)},e.prototype.can_be_matched=function(){return this._machine?this._machine.get_current_state_enum()==CharacterMachineState.BATTLE_DEFENDER:!1},e.prototype.can_match=function(){return this.can_be_matched()},e.prototype._set_machine_initial_state=function(){this._machine.state_change(CharacterMachineState.BATTLE_DEFENDER)},e.prototype.sentence_to_death=function(){t.prototype.sentence_to_death.call(this),gp_core.end_game(),sirius.view_manager.show_popup_text_msg("游戏结束了")},e.prototype.character_type=function(){return GameCharacterType.Boss},e.prototype.bind_view=function(e){t.prototype.bind_view.call(this,e),this._binded_view.change_direction(2)},e}(GameCharacter);__reflect(GameBossEntity.prototype,"GameBossEntity");var GamePawn_Assault=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._machine_init=function(){this._machine=new CharacterMachine_Assaulter,this._machine.machine_initialize(this,this)},e.prototype._set_machine_initial_state=function(){this._machine.state_change(CharacterMachineState.MOVING)},e.prototype.can_be_matched=function(){return this._machine?this._machine.get_current_state_enum()==CharacterMachineState.BATTLE_ASSAULTER:!1},e.prototype.can_match=function(){return this.can_be_matched()},e.prototype.change_slot_sub_index=function(t){this._slot_pos.slot_sub_id=t},e.prototype.enter_room=function(t,e){this._room_pos.copyp(t),this._slot_pos.copyp(e)},e.prototype.enter_room_and_start_battle=function(t,e){this.enter_room(t,e),this._machine.state_change(CharacterMachineState.BATTLE_ASSAULTER)},e.prototype.end_battle_and_start_move=function(){this._machine.state_change(CharacterMachineState.MOVING)},e.prototype.sentence_to_death=function(){t.prototype.sentence_to_death.call(this),gp_core.am.mark_assaulters_check_death()},e.prototype.character_type=function(){return GameCharacterType.Assaulter},e}(GameCharacter);__reflect(GamePawn_Assault.prototype,"GamePawn_Assault");var GamePawn_Defence=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._machine_init=function(){this._machine=new CharacterMachine_Defender,this._machine.machine_initialize(this,this)},e.prototype.can_be_matched=function(){return this._machine?this._machine.get_current_state_enum()==CharacterMachineState.BATTLE_DEFENDER:!1},e.prototype.can_match=function(){return this.can_be_matched()},e.prototype._set_machine_initial_state=function(){this._machine.state_change(CharacterMachineState.BATTLE_DEFENDER)},e.prototype.sentence_to_death=function(){t.prototype.sentence_to_death.call(this),gp_core.am.mark_defenders_check_death()},e.prototype.character_type=function(){return GameCharacterType.Defender},e.prototype.bind_view=function(e){t.prototype.bind_view.call(this,e),this._binded_view.change_direction(2)},e}(GameCharacter);__reflect(GamePawn_Defence.prototype,"GamePawn_Defence");var Character_RPPS_Battle=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.is_immortal=!1,e}return __extends(e,t),e}(GamePlayEntityBase);__reflect(Character_RPPS_Battle.prototype,"Character_RPPS_Battle");var Character_Skill=function(){function t(){}return t}();__reflect(Character_Skill.prototype,"Character_Skill");var CharacterSkillManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._destroy_arr(this._active_skills),this._active_skills=null,this._destroy_arr(this._trigger_skills),this._trigger_skills=null,t.prototype._before_destroy.call(this)},e.prototype.has_se=function(t){return!1},e.prototype.manager_init=function(t,e){if(this._runnable=!1,e&&e.skills){this._runnable=!0,this._active_skills=new Array,this._trigger_skills=new Array;for(var i=e.skills,o=i.length,_=0;o>_;_++){var r=i[_];if(r.type==GC_Skill_Metadata.SkillType.active){var s=new GC_ActiveSkill;this._active_skills.push(s),s.skill_init(t,r)}else if(r.type==GC_Skill_Metadata.SkillType.trigger){var n=new GC_TriggerSkill;this._trigger_skills.push(n),n.skill_init(t,r)}}}},e.prototype.execute_active_skill=function(){},e}(GamePlayEntityBase);__reflect(CharacterSkillManager.prototype,"CharacterSkillManager");var lk_rtable=[{module_name:"Test",view:TestModuleView,vm:TestModuleVM}],yxy_rtable=[{module_name:"GameWin",view:GameWinView,vm:GameWinVM},{module_name:"TestABC",view:TestABCView,vm:TestABCVM},{module_name:"TestTab",view:Tab1View,vm:Tab1VM}],CharacterMachine_Assaulter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_battle_behavior=function(){if(this.get_current_state_enum()==CharacterMachineState.DYING)return null;if(this.get_current_state_enum()==CharacterMachineState.MOVING)return null;if(this.get_current_state_enum()!=CharacterMachineState.BATTLE_ASSAULTER)throw"Assaulter get_battle_behavior   not in battle ? ";return this._s_battle.get_behavior_battle()},e.prototype._states_init=function(e){t.prototype._states_init.call(this,e),this._s_battle=new Character_State_Battle_Assaulter,this._s_battle.state_init(this,e),this._s_moving=new Character_State_MOVING,this._s_moving.state_init(this,e)},e.prototype.get_state_by_enum=function(e){switch(e){case CharacterMachineState.MOVING:return this._s_moving;case CharacterMachineState.BATTLE_ASSAULTER:return this._s_battle}return t.prototype.get_state_by_enum.call(this,e)},e.prototype._before_destroy=function(){this._s_moving.destroy(),this._s_moving=null,this._s_battle.destroy(),this._s_battle=null,t.prototype._before_destroy.call(this)},e}(CharacterMachine);__reflect(CharacterMachine_Assaulter.prototype,"CharacterMachine_Assaulter");var CharacterMachine_Defender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_battle_behavior=function(){if(this.get_current_state_enum()==CharacterMachineState.DYING)return null;if(this.get_current_state_enum()!=CharacterMachineState.BATTLE_DEFENDER)throw"Defender get_battle_behavior   not in battle ? ";return this._s_battle.get_behavior_battle()},e.prototype._states_init=function(e){t.prototype._states_init.call(this,e),this._s_battle=new Character_State_Battle_Defender,this._s_battle.state_init(this,e)},e.prototype.get_state_by_enum=function(e){switch(e){case CharacterMachineState.BATTLE_DEFENDER:return this._s_battle}return t.prototype.get_state_by_enum.call(this,e)},e.prototype._before_destroy=function(){this._s_battle.destroy(),this._s_battle=null,t.prototype._before_destroy.call(this)},e}(CharacterMachine);__reflect(CharacterMachine_Defender.prototype,"CharacterMachine_Defender");var Character_State_BORN=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.BORN},e.prototype.state_str=function(){return"BORN"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_BORN.prototype,"Character_State_BORN");var Character_State_DYING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.DYING},e.prototype.state_str=function(){return"DYING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null);var i=this._character.current_room();if(this._character.character_type()==GameCharacterType.Defender)i.defender_leave(this._character);else if(this._character.character_type()==GameCharacterType.Assaulter)i.assaulter_leave(this._character);else if(this._character.character_type()==GameCharacterType.Boss){var o=i;o.boss_leave(this._character)}},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_DYING.prototype,"Character_State_DYING");var Character_State_ERROR=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.ERROR},e.prototype.state_str=function(){return"ERROR"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_ERROR.prototype,"Character_State_ERROR");var Character_State_MOVING=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._behavior_move.destroy(),this._behavior_move=null,this._behavior_findroom.destroy(),this._behavior_findroom=null,t.prototype._before_destroy.call(this)},e.prototype._behaviors_init=function(){this._behavior_move=new Move_Behavior(this._character,this),this._behavior_findroom=new FindRoom_Behavior(this._character,this)},e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.MOVING},e.prototype.state_str=function(){return"MOVING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._behavior_move.behavior_active(),this._behavior_findroom.behavior_active(),this._continue_move()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null),this._behavior_move.behavior_deactive(),this._behavior_findroom.behavior_deactive()},e.prototype._syn_character_pos=function(){this._character._sm_modify_pos(this._behavior_move.anim.current_pos_3d,this._behavior_move.anim.current_scale_3d)},e.prototype._continue_move=function(){var t=this._character.get_room_pos(),e=this._character.get_slot_pos(),i=this._behavior_findroom.find_next_room(t);if(!i)return void this._machine.state_change(CharacterMachineState.ERROR,"find_room");var o=this._behavior_findroom.target_room_pos,_=this._behavior_findroom.target_direction,r=gp_core.map.get_room_by_pos(t),s=gp_core.map.get_room_by_pos(o),n=s.pawn_settle_down(this._character,this._character._buffer_new_slot_pos);n||(this._character._buffer_new_slot_pos.slot_index=-1);var a=this._behavior_move.move(r,s,e,this._character._buffer_new_slot_pos,_,n);this._character._sm_modify_view_orientation(a)},e}(CharacterStateBase);__reflect(Character_State_MOVING.prototype,"Character_State_MOVING");var Character_State_Battle_Assaulter=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.state_enum=function(){return CharacterMachineState.BATTLE_ASSAULTER},e.prototype.state_str=function(){return"BATTLE_ASSAULTER"},e.prototype.state_enter=function(e,i){void 0===i&&(i=null),t.prototype.state_enter.call(this,e,i),this._character._sm_modify_view_orientation(1),this._character.current_room().mark_match_again()},e}(Character_State_Battle);__reflect(Character_State_Battle_Assaulter.prototype,"Character_State_Battle_Assaulter");var Character_State_Battle_Defender=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.state_enum=function(){return CharacterMachineState.BATTLE_DEFENDER},e.prototype.state_str=function(){return"BATTLE_DEFENDER"},e}(Character_State_Battle);__reflect(Character_State_Battle_Defender.prototype,"Character_State_Battle_Defender");var zl_rtable=[],GameMap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._destroy_arr(this.rooms),this.rooms=null,this.boss_room&&(this.boss_room.destroy(),this.boss_room=null)},e.prototype.generate_map_layout=function(){this.birth_room=new BornRoomEntity,this.birth_room.room_layout_init(0,0);var t=gp_core.layout_config;this.rooms=new Array(t.element_count);for(var e=t.column_count,i=t.row_count,o=0;i>o;o++)for(var _=0;e>_;_++){var r=new CommonRoomEntity;r.room_layout_init(_,o);var s=r.layout_info.room_pos.unique_index;this.rooms[s]=r}this.boss_room=new BossRoomEntity,this.boss_room.room_layout_init(0,0),this.birth_room.link_generate(this);for(var o=0;o<t.element_count;o++)this.rooms[o].link_generate(this);this.boss_room.link_generate(this);var n=0;3==t.row_count?n=1:5==t.row_count&&(n=2);var a=gp_core.layout_config.rowcolumn_to_uindex(n,0);this.rooms[a].link.link_to_boss(this)},e.prototype.perspective_update=function(){for(var t=gp_core.map,e=t.rooms.length,i=0;e>i;i++){var o=t.rooms[i].layout_info;o.update_3d_layout()}t.birth_room.layout_info.update_3d_layout(),t.boss_room.layout_info.update_3d_layout()},e.prototype.assault_depth_update=function(){for(var t=this.rooms.length,e=0;t>e;e++){var i=this.rooms[e];i._room_type==RoomTypeEnum.ARENA&&i.depth_sort()}this.boss_room.depth_sort()},e.prototype.get_room_by_pos=function(t){if(!t||t.unique_index<0)return null;var i=t.unique_index;if(i==e.born_room_id)return this.birth_room;if(i==e.boss_room_id)return this.boss_room;var o=this.rooms.length;return i>o-1?null:this.rooms[i]},e.prototype.get_room_beneath_birth_room=function(){var t=gp_core.layout_config.row_count,e=gp_core.layout_config.column_count,i=0;return 3==t?i=gp_core.layout_config.rowcolumn_to_uindex(1,e-1):5==t&&(i=gp_core.layout_config.rowcolumn_to_uindex(2,e-1)),this.rooms[i]},e.prototype.get_common_room_by_index=function(t){return this.rooms[t]},e.prototype.get_boss_room=function(){return this.boss_room},e.prototype.get_birth_room=function(){return this.birth_room},e.prototype.debug_generate_defenders=function(){for(var t=this.rooms.length,e=0;t>e;e++){var i=this.rooms[e];i.layout_info.room_pos.unique_index;0==i.layout_info.room_pos.row_index&&(1==i.layout_info.room_pos.column_index||2==i.layout_info.room_pos.column_index||4==i.layout_info.room_pos.column_index)&&i.debug_generate_defenders(),1==i.layout_info.room_pos.row_index&&1==i.layout_info.room_pos.column_index&&i.debug_generate_defenders(),2==i.layout_info.room_pos.row_index&&(6==i.layout_info.room_pos.column_index||7==i.layout_info.room_pos.column_index||8==i.layout_info.room_pos.column_index)&&i.debug_generate_defenders()}this.boss_room.debug_generate_defenders()},e.born_room_id=998,e.boss_room_id=999,e.boss_slot_id=999,e}(GamePlayEntityBase);__reflect(GameMap.prototype,"GameMap");var MapRoomPosition=function(){function t(t,e,i){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===i&&(i=-1),this.unique_index=t,this.column_index=e,this.row_index=i}return t.prototype.copyp=function(t){this.unique_index=t.unique_index,this.column_index=t.column_index,this.row_index=t.row_index},t}();__reflect(MapRoomPosition.prototype,"MapRoomPosition");var MapRoomSlotPosition=function(){function t(t,e,i){void 0===t&&(t=-1),void 0===e&&(e=1),void 0===i&&(i=-1),this.slot_index=t,this.slot_sub_id=i,this.type=e}return t.prototype.copyp=function(t){this.slot_index=t.slot_index,this.slot_sub_id=t.slot_sub_id,this.type=t.type},t.empty_slot_pos=new t(-1,-1,-1),t}();__reflect(MapRoomSlotPosition.prototype,"MapRoomSlotPosition");var MapUniquePos=function(){function t(t,e){this.room=t,this.slot=e}return t}();__reflect(MapUniquePos.prototype,"MapUniquePos");var BornRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_friendly=function(t){return null},e.prototype.get_enemy=function(t){return null},e.prototype.room_layout_init=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.born_layout_init()},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.born_link_init(t)},e.prototype.is_born_room=function(){return!0},e.prototype.assaulter_leave=function(t){return-1},e.prototype.defender_leave=function(t){return-1},e.prototype.pawn_settle_down=function(t,e){return!1},e.prototype.mark_match_again=function(){},e.prototype.depth_sort=function(){},e}(RoomEntity);__reflect(BornRoomEntity.prototype,"BornRoomEntity");var BossRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_friendly=function(t){return t==GameCharacterType.Assaulter?null:t==GameCharacterType.Defender?this._slots_defence:null},e.prototype.get_enemy=function(t){return t==GameCharacterType.Assaulter?this._slots_defence:(t==GameCharacterType.Defender,null)},e.prototype._before_destroy=function(){this._slot_boss=null,this._slots_defence=null;for(var e=0;e<RoomEntity.SlotsMax;e++)this._slots_assault[e].destroy();this._slots_assault=null,t.prototype._before_destroy.call(this)},e.prototype.room_layout_init=function(t,e){this.layout_info=new BossRoomLayoutInfo,this.layout_info.layout_init(-1,-1),this._slots_defence=new Array(RoomEntity.SlotsMax),this._init_arr_by_null(this._slots_defence,RoomEntity.SlotsMax),this._slots_assault=new Array(RoomEntity.SlotsMax);for(var i=0;i<RoomEntity.SlotsMax;i++)this._slots_assault[i]=new ns_sirius.doubly_linked_list(i)},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.boss_link_init(t)},e.prototype.is_boss_room=function(){return!0},e.prototype.pawn_settle_down=function(t,e){return this._has_init?(this._push_new_assaulter(t,e),this._assaulter_slots_update(),gp_core.am.mark_assault_depth_update(),!0):!1},e.prototype.boss_leave=function(t){return 0},e.prototype.assaulter_leave=function(t){var e=t.get_slot_pos();if(!e)throw"slot pos should not be null";var i=e.slot_index;if(0>i)throw"slot index should not be negative";var o=this._slots_assault[i];return o.remove(t),this._assaulter_slots_update(),this._match_enemies(),0},e.prototype.defender_leave=function(t){var e=t.get_slot_pos();if(!e)throw"slot pos should not be null";var i=e.slot_index;if(0>i)throw"slot index should not be negative";return this._slots_defence[i]=null,this._match_enemies(),0},e.prototype.mark_match_again=function(){this._match_enemies()},e.prototype.depth_sort=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._slots_assault[t];if(!e.is_empty())for(var i=e.get_head().next;i&&!i.is_tail();){if(!i.element.is_dead()){var o=i.element._binded_view;o.parent.addChild(o)}i=i.next}}},e.prototype._assaulter_slots_update=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._slots_assault[t];if(!e.is_empty())for(var i=e.get_head().next,o=0;i&&!i.is_tail();){var _=i.element;_.change_slot_sub_index(o),o++,i=i.next}}},e.prototype._match_enemies=function(){var t=this._defence_slots_is_empty();t?this._match_assaulter_to_boss():(this._match_defender_to_assaulter(),this._match_assaulter_to_defenders()),this._match_boss_to_assaulter()},e.prototype._link_list_to_target=function(t,e){for(var i=t.get_head().next;i&&!i.is_tail();){var o=i.element;o.can_match()&&this._link_asymmetrical(o,e),i=i.next}},e.prototype._link_target_to_list=function(t,e){for(var i=e.get_head().next;i&&!i.is_tail();){var o=i.element;
o.can_be_matched()&&this._link_asymmetrical(t,o),i=i.next}},e.prototype._unlink_list=function(t){for(var e=t.get_head().next;e&&!e.is_tail();){var i=e.element;this._unlink(i),e=e.next}},e.prototype._match_assaulter_to_boss=function(){var t=!1;this._slot_boss&&this._slot_boss.can_be_matched()&&(t=!0);for(var e=0;e<RoomEntity.SlotsMax;e++){var i=this._slots_assault[e];i.is_empty()||(t?this._link_list_to_target(i,this._slot_boss):this._unlink_list(i))}},e.prototype._match_assaulter_to_defenders=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._slots_assault[t];if(!e.is_empty()){var i=this._find_facing_defender(t);if(i)this._link_list_to_target(e,i);else{var o=this._find_living_defender();o?this._link_list_to_target(e,o):this._unlink_list(e)}}}},e.prototype._match_boss_to_assaulter=function(){if(this._slot_boss){this._slot_boss.can_match()||this._unlink(this._slot_boss);var t=this._find_living_assaulter();return t?void this._link_asymmetrical(this._slot_boss,t):void this._unlink(this._slot_boss)}},e.prototype._match_defender_to_assaulter=function(){for(var t=RoomEntity.SlotsMax,e=0;t>e;e++){var i=this._slots_defence[e];if(i&&i.can_match()){var o=this._find_facing_assaulter(e);if(o)this._link_asymmetrical(i,o);else{var _=this._find_living_assaulter();_?this._link_asymmetrical(i,_):this._unlink(i)}}}},e.prototype._find_shortest_list=function(){var t=this._slots_assault[0];return this._slots_assault[1].length<t.length&&(t=this._slots_assault[1]),this._slots_assault[2].length<t.length&&(t=this._slots_assault[2]),t},e.prototype._push_new_assaulter=function(t,e){var i=this._find_shortest_list();e.slot_index=i.list_id,e.slot_sub_id=i.length,i.push(t)},e.prototype._defence_slots_is_empty=function(){for(var t=0;t<RoomEntity.SlotsMax;t++)if(this._slots_defence[t])return!1;return!0},e.prototype._assaulter_slots_is_empty=function(){for(var t=0;t<RoomEntity.SlotsMax;t++)if(!this._slots_assault[t].is_empty())return!1;return!0},e.prototype._find_facing_defender=function(t){var e=this._slots_defence[t];return e&&e.can_be_matched()?e:null},e.prototype._find_living_defender=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._find_facing_defender(t);if(e)return e}return null},e.prototype._find_facing_assaulter=function(t){var e=this._slots_assault[t];if(e.is_empty())return null;var i=e.get_head().next.element;return i.can_be_matched()?i:null},e.prototype._find_living_assaulter=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._find_facing_assaulter(t);if(e)return e}return null},e.prototype.debug_generate_defenders=function(){var t=RES.getRes("cdef_debug_json");this.room_type_init(RoomTypeEnum.BOSS,-1);for(var e=RoomEntity.SlotsMax,i=0;e>i;i++){var o=gp_core.am.born_pawn(GameCharacterType.Defender);this._slots_defence[i]=o,o.skill_hierarchy_establish(t),o.put_on_the_map_and_run(this.layout_info.room_pos,new MapRoomSlotPosition(i,GameCharacterType.Defender))}var _=gp_core.am.born_boss();this._slot_boss=_,_.skill_hierarchy_establish(t),_.put_on_the_map_and_run(this.layout_info.room_pos,new MapRoomSlotPosition(GameMap.boss_slot_id,GameCharacterType.Boss))},e}(RoomEntity);__reflect(BossRoomEntity.prototype,"BossRoomEntity");var CommonRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_friendly=function(t){return t==GameCharacterType.Assaulter?this._slots_assault:t==GameCharacterType.Defender?this._slots_defence:null},e.prototype.get_enemy=function(t){return t==GameCharacterType.Assaulter?this._slots_defence:t==GameCharacterType.Defender?this._slots_assault:null},e.prototype._before_destroy=function(){this._slots_defence=null,this._slots_assault=null,t.prototype._before_destroy.call(this)},e.prototype.room_type_init=function(e,i){t.prototype.room_type_init.call(this,e,i),this._slots_defence=new Array(RoomEntity.SlotsMax),this._slots_assault=new Array(RoomEntity.SlotsMax),this._init_arr_by_null(this._slots_defence,RoomEntity.SlotsMax),this._init_arr_by_null(this._slots_assault,RoomEntity.SlotsMax)},e.prototype.pawn_settle_down=function(t,e){if(this._room_type!=RoomTypeEnum.ARENA)return!1;if(this.defence_slots_is_empty())return!1;var i=this.find_free_assault_slot();return 0>i?!1:(e.slot_index=i,this._slots_assault[i]=t,gp_core.am.mark_assault_depth_update(),!0)},e.prototype.assaulter_leave=function(t){if(this._room_type!=RoomTypeEnum.ARENA)return-1;var e=t.get_slot_pos();if(!e)throw"slot pos should not be null";var i=e.slot_index;if(0>i)throw"slot index should not be negative";return this._slots_assault[i]=null,this._match_enemies(),0},e.prototype.defender_leave=function(t){if(this._room_type!=RoomTypeEnum.ARENA)return-1;var e=t.get_slot_pos();if(!e)throw"slot pos should not be null";var i=e.slot_index;if(0>i)throw"slot index should not be negative";return this._slots_defence[i]=null,this._match_enemies(),this._check_assaulters_should_leave(),0},e.prototype._check_assaulters_should_leave=function(){var t=this.find_living_defender();if(!t)for(var e=RoomEntity.SlotsMax,i=0;e>i;i++){var o=this._slots_assault[i];o&&(o.end_battle_and_start_move(),this._slots_assault[i]=null)}},e.prototype.mark_match_again=function(){this._match_enemies()},e.prototype._match_enemies=function(){if(!this._slots_defence)throw"?? should have defenders";for(var t=RoomEntity.SlotsMax,e=0;t>e;e++){var i=this._slots_defence[e];if(i&&i.can_match()){var o=this.find_facing_assaulter(e);if(o)this._link_asymmetrical(i,o);else{var _=this.find_living_assaulter();_?this._link_asymmetrical(i,_):this._unlink(i)}}}for(var e=0;t>e;e++){var r=this._slots_assault[e];if(r&&r.can_match()){var s=this.find_facing_defender(e);if(s)this._link_asymmetrical(r,s);else{var n=this.find_living_defender();n?this._link_asymmetrical(r,n):this._unlink(r)}}}},e.prototype.depth_sort=function(){for(var t=RoomEntity.SlotsMax,e=0;t>e;e++){var i=this._slots_assault[e];i&&i._binded_view.parent.addChild(i._binded_view)}},e.prototype.find_free_assault_slot=function(){for(var t=0;t<RoomEntity.SlotsMax;t++)if(null==this._slots_assault[t])return t;return-1},e.prototype.find_facing_assaulter=function(t){var e=this._slots_assault[t];return e&&e.can_be_matched()?e:null},e.prototype.find_living_assaulter=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._slots_assault[t];if(e&&e.can_be_matched())return e}return null},e.prototype.find_facing_defender=function(t){var e=this._slots_defence[t];return e&&e.can_be_matched()?e:null},e.prototype.find_living_defender=function(){for(var t=0;t<RoomEntity.SlotsMax;t++){var e=this._slots_defence[t];if(e&&e.can_be_matched())return e}return null},e.prototype.assault_slots_is_empty=function(){for(var t=0;t<RoomEntity.SlotsMax;t++)if(this._slots_assault[t])return!1;return!0},e.prototype.defence_slots_is_empty=function(){for(var t=0;t<RoomEntity.SlotsMax;t++)if(this._slots_defence[t])return!1;return!0},e.prototype.debug_generate_defenders=function(){var t=RES.getRes("cdef_debug_json");this.room_type_init(RoomTypeEnum.ARENA,-1);for(var e=RoomEntity.SlotsMax,i=0;e>i;i++){var o=gp_core.am.born_pawn(GameCharacterType.Defender);this._slots_defence[i]=o,o.skill_hierarchy_establish(t),o.put_on_the_map_and_run(this.layout_info.room_pos,new MapRoomSlotPosition(i,GameCharacterType.Defender))}},e.prototype.debug_generate_defender_one=function(){var t=RES.getRes("cdef_debug_json");this.room_type_init(RoomTypeEnum.ARENA,-1);var e=gp_core.am.born_pawn(GameCharacterType.Defender);this._slots_defence[0]=e,e.skill_hierarchy_establish(t),e.put_on_the_map_and_run(this.layout_info.room_pos,new MapRoomSlotPosition(0,GameCharacterType.Defender))},e}(RoomEntity);__reflect(CommonRoomEntity.prototype,"CommonRoomEntity");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.size=this.size*COMMON_consts.scaleW},e}(eui.Label);t.BaseLabel=e,__reflect(e.prototype,"game.BaseLabel")}(game||(game={}));var BossRoomLayoutInfo=function(t){function e(){var e=t.call(this)||this;return e._boss_pos2=new egret.Point,e._boss_pos3=new egret.Point,e}return __extends(e,t),e.prototype._before_destroy=function(){this._slots_assault_2d_from=null,this._slots_assault_2d_to=null,this._slots_assault_3d_from=null,this._slots_assault_3d_to=null,t.prototype._before_destroy.call(this)},e.prototype.layout_init=function(t,e){var i=gp_core.layout_config;this.room_pos=new MapRoomPosition(GameMap.boss_room_id);var o=i.boss_w,_=i.boss_h;this.view_pos.x=i.boss_view_x,this.view_pos.y=i.boss_view_y,this.center_pos.x=this.view_pos.x+Math.round(.5*o),this.center_pos.y=this.view_pos.y+Math.round(.5*_),this.view_w=o,this.view_h=_,this._def_slots_init(),this._assualt_slots_init(),this._boss_position_init()},e.prototype._boss_position_init=function(){var t=gp_core.layout_config;this._boss_pos2.x=this.view_pos.x+.5*t.cell_w,this._boss_pos2.y=this.center_pos.y},e.prototype._slot_orig_x=function(){var t=gp_core.layout_config;return this.view_pos.x+t.cell_w},e.prototype._assualt_slots_init=function(){var t=RoomEntity.SlotsMax,e=gp_core.layout_config;this._slots_assault_2d_from=Array(t),this._slots_assault_2d_to=Array(t),this._slots_assault_3d_from=Array(t),this._slots_assault_3d_to=Array(t);for(var i=this._slot_orig_x(),o=e.cell_h,_=Math.floor(e.cell_h/3),r=0;t>r;r++){var s=this.view_pos.y+o-_*(t-1-r);this._slots_assault_2d_from[r]=new egret.Point(i+e.cell_w-this._slot_inner_gap(),s),this._slots_assault_2d_to[r]=new egret.Point(this.view_pos.x+this.view_w,s),this._slots_assault_3d_from[r]=new egret.Point(0,0),this._slots_assault_3d_to[r]=new egret.Point(0,0)}},e.prototype.update_3d_layout=function(){gp_core.ppc.cal_3d_pos(this.center_pos,this.d3_point_local,this.d3_scale),gp_core.ppc.cal_3d_pos(this._boss_pos2,this._boss_pos3,null);for(var t=RoomEntity.SlotsMax,e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_def_2d[e],this._slots_def_3d[e],null);for(var e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_assault_2d_from[e],this._slots_assault_3d_from[e],null),gp_core.ppc.cal_3d_pos(this._slots_assault_2d_to[e],this._slots_assault_3d_to[e],null)},e.prototype.get_slot_3dpos_by_slot=function(t,e){if(t.type==GameCharacterType.Boss)return void e.copyFrom(this._boss_pos3);if(!t||t.slot_index<0)return void e.copyFrom(this.d3_point_local);var i=RoomEntity.SlotsMax;return t.slot_index>i-1?void e.copyFrom(this.d3_point_local):void(t.type==GameCharacterType.Defender?e.copyFrom(this._slots_def_3d[t.slot_index]):t.type==GameCharacterType.Assaulter?(e.y=this._slots_assault_3d_from[t.slot_index].y,e.x=this._linear_interpolation(this._slots_assault_3d_from[t.slot_index].x,this._slots_assault_3d_to[t.slot_index].x,t.slot_sub_id)):e.copyFrom(this.d3_point_local))},e.prototype.get_slot_2dpos_by_index=function(t,e){return!t||t.slot_index<0?(e.x=this.center_pos.x,void(e.y=this.center_pos.y)):t.type==GameCharacterType.Boss?(e.x=this._boss_pos2.x,void(e.y=this._boss_pos2.y)):void(t.type==GameCharacterType.Defender?(e.x=this._slots_def_2d[t.slot_index].x,e.y=this._slots_def_2d[t.slot_index].y):t.type==GameCharacterType.Assaulter?(e.y=this._slots_assault_2d_from[t.slot_index].y,e.x=this._linear_interpolation(this._slots_assault_2d_from[t.slot_index].x,this._slots_assault_2d_to[t.slot_index].x,t.slot_sub_id)):(e.x=this.center_pos.x,e.y=this.center_pos.y))},e.prototype._linear_interpolation=function(t,e,i){var o=3,_=(e-t)/o;if(o>=i){var r=t+i*_;return r}return e},e}(RoomLayoutInfo);__reflect(BossRoomLayoutInfo.prototype,"BossRoomLayoutInfo");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.CommonIconItemView=e,__reflect(e.prototype,"game.CommonIconItemView")}(game||(game={}));var RoomLinkDirection=function(){function t(){}return t.FRONT=0,t.LEFT=1,t.BACK=2,t.RIGHT=3,t}();__reflect(RoomLinkDirection.prototype,"RoomLinkDirection");var RoomLinkInfo=function(t){function e(){var e=t.call(this)||this;return e.availables=[0,0,0,0],e.neighbours=[null,null,null,null],e}return __extends(e,t),e.reverse_direciton=function(t){switch(t){case RoomLinkDirection.FRONT:return RoomLinkDirection.BACK;case RoomLinkDirection.BACK:return RoomLinkDirection.FRONT;case RoomLinkDirection.LEFT:return RoomLinkDirection.RIGHT;case RoomLinkDirection.RIGHT:return RoomLinkDirection.LEFT}return-1},e.prototype._before_destroy=function(){this.availables=null,this.neighbours=null},e.prototype.link_init=function(t,e,i){var o=gp_core.layout_config.rowcolumn_to_uindex(e+1,i),_=gp_core.layout_config.rowcolumn_to_uindex(e,i-1),r=gp_core.layout_config.rowcolumn_to_uindex(e-1,i),s=gp_core.layout_config.rowcolumn_to_uindex(e,i+1);this.neighbours[RoomLinkDirection.FRONT]=t.get_common_room_by_index(o),this.neighbours[RoomLinkDirection.LEFT]=t.get_common_room_by_index(_),this.neighbours[RoomLinkDirection.BACK]=t.get_common_room_by_index(r),this.neighbours[RoomLinkDirection.RIGHT]=t.get_common_room_by_index(s),this.availables[0]=this.neighbours[RoomLinkDirection.FRONT]?1:0,this.availables[1]=this.neighbours[RoomLinkDirection.LEFT]?1:0,this.availables[2]=this.neighbours[RoomLinkDirection.BACK]?1:0,this.availables[3]=this.neighbours[RoomLinkDirection.RIGHT]?1:0},e.prototype.born_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_room_beneath_birth_room(),this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=1,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.boss_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=null,this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=0,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.link_to_boss=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_boss_room(),this.availables[0]=1},e}(GamePlayEntityBase);__reflect(RoomLinkInfo.prototype,"RoomLinkInfo");var RoomBossSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomBossSlotEntity.prototype,"RoomBossSlotEntity");var RoomSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomSlotEntity.prototype,"RoomSlotEntity");var po_validator;!function(t){function e(t){var e=null;return t.conditional_type==GC_Process_Metadata.Process_ConditionalType.se&&(e=i),e}function i(t,e){return t.skill_m.has_se(e.se_uid)}t.choose_validator=e}(po_validator||(po_validator={}));var po_selector;!function(t){function e(t){var e=null;return t.scope==GC_Process_Metadata.ScopeE.OneVsOne?t.target==GC_Process_Metadata.TargetE.Friendly?e=i:t.target==GC_Process_Metadata.TargetE.Enemy&&(e=o):t.scope==GC_Process_Metadata.ScopeE.Room&&(t.target==GC_Process_Metadata.TargetE.Friendly?t.regulation==GC_Process_Metadata.RegulationE.All?e=_:t.regulation==GC_Process_Metadata.RegulationE.Random_One:t.target==GC_Process_Metadata.TargetE.Enemy&&(t.regulation==GC_Process_Metadata.RegulationE.All?e=r:t.regulation==GC_Process_Metadata.RegulationE.Random_One)),e}function i(t){return t}function o(t){return t.get_facing_enemy()}function _(t){var e=t.current_room();return e.get_friendly(t.character_type())}function r(t){var e=t.current_room();return e.get_enemy(t.character_type())}t.choose_selector=e}(po_selector||(po_selector={}));var GC_Process_Metadata;!function(t){var e;!function(t){t[t.nil=0]="nil",t[t.dmg=1]="dmg",t[t.ik=2]="ik",t[t.heal=3]="heal",t[t.character_modify=4]="character_modify",t[t.se_modify=5]="se_modify",t[t.se_add=6]="se_add",t[t.se_remove=7]="se_remove",t[t.cd_modify=8]="cd_modify",t[t.cd_terminate=9]="cd_terminate",t[t.selector=100]="selector",t[t.conditional=101]="conditional",t[t.probability=102]="probability"}(e=t.GC_ProcessType||(t.GC_ProcessType={}));var i;!function(t){t[t.OneVsOne=0]="OneVsOne",t[t.Room=1]="Room",t[t.Global=2]="Global"}(i=t.ScopeE||(t.ScopeE={}));var o;!function(t){t[t.Friendly=0]="Friendly",t[t.Enemy=1]="Enemy"}(o=t.TargetE||(t.TargetE={}));var _;!function(t){t[t.All=0]="All",t[t.Random_One=1]="Random_One"}(_=t.RegulationE||(t.RegulationE={}));var r;!function(t){t[t.se=0]="se"}(r=t.Process_ConditionalType||(t.Process_ConditionalType={}));var s;!function(t){t[t.fire=0]="fire",t[t.ice=1]="ice",t[t.water=2]="water"}(s=t.Dmg_Element||(t.Dmg_Element={}))}(GC_Process_Metadata||(GC_Process_Metadata={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GC_Process_Conditional=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Process_Metadata.GC_ProcessType.conditional},e.prototype._before_destroy=function(){this._validator=null,this._condition=null,t.prototype._before_destroy.call(this)},e.prototype._init=function(t){var e=t;this._condition=e.condition,this._validator=po_validator.choose_validator(e)},e.prototype.execute=function(){this._validator(this._binded_character,this._condition)},e}(GC_ProcessBase);__reflect(GC_Process_Conditional.prototype,"GC_Process_Conditional");var GC_Process_Probability=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Process_Metadata.GC_ProcessType.probability},e.prototype._before_destroy=function(){t.prototype._before_destroy.call(this)},e.prototype._init=function(t){},e.prototype.execute=function(){return!0},e}(GC_ProcessBase);__reflect(GC_Process_Probability.prototype,"GC_Process_Probability");var GC_Process_Selector=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Process_Metadata.GC_ProcessType.selector},e.prototype._before_destroy=function(){this._selector=null,t.prototype._before_destroy.call(this)},e.prototype._init=function(t){var e=t;this._selector=po_selector.choose_selector(e.selector)},e.prototype.execute=function(){return this._selector(this._binded_character)},e}(GC_ProcessBase);__reflect(GC_Process_Selector.prototype,"GC_Process_Selector");var Test_Added=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/LK/skins/Test_AddedSkin.exml",e}return __extends(e,t),e}(eui.Component);__reflect(Test_Added.prototype,"Test_Added",["eui.UIComponent","egret.DisplayObject"]);var GC_LP_dmg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Process_Metadata.GC_ProcessType.dmg},e.prototype._init=function(t){var e=t;this._selector_id=e.target.selector_id},e.prototype.execute=function(){},e}(GC_LogicProcess);__reflect(GC_LP_dmg.prototype,"GC_LP_dmg");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e}(eui.Component);t.CommonRedBtnView=e,__reflect(e.prototype,"game.CommonRedBtnView")}(game||(game={}));var GC_Skill_Metadata;!function(t){var e;!function(t){t[t.active=0]="active",t[t.trigger=1]="trigger",t[t.modifier=2]="modifier"}(e=t.SkillType||(t.SkillType={}));var i;!function(t){t[t.nil=0]="nil",t[t.Dead=1]="Dead",t[t.Before_Attacked=2]="Before_Attacked",t[t.BeingHit=3]="BeingHit",t[t.NotBeingHit=4]="NotBeingHit",t[t.After_Attacked=5]="After_Attacked",t[t.Before_Attack=6]="Before_Attack",t[t.Hit=7]="Hit",t[t.NotHit=8]="NotHit",t[t.After_Attack=9]="After_Attack",t[t.SE_trigger=10]="SE_trigger"}(i=t.Process_Trigger_Event||(t.Process_Trigger_Event={}))}(GC_Skill_Metadata||(GC_Skill_Metadata={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setPosition=function(t,e){e>2&&98>e?(this.stick.visible=!0,this.stick.x=t*(.01*e)):this.stick.visible=!1},e}(t.CommonProcessBar);t.ExpProcessBarView=e,__reflect(e.prototype,"game.ExpProcessBarView")}(game||(game={}));var GC_ActiveSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Skill_Metadata.SkillType.active},e}(GC_dependentSkill);__reflect(GC_ActiveSkill.prototype,"GC_ActiveSkill");var GC_ModifierSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Skill_Metadata.SkillType.modifier},e}(GC_SkillBase);__reflect(GC_ModifierSkill.prototype,"GC_ModifierSkill");var GC_TriggerSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.type=function(){return GC_Skill_Metadata.SkillType.trigger},e}(GC_dependentSkill);__reflect(GC_TriggerSkill.prototype,"GC_TriggerSkill");var DependentSkillCD=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){this._cd_interval=t,this._cd_cursor=0},e.prototype.act=function(){var t=!1;return 0==this._cd_cursor&&(t=!0),this._cd_cursor++,this._cd_cursor>this._cd_interval&&(this._cd_cursor=0),t},e}(GamePlayEntityBase);__reflect(DependentSkillCD.prototype,"DependentSkillCD");var GameCoreView=function(t){function e(){var e=t.call(this)||this;return e.height=sirius.device_info.design_height,e.width=sirius.device_info.initial_optimal_w,e.horizontalCenter=0,e.top=0,e.mask=new egret.Rectangle(0,0,e.width,e.height),e._bgimg=new eui.Image("game_bg_jpg"),e.addChild(e._bgimg),e._bgimg.top=0,e._bgimg.width=sirius.device_info.design_width,e._bgimg.height=Math.ceil(1136*e._bgimg.width/640),e._bgimg.horizontalCenter=0,e._bgimg.verticalCenter=0,e._coord_convert_ref_view=new egret.DisplayObjectContainer,e.addChild(e._coord_convert_ref_view),e._coord_convert_ref_view.width=gp_core.layout_config.total_w,e._coord_convert_ref_view.height=gp_core.layout_config.total_h,e._repos_view(),e}return __extends(e,t),e.prototype.core_init=function(t){this._gc=t},e.prototype.prepare_view_before_game=function(){},e.prototype._repos_view=function(){var t=gp_core.layout_config.total_w,e=sirius.device_info.initial_optimal_w;if(this.map_view){var i=.5*(e-t);this.map_view.x=i,this._coord_convert_ref_view.x=i}this.painting_canvas&&(this.painting_canvas.x=.5*sirius.device_info.initial_optimal_w)},e.prototype.get_coord_convert_ref_view=function(){return this._coord_convert_ref_view},e.prototype.prepare_game=function(){this.painting_canvas=new MapPaintingCanvas,this.addChild(this.painting_canvas),this.painting_canvas.prepare_mesh(),this.painting_canvas.visible=!1,this.map_view=new GC_MapView,this.addChild(this.map_view),this.map_view.width=gp_core.layout_config.total_w,this.map_view.height=gp_core.layout_config.total_h,this._painting_src=new MapPaintingView,this.addChild(this._painting_src),this._painting_src.width=gp_core.layout_config.canvas_fixed_w,this._painting_src.height=gp_core.layout_config.canvas_fixed_h,this._painting_src.visible=!1,this._repos_view()},e.prototype.room_start_painting=function(){this._painting_src.redraw()},e.prototype.start_game=function(){this._draw_rt(),this.map_view.rooms_init()},e.prototype.game_res_dispose=function(){this.painting_canvas.game_res_dispose(),this.painting_canvas.destroy(),this.painting_canvas=null,this.map_view.game_res_dispose(),this.map_view.destroy(),this.map_view=null},e.prototype.perspective_update=function(){this.painting_canvas.update_pp_param(this._gc),this.map_view.update_pp_param()},e.prototype._draw_rt=function(){var t=gp_core.layout_config.canvas_fixed_w,e=gp_core.layout_config.canvas_fixed_h,i=new egret.RenderTexture;i.disposeBitmapData=!0,i.drawToTexture(this._painting_src,new egret.Rectangle(0,0,t,e)),this.painting_canvas.paint_room(i,this._gc),i=null,this.painting_canvas.visible=!0,this.removeChild(this._painting_src),this._painting_src=null},e.prototype.debug_born_pawn=function(){return this.map_view.debug_born_pawn()},e}(ns_sirius.sirius_view_base);__reflect(GameCoreView.prototype,"GameCoreView");var GamePlayCore=function(t){function e(){var e=t.call(this)||this;return egret.Ticker.getInstance().register(function(t){dragonBones.WorldClock.clock.advanceTime(t/1e3),ns_sirius.world_clock.update(t)},e),e.layout_config=new GPC_layout_config,e._pan_handler=new GameCorePanHandler,e.ppc=new PerspectiveCore,e._machine=new MWN_machine,e._machine.machine_initialize(e,e,null),e}return __extends(e,t),e.prototype.modify_global_speed=function(t){0==t?(dragonBones.WorldClock.clock.timeScale=1,ns_sirius.world_clock.time_scale=1):(dragonBones.WorldClock.clock.timeScale=2,ns_sirius.world_clock.time_scale=2)},e.prototype._debug_global_speed=function(t){dragonBones.WorldClock.clock.timeScale=t,ns_sirius.world_clock.time_scale=t},e.prototype.core_init=function(t){this.stage=t,this._pan_handler.core_init(this,t)},e.prototype.register_core_view=function(t,e){this.ppc.core_init(this.stage,e),this._game_core_view=t,this._game_core_view.core_init(this)},e.prototype.prepare_game=function(){this._machine.state_change(MWN_GM_State_Enum.PREPARE)},e.prototype.start_game=function(){this._machine.state_change(MWN_GM_State_Enum.RUNNING)},e.prototype.end_game=function(){this._machine.state_change(MWN_GM_State_Enum.END)},e.prototype.sm_state_changed=function(t,e,i){console.log("from : "+t.state_str()+" to : "+e.state_str())},e.prototype._sm_prepare=function(){var t=this,e=3,i=10;this.layout_config.cal_layout(e,i),this.ppc._shader_offset_y=this.layout_config.shader_offset_y_max,this._game_core_view.prepare_game(),this._generate_map_layout(),this._game_core_view.room_start_painting(),console.log("========== LAYOUT =========="),console.log(this.layout_config),console.log("========== MAP =========="),console.log(this.map),this.resm=new GameCoreResManager,this.taling_resm=new TalingResManager,this.resm.load_res(function(){t.taling_resm.load_res(function(){appm.game_res_prepare_success()})}),this.effect_resm=new EffectResLoader,this.effect_resm.load_res()},e.prototype._sm_running=function(){this.am=new GP_ActorManager,this.am.manager_init(this),this._game_core_view.start_game(),this.map.debug_generate_defenders()},e.prototype._sm_end=function(){this._dispose_res()},e.prototype.swap_scale_x=function(){this._pan_handler.swap_anim()},e.prototype.mark_perspective_needs_update=function(){this._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING&&(this.map.perspective_update(),this._game_core_view.perspective_update())},e.prototype._generate_map_layout=function(){this.map&&this.map.destroy(),this.map=new GameMap,this.map.generate_map_layout(),this.map.perspective_update()},e.prototype._dispose_res=function(){this.map&&(this.map.destroy(),this.map=null),this.am&&(this.am.destroy(),this.am=null),this._game_core_view.game_res_dispose()},e}(ns_sirius.sirius_base_object);__reflect(GamePlayCore.prototype,"GamePlayCore",["ns_sirius.IGP_StateMachineListener"]);var MapPaintingCanvas=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.game_res_dispose=function(){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null),this._dragon_display&&(this._dragon_display.dispose(),this.removeChild(this._dragon_display),this._dragon_display=null)},e.prototype.paint_room=function(t,e){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null),this._dragon_display&&(this._src_texture=t,this._dragon_display.scaleX=gp_core.layout_config.canvas_scale_x,this._dragon_display.scaleY=gp_core.layout_config.canvas_scale_y,this._dragon_display.armature.replaceTexture(this._src_texture),this.update_pp_param(e))},e.prototype.prepare_mesh=function(){var t=dragonBones.EgretFactory.factory,e=t.buildArmatureDisplay("Armature","canvas_mesh");this.addChild(e),this._dragon_display=e;var i="#define M_PI 3.1415926535897932384626433832795\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord; \n \nconst float near = 0.5;\nconst vec2 center = vec2(-1.0, 1.0);\n \nuniform float last_scale;\nuniform float offset_x;\nuniform float offset_y;\n \nuniform vec2 projectionVector;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\n \nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main(void) {\n\n    vec2 raw_pos =  (aVertexPosition / projectionVector) + center;\n   \n    //======= 先处理， 处理scale\n    raw_pos.x = raw_pos.x * last_scale;\n    raw_pos.y = raw_pos.y * last_scale + last_scale - 1.0;\n      \n    float rx = raw_pos.x;\n    float ry = raw_pos.y;\n      \n    //根据 ry [-1, 1] 映射 z 值 到  [0, m] 上 ，近平面为 x-o-y平面\n    const float m = 0.2;\n    float rz = (ry + 1.0) * 0.5 * m + offset_y * 0.1;\n    \n    float input_x = rx + offset_x;\n    float input_y = ry + offset_y;\n\n    float res_x =  (input_x * near) / (rz + near);\n    float res_y =  (input_y * near) / (rz + near);\n  \n    vec2 normal_pos = vec2(res_x, res_y);\n  \n    vec2 color_pos = aTextureCoord;  \n    color_pos.x = rx;\n    color_pos.y = ry;\n \n    gl_Position = vec4( normal_pos, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vColor = vec4(color_pos.x, color_pos.y, 0.0,1.0);\n    }\n",o="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\n\nuniform float customUniform;\n\nvoid main(void) { \n     \n    vec4 fg = texture2D(uSampler, vTextureCoord); \n    // fg += (vColor * 0.5);\n    gl_FragColor = fg;\n\n    // gl_FragColor = vColor;\n\n    // gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n}",_=new egret.CustomFilter(i,o,{offset_x:0,offset_y:0,last_scale:1});e.filters=[_],this._customFilter1=_},e.prototype.update_pp_param=function(t){this._customFilter1.uniforms.offset_x=t.ppc._shader_offset_x,this._customFilter1.uniforms.offset_y=t.ppc._shader_offset_y,this._customFilter1.uniforms.last_scale=t.ppc._shader_last_scale},e}(GC_Ele_BaseView);__reflect(MapPaintingCanvas.prototype,"MapPaintingCanvas");var MapPaintingView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.redraw=function(){gp_core.layout_config.canvas_fixed_w,gp_core.layout_config.canvas_fixed_h;this._draw_lines(),this._draw_normal_rooms(),this._draw_boss_room()},e.prototype._draw_normal_rooms=function(){for(var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.rooms.length,_=new Array(o),r=0;o>r;r++){var s=t.rooms[r],n=s.layout_info.room_pos.unique_index,a=new eui.Image;_[n]=a,a.fillMode=egret.BitmapFillMode.SCALE,a.width=s.layout_info.view_w*e,a.height=s.layout_info.view_h*i,a.x=s.layout_info.view_pos.x*e,a.y=s.layout_info.view_pos.y*i,this.addChild(a),n%7==0?a.source="room_battle_png":n%7==2?a.source="room_f_png":a.source="room_blank_png"}},e.prototype._draw_boss_room=function(){var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.get_boss_room(),_=new eui.Image;_.source="room_boss_png",_.width=o.layout_info.view_w*e,_.height=o.layout_info.view_h*i,_.x=o.layout_info.view_pos.x*e,_.y=o.layout_info.view_pos.y*i,this.addChild(_),_.fillMode=egret.BitmapFillMode.SCALE},e.prototype._draw_lines=function(){for(var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=gp_core.layout_config.row_count,_=gp_core.layout_config.column_count,r=5,s=gp_core.layout_config.column_gap+2*r,n=Math.ceil(.5*s),a=gp_core.layout_config.row_gap+2*r,l=Math.ceil(.5*a),c=0;o>c;c++)for(var u=0;_>u;u++){var h=gp_core.layout_config.rowcolumn_to_uindex(c,u),p=t.rooms[h];if(u!=_-1){var d=new egret.Point(p.layout_info.view_pos.x+p.layout_info.view_w-r,p.layout_info.center_pos.y),f=new eui.Image("line_horizontal_png");
f.fillMode=egret.BitmapFillMode.SCALE,f.width=s*e,f.height=n*i,f.x=d.x*e,f.y=(d.y-.5*n)*i,this.addChild(f)}if(c!=o-1){var m=new egret.Point(p.layout_info.center_pos.x,p.layout_info.view_pos.y+p.layout_info.view_h-r),y=new eui.Image("line_vertical_png");y.fillMode=egret.BitmapFillMode.SCALE,y.width=l*e,y.height=a*i,y.x=(m.x-.5*l)*e,y.y=m.y*i,this.addChild(y)}}},e}(GC_Ele_BaseView);__reflect(MapPaintingView.prototype,"MapPaintingView");var GC_CharacterAnimState=function(){function t(){}return t.IDLE=0,t.MOVING=1,t.ATTACKING=2,t.DYING=4,t}();__reflect(GC_CharacterAnimState.prototype,"GC_CharacterAnimState");var GC_CharacterView=function(t){function e(){var e=t.call(this)||this;e._fixed_scale_x=1,e._fixed_scale_y=1,e._current_anim_state=-1,e._attack_trigger=!1,e._debug_flag=!1,e._character_x=0;var i=new egret.Bitmap(RES.getRes("character_shadow_png"));e.addChild(i),i.x=.5*-i.width,i.y=.5*-i.height,e._shadow=i,e._dmg_pool_size=3,e._dmg_pool=new ns_sirius.rotational_deprived_fixed_pool(3),e._dmg_pool.pool_init(DmgTxt);var o=[1,0,0,0,0,0,.6,0,0,0,0,0,.6,0,0,0,0,0,1,0];return e._vibration_filter=new egret.ColorMatrixFilter(o),e._vibration_comp=new GCCV_vibration(e,null,1).init(),e._stride_comp=new GCCV_stride(null,null,2).init(),e._death_comp=new GCCV_death(e,null,3).init(),e}return __extends(e,t),e.prototype._before_destroy=function(){if(this._character_display){var t=dragonBones.WorldClock.clock;t.remove(this._character_display.armature),this._character_display.animation.stop(),this._character_display.removeEvent(dragonBones.EgretEvent.COMPLETE,this._animation_play_end,this),this._character_display.removeEvent(dragonBones.EgretEvent.ANIMATION_FRAME_EVENT,this._ANIM_FRAME_EVENT,this),this._character_display.armature.dispose(),this._character_display.dispose(),this._character_display=null}for(var e=0;e<this._dmg_pool_size;e++)this._dmg_pool.get_stack()[e].destroy();this._dmg_pool.destroy(),this._dmg_pool=null,this.removeChild(this._health_view),this._health_view=null,this._binded_entity=null,this._vibration_comp.destroy(),this._vibration_comp=null,this._stride_comp.destroy(),this._stride_comp=null,this._death_comp.destroy(),this._death_comp=null,this.remove_from_parent()},e.prototype._cal_health_y=function(){var t=0,e=this._character_display.armature.getSlot("root_boundingBox");if(e){var i=e.origin.scaleY,o=e.boundingBoxData;t=-o.height*i-CharacterHealthView.health_height}return t},e.prototype._get_anim_res=function(t){var e=0,i=null;return t.character_type()==GameCharacterType.Boss?(gp_core.taling_resm.res_count>1&&(e=Math.floor(Math.random()*(gp_core.taling_resm.res_count-.5))),i=gp_core.taling_resm.get_res_by_index(e)):(gp_core.resm.res_count>1&&(e=Math.floor(Math.random()*(gp_core.resm.res_count-.5))),i=gp_core.resm.get_res_by_index(e)),this._res_index=e,i},e.prototype.bind_entity=function(t){this._binded_entity=t;var e=this._get_anim_res(t);if(e){this._init_character_anim(e),this._health_view=new CharacterHealthView,this.addChild(this._health_view),this._health_view.x=-25;var i=this._cal_health_y();this._health_view.y=i;for(var o=0;o<this._dmg_pool_size;o++)this._dmg_pool.get_stack()[o].y=.5*i}},e.prototype._init_character_anim=function(t){var e=dragonBones.EgretFactory.factory,i=e.buildArmatureDisplay(t.armature_name,t.character_name);this.addChild(i),dragonBones.WorldClock.clock.add(i.armature),i.scaleX=this._fixed_scale_x,i.scaleY=this._fixed_scale_y,this._character_display=i,this._character_display.addEvent(dragonBones.EgretEvent.COMPLETE,this._animation_play_end,this),this._character_display.addEvent(dragonBones.EgretEvent.ANIMATION_FRAME_EVENT,this._ANIM_FRAME_EVENT,this)},e.prototype._animation_play_end=function(t){this.change_state(GC_CharacterAnimState.IDLE)},e.prototype._ANIM_FRAME_EVENT=function(t){var e=this._character_display.animation.lastAnimationState.name;e.indexOf("attack")<0||this._attack_trigger&&(this._attack_trigger=!1,this._binded_entity.target_deduct_life())},e.prototype.change_direction=function(t){0!=t&&this._character_display&&(1==t?this._character_display.scaleX=this._fixed_scale_x:2==t&&(this._character_display.scaleX=-this._fixed_scale_y))},e.prototype.update_health=function(t){this._health_view.update_prog(t)},e.prototype.play_dmg_anim=function(t){this._dmg_pool.borrow().start_anim(t,this,this._binded_entity.character_type()==GameCharacterType.Assaulter)},e.prototype.change_state=function(t){if((t!=GC_CharacterAnimState.IDLE&&t!=GC_CharacterAnimState.MOVING||t!=this._current_anim_state)&&this._character_display)switch(this._current_anim_state=t,t){case GC_CharacterAnimState.IDLE:this._character_display.animation.play("standby");break;case GC_CharacterAnimState.MOVING:this._stride_comp.stop(),this._modify_character_x(0),this._character_display.animation.play("run");break;case GC_CharacterAnimState.ATTACKING:this._character_display.animation.hasAnimation("attack_2")?(this._debug_flag=!this._debug_flag,this._debug_flag?this._character_display.animation.play("attack_1",1):this._character_display.animation.play("attack_2",1)):this._character_display.animation.hasAnimation("attack_1")&&this._character_display.animation.play("attack_1",1),this._attack_trigger=!0;break;case GC_CharacterAnimState.DYING:this._death_comp.start_die(this._binded_entity.character_type()==GameCharacterType.Assaulter),this._health_view.visible=!1,this._shadow.visible=!1;break;default:this._character_display.animation.play("standby")}},e.prototype.single_anim_comp=function(t){1==t.anim_id?this._character_display.filters=null:2==t.anim_id||3==t.anim_id&&this._binded_entity.sentence_to_death()},e.prototype.start_vibration_anim=function(){this._vibration_comp.start(),this._character_display.filters=[this._vibration_filter]},e.prototype.start_stride=function(){this._stride_comp.stride(this._binded_entity.character_type()==GameCharacterType.Assaulter)},e.prototype.update_frame=function(){var t=this._death_comp.is_animating,e=this._vibration_comp.is_animating,i=this._stride_comp.is_animating;if(this._character_display){if(t)return this._modify_character_x(this._death_comp.current_x()),this._modify_character_y(this._death_comp.current_y()),void this._modify_character_alpha(this._death_comp.current_alpha());if(!e&&!i)return void this._modify_character_x(0);var o=0;i&&(o=this._stride_comp.stride_pos());var _=o;e&&(_+=this._vibration_comp.vibration_offset),this._modify_character_x(_)}},e.prototype._modify_character_x=function(t){(0!=this._character_x||0!=t)&&(this._character_x=t,this._character_display.x=this._character_x)},e.prototype._modify_character_y=function(t){this._character_display.y=t},e.prototype._modify_character_alpha=function(t){this._character_display.alpha=t},e}(GC_Ele_BaseView);__reflect(GC_CharacterView.prototype,"GC_CharacterView",["ns_sirius.Isingle_animation_listener"]);var GCCV_death=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current_x=0,e._current_y=0,e._current_alpha=0,e._is_reverse=!1,e._x_offset=0,e}return __extends(e,t),e.prototype.animation_duration=function(){var t=1e3;return t},e.prototype._reset_anim_properties=function(){},e.prototype.current_x=function(){return this._current_x},e.prototype.current_y=function(){return this._current_y},e.prototype.current_alpha=function(){return this._current_alpha},e.prototype.start_die=function(t){this._is_animating||(this._x_offset=t?200:-200,this._is_reverse=t,this.start())},e.prototype._anim_update=function(t){var e=t,i=1-Math.pow(e-1,2);this._current_x=this._x_offset*i;var o=150,_=Math.pow(i-.5,2);this._current_y=-o+4*o*_,this._current_alpha=1-e},e}(ns_sirius.single_animation);__reflect(GCCV_death.prototype,"GCCV_death");var DmgTxt=function(t){function e(){var e=t.call(this)||this;return e._lbl_con=new egret.DisplayObjectContainer,e.addChild(e._lbl_con),e._lbl=new egret.TextField,e._lbl_con.addChild(e._lbl),e._lbl.text="",e._lbl.size=12,e._lbl.fontFamily="Comic Sans MS",e._lbl.bold=!0,e._lbl.textColor=16711806,e._lbl.stroke=1,e._lbl.strokeColor=0,e._lbl.y=-6,e._lbl.x=-18,e._anim_comp=new DmgTxtAnim(e,e._lbl_con).init(),e}return __extends(e,t),e.prototype.destroy=function(){this._lbl_con.removeChild(this._lbl),this.removeChild(this._lbl_con),this._anim_comp.destroy()},e.prototype.start_anim=function(t,e,i){this._lbl.text=t+"",e.addChild(this),this._anim_comp.start_anim(i)},e.prototype.single_anim_comp=function(t){this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(DmgTxt.prototype,"DmgTxt",["ns_sirius.Isingle_animation_listener"]);var DmgTxtAnim=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._start_scale=4,e._end_scale=1.5,e._anim_max_offset=0,e._anim_max_y_offset=0,e}return __extends(e,t),e.prototype.animation_duration=function(){var t=ns_sirius.anim_clock.frame_to_ms(40);return t},e.prototype._reset_anim_properties=function(){},e.prototype.start_anim=function(t){this._anim_max_offset=t?100:-100,this._anim_max_y_offset=-50+100*Math.random(),this.start()},e.prototype.stop=function(){t.prototype.stop.call(this)},e.prototype._anim_update=function(t){var e=this._target_view,i=t,o=Math.sqrt(1-Math.pow(i-1,2));e.x=o*this._anim_max_offset,e.y=o*this._anim_max_y_offset;var _=1.5*i;_>1&&(_=1);var r=this._start_scale+(this._end_scale-this._start_scale)*_;e.scaleX=r,e.scaleY=r},e}(ns_sirius.single_animation);__reflect(DmgTxtAnim.prototype,"DmgTxtAnim");var CharacterHealthView=function(t){function e(){var e=t.call(this)||this,i=new egret.Bitmap(RES.getRes("health_back_png"));e.addChild(i),i.scaleX=.5,i.scaleY=.5;var o=new egret.Bitmap(RES.getRes("health_front_png"));return e.addChild(o),o.scaleX=.5,o.scaleY=.5,o.y=2,o.x=2,e.raw_width=o.width,e.front=o,e}return __extends(e,t),e.prototype.update_prog=function(t){this.front.width=this.raw_width*t,this.visible=!0},e.health_height=8,e}(egret.DisplayObjectContainer);__reflect(CharacterHealthView.prototype,"CharacterHealthView");var GCCV_stride=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._stride_pos=0,e._stride_end_offset=0,e}return __extends(e,t),e.prototype.animation_duration=function(){var t=ns_sirius.anim_clock.frame_to_ms(40);return t},e.prototype.stride_pos=function(){return this._stride_pos},e.prototype.stride=function(t){this._stride_end_offset=t?-50:50,this.start()},e.prototype._anim_update=function(t){var e=t,i=Math.sqrt(1-Math.pow(e-1,2));this._stride_pos=this._stride_end_offset*i},e.prototype._reset_anim_properties=function(){this._stride_pos=0},e}(ns_sirius.single_animation);__reflect(GCCV_stride.prototype,"GCCV_stride");var GCCV_vibration=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vibration_offset=0,e}return __extends(e,t),e.prototype.animation_duration=function(){var t=ns_sirius.anim_clock.frame_to_ms(15);return t},Object.defineProperty(e.prototype,"vibration_offset",{get:function(){return this._vibration_offset},enumerable:!0,configurable:!0}),e.prototype._anim_update=function(t){var e=35,i=t,o=e-i*e,_=4*Math.PI*i,r=o*Math.sin(_);this._vibration_offset=r},e.prototype._reset_anim_properties=function(){this._vibration_offset=0},e}(ns_sirius.single_animation);__reflect(GCCV_vibration.prototype,"GCCV_vibration");var GC_MapView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.rooms_init=function(){this._born_room_init(),this._boss_room_init()},e.prototype.game_res_dispose=function(){this.boss_room&&(this.boss_room.destroy(),this.boss_room=null),this.born_room&&(this.born_room.destroy(),this.born_room=null)},e.prototype._boss_room_init=function(){var t=new GC_BossRoomView;this.boss_room=t,this.addChild(t),this._update_boss_room_pos()},e.prototype._born_room_init=function(){var t=new GC_BornRoomView;this.born_room=t,this.addChild(t),this._update_born_room_pos()},e.prototype.update_pp_param=function(){this._update_boss_room_pos(),this._update_born_room_pos()},e.prototype._update_boss_room_pos=function(){var t=gp_core.map;if(t){var e=t.get_boss_room();this.boss_room.x=e.layout_info.d3_point_local.x,this.boss_room.y=e.layout_info.d3_point_local.y,this.boss_room.scaleX=e.layout_info.d3_scale.x,this.boss_room.scaleY=e.layout_info.d3_scale.y}},e.prototype._update_born_room_pos=function(){var t=gp_core.map;if(t){var e=t.get_birth_room();this.born_room.x=e.layout_info.d3_point_local.x,this.born_room.y=e.layout_info.d3_point_local.y,this.born_room.scaleX=e.layout_info.d3_scale.x,this.born_room.scaleY=e.layout_info.d3_scale.y}},e.prototype.debug_born_pawn=function(){var t=new GC_CharacterView;return this.addChild(t),t},e}(GC_Ele_BaseView);__reflect(GC_MapView.prototype,"GC_MapView");var GC_BornRoomView=function(t){function e(){var e=t.call(this)||this;return e.load(e.createView),e}return __extends(e,t),e.prototype.createView=function(){var t=new egret.MovieClipDataFactory(this._mcData,this._mcTexture),e=new egret.MovieClip(t.generateMovieClipData("NewProject"));this.addChild(e),e.gotoAndPlay(1,-1),e.x=0,e.y=0,e.scaleX=2,e.scaleY=2},e.prototype.load=function(t){var e=this,i=0,o=this,_=function(){i++,2==i&&t.call(o)},r=new egret.URLLoader;r.addEventListener(egret.Event.COMPLETE,function(t){var i=t.currentTarget;e._mcTexture=i.data,_()},this),r.dataFormat=egret.URLLoaderDataFormat.TEXTURE;var s=new egret.URLRequest("resource/LK/game_core/portal/portal_tex.png");r.load(s);var r=new egret.URLLoader;r.addEventListener(egret.Event.COMPLETE,function(t){var i=t.currentTarget;e._mcData=JSON.parse(i.data),_()},this),r.dataFormat=egret.URLLoaderDataFormat.TEXT;var s=new egret.URLRequest("resource/LK/game_core/portal/portal_mc.json");r.load(s)},e}(GC_RoomView);__reflect(GC_BornRoomView.prototype,"GC_BornRoomView");var GC_BossRoomView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_RoomView);__reflect(GC_BossRoomView.prototype,"GC_BossRoomView");var GPC_layout_config=function(){function t(){this.row_gap=20,this.column_gap=20,this.header_gap=100,this.footer_gap=100,this.canvas_fixed_w=1024,this.canvas_fixed_h=512,this.row_count=-1,this.column_count=-1,this.shader_offset_x_min=0,this.shader_offset_x_max=0,this.shader_offset_y_min=0,this.shader_offset_y_max=0,this.canvas_scale_x=0,this.canvas_scale_y=0,this.horizontal_fixed=!1}return t.prototype.cal_layout=function(e,i){this.column_count=i,this.row_count=e,this.element_count=this.column_count*this.row_count,this.cell_w=170,this.cell_h=209,this.character_global_scale=1,t.distance_ratio_w_to_h=1,this.boss_w=3*this.cell_w,this.boss_h=this.cell_h,this.pawn_born_width=this.cell_w,this.pawn_born_height=this.cell_h,this.room_orig_x=this.boss_w+this.column_gap,this.room_orig_y=this.header_gap;var o=this.row_count*(this.cell_h+this.row_gap),_=this.column_count*(this.cell_w+this.column_gap);this.total_w=_+this.boss_w+this.pawn_born_width+2*this.column_gap,this.total_h=o+this.header_gap+this.footer_gap,this.boss_view_x=0,this.boss_view_y=.5*(this.total_h-this.row_gap)-.5*this.boss_h,this.pawn_born_x=this.total_w-.5*this.pawn_born_width,this.pawn_born_y=.5*this.total_h,this.canvas_scale_x=this.total_w/this.canvas_fixed_w,this.canvas_scale_y=this.total_h/this.canvas_fixed_h;var r=2*this.total_h/sirius.device_info.stage_height;this.shader_offset_y_max=r-2;var s=2*this.total_w/sirius.device_info.initial_optimal_w,n=.5*Math.abs(s-1);this.shader_offset_x_min=-n,this.shader_offset_x_max=n,this.pr_w_ratio=this.canvas_fixed_w/this.total_w,this.pr_h_ratio=this.canvas_fixed_h/this.total_h},t.prototype.rowcolumn_to_uindex=function(t,e){if(0>t||0>e)return-1;if(t>this.row_count-1||e>this.column_count-1)return-1;var i=t*this.column_count+e;return i},t.prototype.uindex_to_rowcolumn=function(t){if(0>t||t>this.element_count-1)return new egret.Point(-1,-1);var e=Math.floor(t/this.column_count),i=t-e*this.column_count;return new egret.Point(e,i)},t.distance_ratio_w_to_h=1,t}();__reflect(GPC_layout_config.prototype,"GPC_layout_config");var AnimRes=function(){function t(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=""),void 0===i&&(i=""),void 0===o&&(o=""),this.all_loaded=!1,this.res_id=t,this.file_key=e,this.armature_name=i,this.character_name=o}return t}();__reflect(AnimRes.prototype,"AnimRes");var CriticalResLoader=function(){function t(){var t=new Array;this._resources=t,t.push(new AnimRes(1,"canvas_mesh","",""))}return t.prototype._res_prefix=function(){return"resource/LK/game_core"},t.prototype.load_res=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o=this;return __generator(this,function(_){for(this._load_count=this._resources.length,t=0,e=this._resources;t<e.length;t++)i=e[t],this._load_ske_res(i);return[2,new Promise(function(t,e){o._cb_s=t,o._cb_f=e})]})})},t.prototype._load_ske_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_ske.json";RES.getResByUrl(i,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_tex.json";RES.getResByUrl(i,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this,i=this._res_prefix()+"/"+t.file_key+"/"+t.file_key+"_tex.png";RES.getResByUrl(i,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&(console.log("ALL loaded"),this._cb_s())},t.prototype.find_res_by_name=function(t){return this._resources[0]},t}();__reflect(CriticalResLoader.prototype,"CriticalResLoader");var EffectResLoader=function(){function t(){}return t.prototype.load_res=function(){},t}();__reflect(EffectResLoader.prototype,"EffectResLoader");var GP_ActorManager=function(t){function e(){var e=t.call(this)||this;return e._pawn_born_cursor=0,e._defenders_needs_check_death=!1,e._assaulters_needs_check_death=!1,e._assault_depth_needs_update=!1,e._actors_defence=new Array,e._actors_assault=new Array,e}return __extends(e,t),e.prototype.mark_defenders_check_death=function(){this._defenders_needs_check_death=!0},e.prototype.mark_assaulters_check_death=function(){this._assaulters_needs_check_death=!0},e.prototype.mark_assault_depth_update=function(){this._assault_depth_needs_update=!0},e.prototype._before_destroy=function(){for(var t=this._actors_defence.length,e=0;t>e;e++)this._actors_defence[e].destroy();this._actors_defence=null,t=this._actors_assault.length;for(var e=0;t>e;e++)this._actors_assault[e].destroy();this._actors_assault=null,this._actor_boss&&(this._actor_boss.destroy(),this._actor_boss=null),this._gc.stage.removeEventListener(egret.Event.ENTER_FRAME,this._gc_update,this),this._gc=null},e.prototype.manager_init=function(t){this._gc=t,this._gc.stage.addEventListener(egret.Event.ENTER_FRAME,this._gc_update,this)},e.prototype._gc_update=function(t){if(this._gc._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING){var e=this._actors_assault.length;this._pawn_born_cursor++;var i=60;if(this._pawn_born_cursor==i){this._pawn_born_cursor=0;var o=RES.getRes("cdef_debug_json");if(20>e){var _=this.born_pawn(GameCharacterType.Assaulter);_.skill_hierarchy_establish(o),_.put_on_the_map_and_run(gp_core.map.get_birth_room().layout_info.room_pos,MapRoomSlotPosition.empty_slot_pos)}}this._update_actors()}},e.prototype._update_actors=function(){var t=0;t=this._actors_defence.length;for(var e=0;t>e;e++){var i=this._actors_defence[e];i.is_dead()||this._actors_defence[e].frame_update()}t=this._actors_assault.length;for(var e=0;t>e;e++){var o=this._actors_assault[e];o.is_dead()||o.frame_update()}this._actor_boss&&this._actor_boss.frame_update(),this._defenders_needs_check_death&&(this._defenders_needs_check_death=!1,this._actors_defence=this._check_dead_actors(this._actors_defence)),this._assaulters_needs_check_death&&(this._assaulters_needs_check_death=!1,this._actors_assault=this._check_dead_actors(this._actors_assault)),this._assault_depth_needs_update&&(this._assault_depth_needs_update=!1,this._gc.map.assault_depth_update())},e.prototype.born_pawn=function(t){var e,i=this._gc._game_core_view.debug_born_pawn();return t==GameCharacterType.Defender?(e=new GamePawn_Defence,this._actors_defence.push(e)):t==GameCharacterType.Assaulter&&(e=new GamePawn_Assault,this._actors_assault.push(e)),i.bind_entity(e),e.bind_view(i),this.debug_init_battle_infop(e,t),e},e.prototype.born_boss=function(){var t=this._gc._game_core_view.debug_born_pawn(),e=new GameBossEntity;return t.bind_entity(e),e.bind_view(t),this._actor_boss=e,this.debug_init_battle_infop(e,GameCharacterType.Boss),e},e.prototype.debug_init_battle_infop=function(t,e){e==GameCharacterType.Defender?(t.md_battle.current_life=t.md_battle.total_life=1e3,t.md_battle.current_attack=Math.round(200*Math.random()),t.md_battle.accuracy=1e3,t.md_battle.dodge=1e3,t.md_battle.action_interval=1e3):e==GameCharacterType.Assaulter?(t.md_battle.current_life=t.md_battle.total_life=1200,t.md_battle.current_attack=Math.round(200*Math.random()),t.md_battle.accuracy=1e3,t.md_battle.dodge=1e3,t.md_battle.action_interval=1e3):e==GameCharacterType.Boss?(t.md_battle.current_life=t.md_battle.total_life=7e3,t.md_battle.current_attack=500,t.md_battle.accuracy=1e3,t.md_battle.dodge=1e3,t.md_battle.action_interval=1e3):console.error("ERROR !")},e.prototype._check_dead_actors=function(t){for(var e=t.length,i=new Array,o=0;e>o;o++){var _=t[o];_.is_dead()?_.destroy():i.push(_)}return i},e}(ns_sirius.sirius_base_object);__reflect(GP_ActorManager.prototype,"GP_ActorManager");var TalingResManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._config_file_name=function(){return"taling_config_json"},e.prototype._res_prefix=function(){return"resource/LK/game_core/taling"},e}(GameCoreResManager);__reflect(TalingResManager.prototype,"TalingResManager");var GameUIView=function(t){function e(){var e=t.call(this)||this;return e.visible=!1,e.mark_as_fullfill(),e.topView=new GameUIViewTop,e.addChild(e.topView),e.topView.top=0,e.topView.left=0,e.topView.right=0,e.topView.height=408.25,e.bottomView=new GameUIViewBottom,e.addChild(e.bottomView),e.bottomView.bottom=0,e.bottomView.left=0,e.bottomView.right=0,e.bottomView.height=198.8,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.btn_debug_click2=function(t){sirius.view_manager.show_popup_text_msg("你点击了 GameUIView 上的按钮")},e}(ns_sirius.sirius_view_base);__reflect(GameUIView.prototype,"GameUIView");var GameUIViewBottom=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/ZL/skins/bottom/GameUIViewBottom.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),console.log(this.group_skill),this.skill.height=90*COMMON_consts.scaleW,this.skill.count.size=COMMON_consts.font_size_22,this.skill.total.size=COMMON_consts.font_size_22,this.group_skill_01.count.size=this.group_skill_02.count.size=this.group_skill_03.count.size=this.group_skill_04.count.size=COMMON_consts.font_size_18,this.group_skill_01.height=this.group_skill_02.height=this.group_skill_03.height=this.group_skill_04.height=88*COMMON_consts.scaleW,this.skill.count.text="10",this.skill.total.text="10",this.group_skill_01.image.source="bottom_button_skill01",this.group_skill_01.count.text="2",this.group_skill_02.image.source="bottom_button_skill02",this.group_skill_03.image.source="bottom_button_skill03",this.group_skill_04.image.source="bottom_button_skill04",this.group_skill_01.index=0,this.group_skill_02.index=1,this.group_skill_03.index=2,this.group_skill_04.index=3,this.group_skill_01.touchEnabled=!0,this.group_skill_02.touchEnabled=!0,this.group_skill_03.touchEnabled=!0,this.group_skill_04.touchEnabled=!0,this.group_skill_01.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_02.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_03.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_04.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this)},e.prototype.skillClick=function(t){var e=t.target,i=parseInt(e.count.text);if(!(0>=i)){i--,e.count.text=i+"";var o=e.index;switch(o){case 0:console.log("bottom 1");break;case 1:console.log("bottom 2");break;case 2:console.log("bottom 3");break;case 3:console.log("bottom 4")}}},e}(eui.Component);__reflect(GameUIViewBottom.prototype,"GameUIViewBottom",["eui.UIComponent","egret.DisplayObject"]);var GameUIViewTop=function(t){function e(){var e=t.call(this)||this;return e.debug_flag=!1,e.skinName="resource/ZL/skins/top/GameUIViewTop.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),console.log(this.btn_area),this.progress.label.size=COMMON_consts.font_size_22,this.coin.label.size=COMMON_consts.font_size_22,this.times.label.size=COMMON_consts.font_size_22,this.btn_area.$children[1].size=COMMON_consts.font_size_22,this.btn_x.$children[1].size=COMMON_consts.font_size_22,this.btn_auto.$children[1].size=COMMON_consts.font_size_22,this.btn_area.touchEnabled=!0,this.btn_area.currentState="goFar",this.btn_area.addEventListener(egret.TouchEvent.TOUCH_TAP,this.areaClick,this),this.btn_x.touchEnabled=!0,this.btn_x.currentState="x1",this.btn_x.addEventListener(egret.TouchEvent.TOUCH_TAP,this.xClick,this),this.btn_auto.touchEnabled=!0,this.btn_auto.currentState="auto",this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,this.autoClick,this),this.setProgress(200,320),this.coin.icon.source="top_icon_gold",this.coin.label.text="55",this.times.icon.source="top_icon_task",this.times.label.text="X5"},e.prototype.setProgress=function(t,e){this.progress.label.text=t+"\\"+e;var i=t/e;this.progress.value=100*i},e.prototype.areaClick=function(){gp_core.swap_scale_x(),console.log(this.btn_area),"goFar"==this.btn_area.currentState?this.btn_area.currentState="goNear":this.btn_area.currentState="goFar"},e.prototype.xClick=function(){"x1"==this.btn_x.currentState?(gp_core.modify_global_speed(1),this.btn_x.currentState="x2"):(gp_core.modify_global_speed(0),this.btn_x.currentState="x1")},e.prototype.autoClick=function(){this.debug_flag=!this.debug_flag,this.debug_flag?sirius.view_manager.show_module("GameWin"):sirius.view_manager.pop_top_module(),"auto"==this.btn_auto.currentState?this.btn_auto.currentState="handMove":this.btn_auto.currentState="auto"},e}(eui.Component);__reflect(GameUIViewTop.prototype,"GameUIViewTop",["eui.UIComponent","egret.DisplayObject"]);var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.BottomSkill=e,__reflect(e.prototype,"game.BottomSkill")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);t.BottomSkillItem=e,__reflect(e.prototype,"game.BottomSkillItem")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.TopCoin=e,__reflect(e.prototype,"game.TopCoin")}(game||(game={}));var LocalizationManager=function(){function t(){}return t.prototype._retrieve_string_set=function(t,e){var i="ui_local_"+t+"_"+e+"_json";return RES.getRes(i)},t.prototype.choose_language=function(t){this.lan_key=t,this.COMMON=this._retrieve_string_set("common",t),this.LK=this._retrieve_string_set("lk",t),this.YXY=this._retrieve_string_set("yxy",t),this.ZL=this._retrieve_string_set("zl",t)},t.prototype.s=function(t,e,i){return void 0===i&&(i="COMMON"),this[i][t][e]},t.prototype.s1=function(t,e,i,o){void 0===o&&(o="COMMON");var _=this[o][t][e],r=_.replace("@{0}",i);return r},t.prototype.sn=function(t,e,i,o){void 0===o&&(o="COMMON");for(var _=this[o][t][e],r=_,s=i.length,n=0;s>n;n++)r=r.replace("@{"+n+"}",i[n]);return r},t}();__reflect(LocalizationManager.prototype,"LocalizationManager");var GameCorePanHandler=function(t){function e(){var e=t.call(this)||this;return e._scale_is_anim=!1,e._anim_count=20,e._anim_cursor=0,e._start_ox=0,e._start_mouse_x=0,e._start_oy=0,e._start_mouse_y=0,e}return __extends(e,t),e.prototype.core_init=function(t,e){this._gc=t,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouse_down,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouse_move,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.mouse_up,this),e.addEventListener(egret.Event.ENTER_FRAME,this._handle_update,this)},e.prototype.swap_anim=function(){this._scale_is_anim||(this._anim_cursor=0,this._gc.layout_config.horizontal_fixed=!this._gc.layout_config.horizontal_fixed,this._start_scale=this._gc.ppc._shader_last_scale,this._end_scale=this._gc.layout_config.horizontal_fixed?.6:1,this._scale_step=this._end_scale-this._start_scale,this._start_offset_x=this._gc.ppc._shader_offset_x,this._gc.ppc._shader_offset_x=0,this._end_offset_x=0,this._offsetx_step=this._end_offset_x-this._start_offset_x,this._scale_is_anim=!0)},e.prototype._handle_update=function(t){if(this._scale_is_anim){var e=1e3*this._anim_cursor/this._anim_count/1e3,i=this._start_scale+e*this._scale_step,o=this._start_offset_x+e*this._offsetx_step;this._gc.ppc._shader_offset_x=o,this._gc.ppc._shader_last_scale=i,this._gc.mark_perspective_needs_update(),this._anim_cursor++,this._anim_cursor>=this._anim_count&&(this._scale_is_anim=!1)}},e.prototype.mouse_down=function(t){this._scale_is_anim||(this._start_mouse_x=t.stageX,this._start_ox=this._gc.ppc._shader_offset_x,this._start_mouse_y=t.stageY,this._start_oy=this._gc.ppc._shader_offset_y)},e.prototype.mouse_move=function(t){this._scale_is_anim||(this._move_x(t),this._move_y(t),this._gc.mark_perspective_needs_update())},e.prototype._move_x=function(t){if(this._gc.layout_config.horizontal_fixed)return void(this._gc.ppc._shader_offset_x=0);var e=t.stageX-this._start_mouse_x,i=this._start_ox+.003*e;i>gp_core.layout_config.shader_offset_x_max?i=gp_core.layout_config.shader_offset_x_max:i<gp_core.layout_config.shader_offset_x_min&&(i=gp_core.layout_config.shader_offset_x_min),this._gc.ppc._shader_offset_x=i},e.prototype._move_y=function(t){var e=t.stageY-this._start_mouse_y,i=this._start_oy-.004*e;i>gp_core.layout_config.shader_offset_y_max?i=gp_core.layout_config.shader_offset_y_max:i<gp_core.layout_config.shader_offset_y_min&&(i=gp_core.layout_config.shader_offset_y_min),this._gc.ppc._shader_offset_y=i},e.prototype.mouse_up=function(t){},e}(egret.HashObject);__reflect(GameCorePanHandler.prototype,"GameCorePanHandler");var PerspectiveCore=function(){function t(){this.buffer_point_2d_glboal=new egret.Point,this.buffer_point_3d_glboal=new egret.Point,this._shader_offset_x=0,this._shader_offset_y=0,this._shader_last_scale=1}return t.prototype.core_init=function(t,e){this._stage=t,this._ref_view=e},t.prototype.convert_2_to_3_global=function(t,e,i){var o=.2,_=.5,r=this._stage.stageWidth,s=this._stage.stageHeight,n=2*t.x/r-1,a=2*-t.y/s+1,l=n*this._shader_last_scale,c=a*this._shader_last_scale+this._shader_last_scale-1,u=.5*(c+1)*o+.1*this._shader_offset_y,h=l+this._shader_offset_x,p=c+this._shader_offset_y,d=h*_/(u+_),f=p*_/(u+_);i&&(i.x=this._shader_last_scale*_/(u+_),i.y=i.x),e.x=(d+1)*r*.5,e.y=-(f-1)*s*.5},t.prototype.cal_3d_pos=function(t,e,i){this._ref_view.localToGlobal(t.x,t.y,this.buffer_point_2d_glboal),this.convert_2_to_3_global(this.buffer_point_2d_glboal,this.buffer_point_3d_glboal,i),this._ref_view.globalToLocal(this.buffer_point_3d_glboal.x,this.buffer_point_3d_glboal.y,e)},t}();__reflect(PerspectiveCore.prototype,"PerspectiveCore");var MWN_GM_State_Enum=function(){function t(){}return t.DEFAULT=0,t.IDLE=1,t.PREPARE=2,t.RUNNING=3,t.END=5,t}();__reflect(MWN_GM_State_Enum.prototype,"MWN_GM_State_Enum");var MWN_machine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._s_idle&&(this._s_idle.destroy(),this._s_idle=null),this._s_prepare&&(this._s_prepare.destroy(),this._s_prepare=null),this._s_running&&(this._s_running.destroy(),this._s_running=null),this._s_end&&(this._s_end.destroy(),this._s_end=null),t.prototype._before_destroy.call(this)
},e.prototype._states_init=function(t){this._s_idle=new GP_State_IDLE,this._s_idle.state_init(this,t),this._s_prepare=new GP_State_PREPARE,this._s_prepare.state_init(this,t),this._s_running=new GP_State_RUNNING,this._s_running.state_init(this,t),this._s_end=new GP_State_END,this._s_end.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case MWN_GM_State_Enum.IDLE:return this._s_idle;case MWN_GM_State_Enum.PREPARE:return this._s_prepare;case MWN_GM_State_Enum.RUNNING:return this._s_running;case MWN_GM_State_Enum.END:return this._s_end;default:return this._s_default}},e}(ns_sirius.GP_StateMachine);__reflect(MWN_machine.prototype,"MWN_machine");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var _=RES.getRes(t);_?o(_):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GP_State_END=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.END},e.prototype.state_str=function(){return"END"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_end(),this._machine.state_change(MWN_GM_State_Enum.IDLE)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_END.prototype,"GP_State_END");var GP_State_IDLE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.IDLE},e.prototype.state_str=function(){return"IDLE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_IDLE.prototype,"GP_State_IDLE");var COMMON_consts=function(){function t(){}return t.generate_consts=function(){t.scaleW=sirius.device_info.safe_width/sirius.device_info.design_width,t.font_size_22=22*t.scaleW,t.font_size_18=18*t.scaleW,t.font_size_32=32*t.scaleW,t.font_size_24=24*t.scaleW,t.font_size_30=30*t.scaleW,t.font_size_26=26*t.scaleW},t}();__reflect(COMMON_consts.prototype,"COMMON_consts");var GP_State_PREPARE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.PREPARE},e.prototype.state_str=function(){return"PREPARE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_prepare()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_PREPARE.prototype,"GP_State_PREPARE");var GP_State_RUNNING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.RUNNING},e.prototype.state_str=function(){return"RUNNING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_running()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_RUNNING.prototype,"GP_State_RUNNING");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.mm=new t.module_marshal,i.layes=new t.layer_partition,i.sirius_public=new t.SiriusPublic,i}return __extends(i,e),i.prototype.core_init=function(){this.mm.core_init(this),this.layes.core_init(this),this.sirius_public.core_init(this)},i}(t.sirius_base_object);t.SiriusCore=e,__reflect(e.prototype,"ns_sirius.SiriusCore")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.view_manager=new t.app_vh_manager,i.device_info=new t.sirius_device_info,i}return __extends(i,e),i.prototype.core_init=function(t){this._sirius=t,this.view_manager.core_init(t)},i.prototype.debug_foo=function(){this.view_manager.show_popup_text_msg("You are connected to the sirius hierarchy.")},i}(t.sirius_element_module);t.SiriusPublic=e,__reflect(e.prototype,"ns_sirius.SiriusPublic")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(){this._animatebles=new Array,this._timeScale=1}return t.frame_to_ms=function(t){return Math.round(1e3*t/60)},Object.defineProperty(t.prototype,"time_scale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(1!==this._timeScale&&(t*=this._timeScale),0>=t)throw"passedTime should not be negative";for(var e=0,i=0,o=this._animatebles.length;o>e;++e){var _=this._animatebles[e];null!==_?(i>0&&(this._animatebles[e-i]=_,this._animatebles[e]=null),_.update(t)):i++}if(i>0){for(o=this._animatebles.length;o>e;++e){var r=this._animatebles[e];null!==r?this._animatebles[e-i]=r:i++}this._animatebles.length-=i}},t.prototype.add=function(t){t&&this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.removeAt=function(t){t>=0&&(this._animatebles[t].clock=null,this._animatebles[t]=null)},t}();t.anim_clock=e,__reflect(e.prototype,"ns_sirius.anim_clock"),t.world_clock=new e}(ns_sirius||(ns_sirius={}));var sirius,gp_core,appm,AppRootView=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.width=sirius.device_info.design_width,e.height=sirius.device_info.design_height,e.horizontalCenter=0,e.top=0,e}return __extends(e,t),e}(ns_sirius.sirius_view_base);__reflect(AppRootView.prototype,"AppRootView",["ns_sirius.Isirius_app_root_view"]);var Main=function(t){function e(){var e=t.call(this)||this;return e._debug_flag=!1,e._debug_index=0,appm=new AppModel,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.load_crit_res().then(function(t){e.createGameScene()},function(t){console.log(t)})},e.prototype.load_crit_res=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[4,appm.crit_loader.load_res()];case 2:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,12,,13]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadConfig("resource/COMMON/COMMON.res.json","resource/")];case 2:return i.sent(),[4,RES.loadConfig("resource/ZL/ZL.res.json","resource/")];case 3:return i.sent(),[4,RES.loadConfig("resource/YXY/YXY.res.json","resource/")];case 4:return i.sent(),[4,RES.loadConfig("resource/LK/LK.res.json","resource/")];case 5:return i.sent(),[4,this.loadTheme()];case 6:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 7:return i.sent(),[4,RES.loadGroup("COMMON",0,t)];case 8:return i.sent(),[4,RES.loadGroup("ZL",0,t)];case 9:return i.sent(),[4,RES.loadGroup("YXY",0,t)];case 10:return i.sent(),[4,RES.loadGroup("LK",0,t)];case 11:return i.sent(),this.stage.removeChild(t),[3,13];case 12:return e=i.sent(),console.error(e),[3,13];case 13:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype._syn_stage_size=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;sirius.device_info.syn_stage_size(t,e)},e.prototype._resize_handler=function(t){this._syn_stage_size(),this._app_root_view.width=sirius.device_info.safe_width,gp_core.mark_perspective_needs_update()},e.prototype.createGameScene=function(){var t=new ns_sirius.SiriusCore;t.core_init(),sirius=t.sirius_public,this._syn_stage_size(),sirius.device_info.device_info_init(),COMMON_consts.generate_consts(),gp_core=new GamePlayCore,gp_core.core_init(this.stage);var e=new GameCoreView;this.addChild(e),gp_core.register_core_view(e,e.get_coord_convert_ref_view()),this._app_root_view=new AppRootView,this.addChild(this._app_root_view);var i=new GameUIView;this._app_root_view.addChild(i),sirius.view_manager.view_hierarchy_establish(this._app_root_view),this.addEventListener(egret.Event.RESIZE,this._resize_handler,this),this._resize_handler(null),appm.app_init()},e.prototype.onButtonClick=function(t){sirius.view_manager.show_module("TestABC"),console.log(appm.lm.s("gamewin","jump","YXY"))},e.prototype.btn_debug_click2=function(t){gp_core.resm.remove_all_data()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ns_sirius;!function(t){var e=function(e){function i(t,i,o){void 0===t&&(t=null),void 0===i&&(i=0),void 0===o&&(o=null);var _=e.call(this)||this;return _._listener=t,_.timer_id=i,_._param=o,_}return __extends(i,e),i.prototype.init=function(t){return void 0===t&&(t=null),this.timer_active(),this},i.prototype.timer_active=function(e){void 0===e&&(e=null),e?e.add(this):t.world_clock.add(this)},i.prototype.timer_deactive=function(){this._clock&&this._clock.remove(this)},i.prototype._before_destroy=function(){this.stop(),this._clock&&this._clock.remove(this),this._clock=null,this._listener=null,this._param=null},Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"is_animating",{get:function(){return this._is_animating},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tick_cursor",{get:function(){return this._tick_cursor},enumerable:!0,configurable:!0}),i.prototype.start=function(t,e,i,o){return void 0===i&&(i=0),void 0===o&&(o=!1),this._normalized_time=0,this._real_time=0,this._tick_cursor=0,this._is_animating=!0,this._anim_duration=t,this._loop_count=e,o?this._tick_once():i>0&&(this._real_time+=i),this},i.prototype.stop=function(){this._is_animating=!1},i.prototype.update=function(t){this._is_animating&&(this._real_time+=t,this._normalized_time=this._real_time/this._anim_duration,this._normalized_time<1||(this._tick_once(),this._loop_count<=0||this._tick_cursor>=this._loop_count&&(this.stop(),this._post_finish())))},i.prototype._tick_once=function(){this._normalized_time=0,this._real_time=0,this._listener.rtimer_tick(this),this._tick_cursor++},i.prototype._post_finish=function(){this._listener.rtimer_finish(this)},i}(t.sirius_base_object);t.timer_rtime_based=e,__reflect(e.prototype,"ns_sirius.timer_rtime_based",["ns_sirius.IAnimatable"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.design_width=1136,e.design_height=640,e.stage_width=0,e.stage_height=0,e.safe_width=0,e.safe_height=0,e.initial_optimal_w=0,e}return __extends(e,t),e.prototype.syn_stage_size=function(t,e){this.stage_width=t,this.stage_height=e,this.safe_height=e,this.safe_width=t>this.design_width?this.design_width:t},e.prototype.device_info_init=function(){var t=Math.ceil(1125*this.design_height/2436);this.stage_width>=this.design_width?this.initial_optimal_w=this.design_width:this.initial_optimal_w=t},e}(t.sirius_base_object);t.sirius_device_info=e,__reflect(e.prototype,"ns_sirius.sirius_device_info")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return"Default"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(t.GP_StateBase);t.GP_State_Default=e,__reflect(e.prototype,"ns_sirius.GP_State_Default")}(ns_sirius||(ns_sirius={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function _(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var n=t.split("/");n.pop();var a=n.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(o,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,_,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.establish_reflection_table(),e}return __extends(e,t),e.prototype.establish_reflection_table=function(){this._rtable=lk_rtable.concat(yxy_rtable).concat(zl_rtable);for(var t=this._rtable.length,e=0;t>e;e++)this._rtable[e].index=e},e.prototype.register_sm=function(t){this._sm=t},e.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null);var _=this._find_module_by_name(t);if(!_)return void console.error("不存在模块 ： "+t);var r=new _.vm,s=new _.view;this._sm.show_module(s,r,e,i,o)},e.prototype.show_sub_module=function(t,e,i,o,_){void 0===i&&(i=null),void 0===o&&(o=null),void 0===_&&(_=null);var r=this._find_module_by_name(t);if(!r)return void console.error("不存在模块 ： "+t);var s=new r.vm,n=new r.view;this._sm.show_sub_module(n,s,e,i,o,_)},e.prototype.show_sub_module_init=function(t,e,i,o,_,r){void 0===o&&(o=null),void 0===_&&(_=null),void 0===r&&(r=null),this._sm.show_sub_module(t,e,i,o,_,r)},e.prototype._find_module_by_name=function(t){if(!this._rtable)return null;for(var e=this._rtable.length,i=0;e>i;i++){var o=this._rtable[i];if(o.module_name==t)return o}return null},e}(t.sirius_element_module);t.module_marshal=e,__reflect(e.prototype,"ns_sirius.module_marshal")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e}return __extends(e,t),e}(t.sirius_view_base);t.sirius_root_layer=e,__reflect(e.prototype,"ns_sirius.sirius_root_layer");var i=function(i){function o(){return i.call(this)||this}return __extends(o,i),o.prototype.view_hierarchy_establish=function(e){this._app_root_view=e;var i=t.app_layer_def,o=i.length;this.sms=new Array(o);for(var _=0;o>_;_++){var r=i[_],s=this._create_layer_by_def(r);this.sms[_]=s}},o.prototype._create_layer_by_def=function(i){var o=new e;this._app_root_view.addChild(o),o.update_visible(!1),i.disable_touch&&(o.touchEnabled=!1);var _=null;return _=i.exclusive?new t.layer_exclusive_manager:1==i.sm_type?new t.layer_module_sm:new t.layer_stack_manager,_.manager_init(o,i.lid,this._sirius),_},o}(t.sirius_element_module);t.layer_partition=i,__reflect(i.prototype,"ns_sirius.layer_partition")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_visible=!1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype.attach_target_view=function(t){this._target_view=t},e.prototype.show=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),this._is_visible=!0,this._root_view.addChild(this._target_view),this._target_view.attached_to_display_tree(t),this._update_container_visible(),this._target_view},e.prototype.hide=function(){this._is_visible=!1,this._target_view.detaching_from_display_tree(),this._target_view.remove_from_parent(),this._update_container_visible()},e.prototype.clear_all=function(){this.hide()},e.prototype._update_container_visible=function(){this._root_view.update_visible(this._is_visible)},e}(t.sirius_base_object);t.layer_exclusive_manager=e,__reflect(e.prototype,"ns_sirius.layer_exclusive_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show_module=function(t,e,i,o,_){return void 0===i&&(i=null),void 0===o&&(o=null),void 0===_&&(_=null),this._root_view.addChild(t),t.attached_to_display_tree(i),e.vm_pre_init(o,t,this._sirius),t.view_pre_init(i,e,this._sirius),t.view_init(),e.vm_init(),this._s_push(e),this._update_container_visible(),t},e.prototype.show_sub_module=function(t,e,i,o,_,r){return void 0===o&&(o=null),void 0===_&&(_=null),void 0===r&&(r=null),i.addChild(t),t.attached_to_display_tree(o),e.vm_pre_init(_,t,this._sirius),t.view_pre_init(o,e,this._sirius),t.view_init(),e.vm_init(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t],i=e.pair_view;i.detaching_from_display_tree(),i.destroy(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_shift(),this._update_container_visible()},e}(t.layer_stack_manager);t.layer_module_sm=e,__reflect(e.prototype,"ns_sirius.layer_module_sm")}(ns_sirius||(ns_sirius={}));var AppModel=function(){function t(){this.crit_loader=new CriticalResLoader}return Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),t.prototype.app_init=function(){this.lm=new LocalizationManager,this.lm.choose_language("cn"),sirius.view_manager.switch_global_loading(!0),gp_core.prepare_game()},t.prototype.game_res_prepare_success=function(){sirius.view_manager.switch_global_loading(!1),gp_core.start_game()},t.prototype._post_login_req=function(){var t=this,e={userName:"hongang",socialId:"88888",headUrl:"from"};(new ns_sirius.common_req).post_fullurl("http://47.90.211.44:6001/user/login",e).then(function(e){sirius.view_manager.show_popup_text_msg("登录成功"),console.log("======= 登录成功 ======="),t._token=e.v.user.token,t._retrieve_map()},function(t){sirius.view_manager.switch_global_loading(!1),sirius.view_manager.show_popup_text_msg("登录失败"),console.log("======= 登录失败 =======")})},t.prototype._retrieve_map=function(){var t={token:this._token};(new ns_sirius.common_req).post("game/info",t).then(function(t){sirius.view_manager.switch_global_loading(!1),sirius.view_manager.show_popup_text_msg("获取游戏配置成功"),console.log("======= 获取游戏配置成功 ======="),gp_core.prepare_game()},function(t){sirius.view_manager.switch_global_loading(!1),sirius.view_manager.show_popup_text_msg("获取游戏配置失败"),console.log("======= 获取游戏配置失败 =======")})},t}();__reflect(AppModel.prototype,"AppModel");var BattleBehavior=function(t){function e(e,i){var o=t.call(this,e,i)||this;o._is_active=!1;var _=60+Math.ceil(40*Math.random());return o._interval=ns_sirius.anim_clock.frame_to_ms(_),o._timer=new ns_sirius.timer_rtime_based(o),o}return __extends(e,t),e.prototype.get_target_character=function(){return this._target_character},e.prototype._before_destroy=function(){this._timer.destroy(),this._timer=null,this._character=null,this._target_character=null,t.prototype._before_destroy.call(this)},e.prototype.behavior_active=function(){this._timer.timer_active()},e.prototype.behavior_deactive=function(){this._timer.timer_deactive()},e.prototype._start_new_attack_round=function(){this._character.character_type()==GameCharacterType.Defender?this._timer.start(this._interval,0,.5*this._interval):this._timer.start(this._interval,0)},e.prototype.active=function(t){this._target_character=t,this._is_active||this._start_new_attack_round(),this._is_active=!0},e.prototype.deactive=function(){this._is_active=!1,this._target_character=null},e.prototype.target_deduct_life=function(){this._is_active&&this._target_character.deduct_life(this._character.md_battle.current_attack)},e.prototype.rtimer_tick=function(t){this._is_active&&(this._character._binded_view.start_stride(),this._character._binded_view.change_state(GC_CharacterAnimState.ATTACKING))},e}(Character_Behavior);__reflect(BattleBehavior.prototype,"BattleBehavior",["ns_sirius.Itimer_rtime_based_listener"]);var Move_Behavior_Anim=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.current_pos_3d=new egret.Point,e.current_scale_3d=new egret.Point,e._cur_pos_2d=new egret.Point,e._from_pos=new egret.Point,e._to_pos=new egret.Point,e}return __extends(e,t),e.prototype.animation_duration=function(){return 0},e.prototype._reset_anim_properties=function(){},e.prototype.start_move=function(t){this.start(),this._anim_duration=t},e.prototype._anim_update=function(t){this._cur_pos_2d.x=this._from_pos.x+(this._to_pos.x-this._from_pos.x)*t,this._cur_pos_2d.y=this._from_pos.y+(this._to_pos.y-this._from_pos.y)*t,gp_core.ppc.cal_3d_pos(this._cur_pos_2d,this.current_pos_3d,this.current_scale_3d)},e}(ns_sirius.single_animation);__reflect(Move_Behavior_Anim.prototype,"Move_Behavior_Anim");var ns_sirius;!function(t){t.sirius_network_consts={protocol:"http",host_address:"47.90.211.44:6002"}}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(t){void 0===t&&(t=!0),this.should_parse_json=t}return t}();t.common_req_param=e,__reflect(e.prototype,"ns_sirius.common_req_param");var i=function(i){function o(t){void 0===t&&(t=null);var o=i.call(this)||this;return o._req_param=null,t?o._req_param=t:o._req_param=new e,o}return __extends(o,i),o.prototype._before_destroy=function(){this._req_param=null,this._cb_s=null,this._cb_f=null},o.prototype._handle_fail=function(t){this._cb_f&&this._cb_f(t),this.destroy()},o.prototype._handle_success=function(t){this._cb_s&&this._cb_s(t),this.destroy()},o.prototype.generate_expire=function(){this._expire_dis=new t.DelayDispatcher,this._expire_dis.dispatch(2e4,this,this.handle_req_expired)},o.prototype.handle_req_expired=function(){this._handle_fail("expire")},o.prototype.clear_expire=function(){this._expire_dis&&(this._expire_dis.destroy(),this._expire_dis=null)},o.prototype._combine_url=function(e){var i=t.sirius_network_consts.protocol+"://"+t.sirius_network_consts.host_address+"/"+e;return i},o.prototype.get=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t?(this._url_str=this._combine_url(t),[2,new Promise(function(t,i){e._cb_s=t,e._cb_f=i,e._send_get(e._url_str)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype.post_fullurl=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var i,o=this;return __generator(this,function(_){return t?(i=JSON.stringify(e),this._url_str=t,[2,new Promise(function(t,e){o._cb_s=t,o._cb_f=e,o._send_post(o._url_str,i)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype.post=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var i,o=this;return __generator(this,function(_){return t?(i=JSON.stringify(e),this._url_str=this._combine_url(t),[2,new Promise(function(t,e){o._cb_s=t,o._cb_f=e,o._send_post(o._url_str,i)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype._send_get=function(t){this.generate_expire();var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.open(t,egret.HttpMethod.GET),e.send(),e.addEventListener(egret.Event.COMPLETE,this.comp,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype._send_post=function(t,e){this.generate_expire();var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(t,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json"),e?i.send(e):i.send(),i.addEventListener(egret.Event.COMPLETE,this.comp,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype.comp=function(t){this.clear_expire();var e=(this._url_str,t.currentTarget),i=e.response;if(this._req_param.should_parse_json){var o=JSON.parse(i);this._handle_success(o)}else this._handle_success(i)},o.prototype.fail=function(t){this.clear_expire();var e=t.currentTarget,i=e.response;this._handle_fail(i)},o}(t.sirius_base_object);t.common_req=i,__reflect(i.prototype,"ns_sirius.common_req")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e.set_bg_color(0,.4),e._icon=new eui.Image,e.addChild(e._icon),e._icon.horizontalCenter=0,e._icon.verticalCenter=0,e._icon.width=100,e._icon.height=100,e._icon.source="loading_icon_png",e._icon.rotation,e}return __extends(e,t),e.prototype.start_anim=function(){egret.Tween.get(this._icon,{loop:!0}).to({rotation:360},5e3)},e.prototype.stop_anim=function(){egret.Tween.removeTweens(this._icon)},e}(t.sirius_view_base);t.sirius_default_loading_view=e,__reflect(e.prototype,"ns_sirius.sirius_default_loading_view")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.set_bg_color(0,.4);return i.ellipseWidth=40,i.ellipseHeight=40,e.left=20,e.right=20,e.height=40,e.verticalCenter=100,e._txt=new eui.Label,e.addChild(e._txt),e._txt.textColor=16777215,e._txt.left=10,e._txt.right=10,e._txt.size=26,e._txt.percentHeight=100,e._txt.textAlign=egret.HorizontalAlign.CENTER,e._txt.verticalAlign=egret.VerticalAlign.MIDDLE,e}return __extends(e,t),e.prototype.show=function(t){this._txt.text=t,egret.Tween.get(this).to({verticalCenter:0},2e3,egret.Ease.cubicOut).to({alpha:0},1e3,egret.Ease.cubicOut)},e}(t.sirius_view_base);t.popup_text_msg=e,__reflect(e.prototype,"ns_sirius.popup_text_msg")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.view_hierarchy_establish=function(e){this._sirius.layes.view_hierarchy_establish(e),this._module_sm=this._sirius.layes.sms[0],this._alert_sm=this._sirius.layes.sms[1],this._fs_cover_sm=this._sirius.layes.sms[2],this._message_sm=this._sirius.layes.sms[3],this._loading_sm=this._sirius.layes.sms[4],this._global_loading_view=new t.sirius_default_loading_view,this._loading_sm.attach_target_view(this._global_loading_view),this._sirius.mm.register_sm(this._module_sm)},i.prototype.switch_global_loading=function(t){t?(this._global_loading_view.start_anim(),this._loading_sm.show()):(this._global_loading_view.stop_anim(),this._loading_sm.hide())},i.prototype.show_popup_text_msg=function(e){var i=this,o=new t.popup_text_msg;this._message_sm.show_view(o),o.show(e),setTimeout(function(){i._message_sm.shift_first()},3500)},i.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null),this._sirius.mm.show_module(t,e,i,o)},i.prototype.show_sub_module=function(t,e,i,o,_){void 0===i&&(i=null),void 0===o&&(o=null),void 0===_&&(_=null),this._sirius.mm.show_sub_module(t,e,i,o,_)},i.prototype.show_sub_module_init=function(t,e,i,o,_,r){void 0===o&&(o=null),void 0===_&&(_=null),void 0===r&&(r=null),this._sirius.mm.show_sub_module_init(t,e,i,o,_,r)},i.prototype.pop_top_module=function(){this._module_sm.pop_top()},i}(t.sirius_element_module);t.app_vh_manager=e,__reflect(e.prototype,"ns_sirius.app_vh_manager")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){t.app_layer_def=[{lid:"modules",index:0,exclusive:!1,sm_type:1},{lid:"alert_panel",index:1,exclusive:!1,sm_type:0},{lid:"fullscreen_cover",index:2,exclusive:!1,sm_type:0},{lid:"messages",index:3,exclusive:!1,sm_type:0,disable_touch:!0},{lid:"loading",index:4,exclusive:!0}]}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(t){void 0===t&&(t=0),this._node_type=0,this._node_type=t}return Object.defineProperty(t.prototype,"element",{get:function(){return this._element},set:function(t){this._element=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pre",{get:function(){return this._pre},set:function(t){this._pre=t},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){1==this._node_type?console.log("HEAD DESTROY"):2==this._node_type&&console.log("TAIL DESTROY"),this._element=null,this._next=null,this._pre=null},t.prototype.is_head=function(){return 1==this._node_type},t.prototype.is_tail=function(){return 2==this._node_type},t}();t.dll_node=e,__reflect(e.prototype,"ns_sirius.dll_node");var i=function(){function t(t){void 0===t&&(t=0),this.list_id=0,this.list_id=t,this._tail=new e(2),this._tail.next=null,this._tail.element=null,this._head=new e(1),this._head.pre=null,this._head.element=null,this._tail.pre=this._head,this._head.next=this._tail,this._length=0}return Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){for(var t=this._head,e=null;t;)e=t.next,t.destroy(),t=e;this._head=null,this._tail=null,this._length=0},t.prototype.is_empty=function(){return this._head.next==this._tail},t.prototype.push=function(t){var i=new e;i.element=t,i.next=this._tail,i.pre=this._tail.pre,this._tail.pre.next=i,this._tail.pre=i,this._length++},t.prototype.pop=function(){if(!this.is_empty()){this._length--;var t=this._tail.pre,e=t.element;return t.pre.next=this._tail,this._tail.pre=t.pre,t.destroy(),t=null,e}},t.prototype.remove=function(t){if(!this.is_empty()){var e=this.find(t);if(e){this._length--;var i=e.pre,o=e.next;i.next=o,o.pre=i,e.destroy(),e=null}}},t.prototype.find=function(t){if(!t)return null;for(var e=this._head.next;e;){if(e.element==t)return e;e=e.next}return null},t.prototype.get_head=function(){return this._head},t.prototype.get_tail=function(){return this._tail},t}();t.doubly_linked_list=i,__reflect(i.prototype,"ns_sirius.doubly_linked_list")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.ddid=0,e}return __extends(e,t),e.prototype._before_destroy=function(){this._target=null,this._fun=null,this._param=null},e.prototype.dispatch=function(t,e,i,o){var _=this;void 0===o&&(o=null),this._is_destroyed=!1,this._delay_time=t,this._target=e,this._fun=i,this._param=o,setTimeout(function(){_.execute_fun()},t)},e.prototype.execute_fun=function(){this._is_destroyed||this._target&&this._fun&&(this._fun.apply(this._target,this._param),this.destroy())},e}(t.sirius_base_object);t.DelayDispatcher=e,__reflect(e.prototype,"ns_sirius.DelayDispatcher")
}(ns_sirius||(ns_sirius={}));var ns_sirius_math;!function(t){function e(t,e,i,o){var _=t-i,r=e-o;return Math.sqrt(_*_+r*r)}t.points_distance=e}(ns_sirius_math||(ns_sirius_math={}));var ns_sirius;!function(t){var e=function(){function t(t){this._stack=new Array(t),this._size=t,this._cursor=0}return t.prototype.pool_init=function(t){for(var e=0;e<this._size;e++)this._stack[e]=new t},t.prototype.borrow=function(){var t=this._stack[this._cursor];return this._cursor++,this._cursor==this._size&&(this._cursor=0),t},t.prototype.get_stack=function(){return this._stack},t.prototype.destroy=function(){this._stack=null},t}();t.rotational_deprived_fixed_pool=e,__reflect(e.prototype,"ns_sirius.rotational_deprived_fixed_pool")}(ns_sirius||(ns_sirius={}));