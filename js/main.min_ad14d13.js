var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(_,r){function n(t){try{a(o.next(t))}catch(e){r(e)}}function s(t){try{a(o["throw"](t))}catch(e){r(e)}}function a(t){t.done?_(t.value):new i(function(e){e(t.value)}).then(n,s)}a((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(_)throw new TypeError("Generator is already executing.");for(;a;)try{if(_=1,r&&(n=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(o){i=[6,o],r=0}finally{_=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var _,r,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},ns_sirius;!function(t){var e=function(){function t(){this._is_destroyed=!1}return t.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},t.prototype._before_destroy=function(){},t}();t.sirius_base_object=e,__reflect(e.prototype,"ns_sirius.sirius_base_object",["ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e.mark_as_fullfill(),console.log("[ "+e.constructor.name+" ] ALLOC"),e}return __extends(e,t),e.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent(),this.init_param=null,this.pair_vm=null},e.prototype.view_pre_init=function(t,e,i){this.init_param=t,this.pair_vm=e,this._sirius=i.sirius_public,this._view_before_init()},e.prototype.view_init=function(){this._view_start_init()},e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e.prototype.remove_all_children=function(){this.removeChildren()},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.update_visible=function(t){this.visible=t},e.prototype.mark_as_fullfill=function(){this.percentWidth=100,this.percentHeight=100,this.x=0,this.y=0},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e}(eui.Component);t.sirius_module_view=e,__reflect(e.prototype,"ns_sirius.sirius_module_view",["ns_sirius.Isirius_view_base","ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var GamePlayEntityBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++)t[i].destroy()},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(ns_sirius.sirius_base_object);__reflect(GamePlayEntityBase.prototype,"GamePlayEntityBase");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._machine=null,e}return __extends(e,t),e.prototype._before_destroy=function(){this._machine=null},e.prototype.state_init=function(t,e){this._machine=t,this._convert_context(e),this._behaviors_init(),this._after_state_init()},e.prototype._convert_context=function(t){},e.prototype._behaviors_init=function(){},e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return""},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype.state_update=function(){},e}(t.sirius_base_object);t.GP_StateBase=e,__reflect(e.prototype,"ns_sirius.GP_StateBase")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return console.log("[ "+e.constructor.name+" ] ALLOC"),e.pair_view=null,e.init_param=null,e}return __extends(e,t),e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._vm_before_destroy(),this.init_param=null,this.pair_view=null},e.prototype.vm_pre_init=function(t,e,i){this.init_param=t,this.pair_view=e,this._sirius=i.sirius_public,this._vm_before_init()},e.prototype.vm_init=function(){this._vm_start_init()},e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(t.sirius_base_object);t.module_vm_base=e,__reflect(e.prototype,"ns_sirius.module_vm_base")}(ns_sirius||(ns_sirius={}));var AppModuleViewBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(ns_sirius.sirius_module_view);__reflect(AppModuleViewBase.prototype,"AppModuleViewBase");var AppModuleVMBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(ns_sirius.module_vm_base);__reflect(AppModuleVMBase.prototype,"AppModuleVMBase");var GameActor=function(t){function e(){var e=t.call(this)||this;return e._is_dead=!1,e}return __extends(e,t),e.prototype.is_dead=function(){return this._is_dead},e.prototype.sentence_to_death=function(){this._is_dead=!0},e.prototype.frame_update=function(){},e}(GamePlayEntityBase);__reflect(GameActor.prototype,"GameActor");var CharacterStateBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._character=t},e.prototype.state_update=function(){this._frame_update(),this._syn_character_pos()},e.prototype._frame_update=function(){},e.prototype._syn_character_pos=function(){this._syn_pos_with_room()},e.prototype._syn_pos_with_room=function(){var t=this._character.current_room(),e=t.layout_info.get_slot_3dpos_by_index(this._character.get_slot_index(),this._character.character_type());this._character._sm_modify_pos(e,t.layout_info.d3_scale)},e}(ns_sirius.GP_StateBase);__reflect(CharacterStateBase.prototype,"CharacterStateBase");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._s_default=new t.GP_State_Default,i._current_state=new t.GP_State_Default,i._listener=null,i._ctx=null,i}return __extends(i,e),i.prototype._before_destroy=function(){this._ctx=null,this._listener=null,this._current_state=null,this._s_default.destroy(),this._s_default=null},i.prototype.get_current_state=function(){return this._current_state},i.prototype.get_current_state_str=function(){return this._current_state.state_str()},i.prototype.get_current_state_enum=function(){return this._current_state.state_enum()},i.prototype.machine_initialize=function(t,e,i){void 0===i&&(i=null),this._listener=t,this._ctx=e,this._s_default.state_init(this,e),this._states_init(e)},i.prototype._states_init=function(t){},i.prototype.get_state_by_enum=function(t){return null},i.prototype.state_change=function(t,e){void 0===e&&(e=null);var i=this.get_state_by_enum(t);i||console.log("invalid game machine enum "+t);var o=this._current_state;this._current_state=i,this._listener.sm_state_changed(o,i,e),o.state_leave(i,e),i.state_enter(o,e)},i.prototype.machine_update=function(){this._current_state.state_update()},i}(t.sirius_base_object);t.GP_StateMachine=e,__reflect(e.prototype,"ns_sirius.GP_StateMachine")}(ns_sirius||(ns_sirius={}));var GC_Ele_BaseView=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];o.destroy()}},e.prototype.destroy=function(){this._before_destroy(),this.parent&&this.parent.removeChild(this),this._is_destroyed=!0},e.prototype._before_destroy=function(){},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Group);__reflect(GC_Ele_BaseView.prototype,"GC_Ele_BaseView");var Character_State_Battle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_behavior_battle=function(){return this._behavior_battle},e.prototype._before_destroy=function(){this._behavior_battle.destroy(),this._behavior_battle=null,t.prototype._before_destroy.call(this)},e.prototype._behaviors_init=function(){this._behavior_battle=new BattleBehavior(this._character,this)},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype._frame_update=function(){this._behavior_battle.update()},e}(CharacterStateBase);__reflect(Character_State_Battle.prototype,"Character_State_Battle");var GameWinView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e.skinName="resource/YXY/game_skins/win/battle_Win_Skin.exml",e.touchEnabled=!1,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),console.log("createChildren"),this.win_btn.common_red_btn.labelDisplay.text=appm.lm.s("gamewin","jump","YXY"),this.EXPValue=80,this.win_processbar_exp.value=this.EXPValue,this.win_processbar_exp.label.text="80/100 (80%)";var i=new egret.Timer(500,1);i.addEventListener(egret.TimerEvent.TIMER,function(){e.win_processbar_exp.setPosition(e.win_processbar_exp.thumb.width,e.EXPValue),i.stop(),i=null},this),i.start(),this.win_processbar_facility.value=60,this.win_processbar_monster.value=50,this.win_icon1.common_icon_text.text="x 10",this.win_icon2.common_icon_text.text="x 2",this.win_icon3.common_icon_text.text="x 1"},e.prototype.onComplete=function(){console.log("onComplete")},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e}(AppModuleViewBase);__reflect(GameWinView.prototype,"GameWinView");var TestModuleView=function(t){function e(){var e=t.call(this)||this;return e.textField=new egret.TextField,e.addChild(e.textField),e.textField.size=32,e.textField.textAlign="left",e.textField.verticalAlign="top",e.textField.x=50,e.textField.y=100,e.textField.width=400,e.textField.textColor=16777215,e.textField.text=appm.lm.s("global","confirm"),e.textField.background=!0,e.textField.backgroundColor=23223,e.titleField=new egret.TextField,e.addChild(e.titleField),e.titleField.size=22,e.titleField.textAlign="center",e.titleField.verticalAlign="top",e.titleField.x=50,e.titleField.width=400,e.titleField.y=10,e.titleField.height=80,e.titleField.textColor=16777215,e.titleField.text="这是测试模块",setTimeout(function(){e._is_destroyed||e._sirius.debug_foo()},1e3),e}return __extends(e,t),e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(AppModuleViewBase);__reflect(TestModuleView.prototype,"TestModuleView");var RoomTypeEnum=function(){function t(){}return t.UNINITED=-1,t.EMPTY=0,t.ARENA=1,t.FACILITY=2,t}();__reflect(RoomTypeEnum.prototype,"RoomTypeEnum");var FacilityTypeEnum=function(){function t(){}return t.UNINITED=-1,t}();__reflect(FacilityTypeEnum.prototype,"FacilityTypeEnum");var RoomEntity=function(t){function e(){var e=t.call(this)||this;return e._room_type=RoomTypeEnum.UNINITED,e._facility_type=FacilityTypeEnum.UNINITED,e}return __extends(e,t),e.prototype._before_destroy=function(){this.layout_info.destroy(),this.layout_info=null,this.link&&(this.link.destroy(),this.link=null),this._destroy_arr(this.slots_defence),this.slots_defence=null,this._destroy_arr(this.slots_assault),this.slots_assault=null},e.prototype.room_layout_init=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.layout_init(t,e)},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.link_init(t,this.layout_info.row_index,this.layout_info.column_index)},e.prototype.room_type_init=function(t,i){this._room_type=t,this._facility_type=i,this.slots_defence=new Array(e.SlotsMax),this.slots_assault=new Array(e.SlotsMax),this._init_arr_by_null(this.slots_defence,e.SlotsMax),this._init_arr_by_null(this.slots_assault,e.SlotsMax)},e.prototype._init_arr_by_null=function(t,e){for(var i=0;e>i;i++)t[i]=null},e.prototype.is_boss_room=function(){return!1},e.prototype.is_born_room=function(){return!1},e.prototype.pawn_settle_down=function(t){if(this._room_type!=RoomTypeEnum.ARENA)return-1;if(this.defence_slots_is_empty())return-1;var e=this.find_free_assault_slot();return 0>e?-1:(this.slots_assault[e]=t,gp_core.am.mark_assault_depth_update(),e)},e.prototype.assaulter_leave=function(t){if(this._room_type!=RoomTypeEnum.ARENA)return-1;var e=t.get_slot_index();if(0>e)throw"slot index should not be negative";this.slots_assault[e]=null,this._match_enemies()},e.prototype.defender_leave=function(t){if(this._room_type!=RoomTypeEnum.ARENA)return-1;var e=t.get_slot_index();if(0>e)throw"slot index should not be negative";this.slots_defence[e]=null,this._match_enemies(),this._check_assaulters_should_leave()},e.prototype._check_assaulters_should_leave=function(){var t=this.find_living_defender();if(!t)for(var i=e.SlotsMax,o=0;i>o;o++){var _=this.slots_assault[o];_&&(_.end_battle_and_start_move(),this.slots_assault[o]=null)}},e.prototype.mark_match_again=function(){this._match_enemies()},e.prototype._match_enemies=function(){for(var t=e.SlotsMax,i=0;t>i;i++){var o=this.slots_defence[i];if(o&&o.can_match()){var _=this.find_facing_assaulter(i);if(_)this._link_asymmetrical(o,_);else{var r=this.find_living_assaulter();r?this._link_asymmetrical(o,r):this._unlink(o)}}}for(var i=0;t>i;i++){var n=this.slots_assault[i];if(n&&n.can_match()){var s=this.find_facing_defender(i);if(s)this._link_asymmetrical(n,s);else{var a=this.find_living_defender();a?this._link_asymmetrical(n,a):this._unlink(n)}}}},e.prototype._link_asymmetrical=function(t,e){t.active_battle_behavior(e)},e.prototype._unlink=function(t){t.deactive_battle_behavior()},e.prototype.find_free_assault_slot=function(){for(var t=0;t<e.SlotsMax;t++)if(null==this.slots_assault[t])return t;return-1},e.prototype.find_facing_assaulter=function(t){var e=this.slots_assault[t];return e&&e.can_be_matched()?e:null},e.prototype.find_living_assaulter=function(){for(var t=0;t<e.SlotsMax;t++){var i=this.slots_assault[t];if(i&&i.can_be_matched())return i}return null},e.prototype.find_facing_defender=function(t){var e=this.slots_defence[t];return e&&e.can_be_matched()?e:null},e.prototype.find_living_defender=function(){for(var t=0;t<e.SlotsMax;t++){var i=this.slots_defence[t];if(i&&i.can_be_matched())return i}return null},e.prototype.assault_slots_is_empty=function(){for(var t=0;t<e.SlotsMax;t++)if(this.slots_assault[t])return!1;return!0},e.prototype.defence_slots_is_empty=function(){for(var t=0;t<e.SlotsMax;t++)if(this.slots_defence[t])return!1;return!0},e.prototype.debug_generate_defenders=function(){this.room_type_init(RoomTypeEnum.ARENA,-1);for(var t=e.SlotsMax,i=0;t>i;i++){var o=gp_core.am.born_pawn(GameCharacterType.Defender);this.slots_defence[i]=o,o.character_init(this.layout_info.unique_index,i)}},e.SlotsMax=3,e}(GamePlayEntityBase);__reflect(RoomEntity.prototype,"RoomEntity");var GameWinVM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(AppModuleVMBase);__reflect(GameWinVM.prototype,"GameWinVM");var GC_RoomView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_Ele_BaseView);__reflect(GC_RoomView.prototype,"GC_RoomView");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.ProgressBar);t.CommonProcessBar=e,__reflect(e.prototype,"game.CommonProcessBar")}(game||(game={}));var MWN_State_Base=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._gpcore=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._gpcore=t},e}(ns_sirius.GP_StateBase);__reflect(MWN_State_Base.prototype,"MWN_State_Base");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},e.prototype._before_destroy=function(){console.log("======= sirius_view_base  destroy ======= "),console.log(this.constructor.name+" destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent()},e.prototype.attached_to_display_tree=function(t){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e.prototype.remove_all_children=function(){this.removeChildren()},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.update_visible=function(t){this.visible=t},e.prototype.mark_as_fullfill=function(){this.percentWidth=100,this.percentHeight=100,this.x=0,this.y=0},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e}(eui.Group);t.sirius_view_base=e,__reflect(e.prototype,"ns_sirius.sirius_view_base",["ns_sirius.Isirius_view_base","ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.core_init=function(t){this._sirius=t},e}(t.sirius_base_object);t.sirius_element_module=e,__reflect(e.prototype,"ns_sirius.sirius_element_module")}(ns_sirius||(ns_sirius={}));var TestModuleVM=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(AppModuleVMBase);__reflect(TestModuleVM.prototype,"TestModuleVM");var GameCharacterType=function(){function t(){}return t.Default=0,t.Defender=1,t.Assaulter=2,t}();__reflect(GameCharacterType.prototype,"GameCharacterType");var GameCharacter=function(t){function e(){var e=t.call(this)||this;return e._slot_index=-1,e._current_pos_3d=new egret.Point,e._current_scale_3d=new egret.Point,e.md_battle=new Character_RPPS_Battle,e._room_index=-100,e._slot_index=-100,e}return __extends(e,t),e.prototype._before_destroy=function(){this._binded_view&&(this._binded_view.destroy(),this._binded_view=null),this._machine&&(this._machine.destroy(),this._machine=null),this.md_battle.destroy(),this.md_battle=null,t.prototype._before_destroy.call(this)},e.prototype.get_room_index=function(){return this._room_index},e.prototype.current_room=function(){return this._room_index<0?null:gp_core.map.get_room_by_index(this._room_index)},e.prototype.get_slot_index=function(){return this._slot_index},e.prototype.character_init=function(t,e){this._room_index=t,this._slot_index=e,this._machine_init(),this._set_machine_initial_state()},e.prototype.prepare_to_die=function(){this._machine.state_change(CharacterMachineState.DYING)},e.prototype.active_battle_behavior=function(t){var e=this._machine.get_battle_behavior();e&&e.active(t)},e.prototype.deactive_battle_behavior=function(){var t=this._machine.get_battle_behavior();t&&t.deactive()},e.prototype.target_deduct_life=function(){var t=this._machine.get_battle_behavior();t&&t.target_deduct_life()},e.prototype.sm_state_changed=function(t,e,i){e.state_enum()==CharacterMachineState.MOVING?this._binded_view.change_state(GC_CharacterAnimState.MOVING):e.state_enum()==CharacterMachineState.BATTLE_DEFENDER?this._binded_view.change_state(GC_CharacterAnimState.IDLE):e.state_enum()==CharacterMachineState.BATTLE_ASSAULTER?this._binded_view.change_state(GC_CharacterAnimState.IDLE):e.state_enum()==CharacterMachineState.DYING&&this._binded_view.change_state(GC_CharacterAnimState.DYING)},e.prototype._sm_modify_pos=function(t,e){this._current_pos_3d.x=t.x,this._current_pos_3d.y=t.y,this._current_scale_3d.x=e.x,this._current_scale_3d.y=e.y},e.prototype._sm_modify_view_orientation=function(t){this._binded_view.change_direction(t)},e.prototype.bind_view=function(t){this._binded_view=t},e.prototype.frame_update=function(){t.prototype.frame_update.call(this),this._machine_update(),this._view_update_pos(),this._view_update_frame()},e.prototype._machine_update=function(){this._machine.machine_update()},e.prototype._view_update_pos=function(){this._binded_view.x=this._current_pos_3d.x,this._binded_view.y=this._current_pos_3d.y,this._binded_view.scaleX=this._current_scale_3d.x,this._binded_view.scaleY=this._current_scale_3d.y},e.prototype._view_update_frame=function(){this._binded_view.update_frame()},e}(GameActor);__reflect(GameCharacter.prototype,"GameCharacter",["ns_sirius.IGP_StateMachineListener"]);var Character_Behavior=function(t){function e(e,i){var o=t.call(this)||this;return o._character=e,o._s=i,o}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,this._s=null,t.prototype._before_destroy.call(this)},e.prototype.update=function(){},e}(GamePlayEntityBase);__reflect(Character_Behavior.prototype,"Character_Behavior");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._mstack=new Array,e._top=-1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype._s_is_empty=function(){return this._top<0?!0:!1},e.prototype._s_push=function(t){this._top<0&&(this._top=-1),this._top++,this._mstack[this._top]=t},e.prototype._s_pop=function(){this._s_is_empty()||(this._mstack[this._top]=null,this._top--)},e.prototype._s_shift=function(){if(!this._s_is_empty()){for(var t=0;t<this._top;t++)this._mstack[t]=this._mstack[t+1];this._top--}},e.prototype._s_clear=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++)this._mstack[t]=null;this._top=-1}},e.prototype._s_top=function(){return this._s_is_empty()?null:this._mstack[this._top]},e.prototype._s_bottom=function(){return this._s_is_empty()?null:this._mstack[0]},e.prototype.show_view=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this._root_view.addChild(t),t.attached_to_display_tree(e),this._s_push(t),this._update_container_visible(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t];e.detaching_from_display_tree(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top();t.detaching_from_display_tree(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom();t.detaching_from_display_tree(),t.destroy(),this._s_shift(),this._update_container_visible()},e.prototype.is_empty=function(){return this._s_is_empty()},e.prototype._update_container_visible=function(){this._s_is_empty()?this._root_view.update_visible(!1):this._root_view.update_visible(!0)},e}(t.sirius_base_object);t.layer_stack_manager=e,__reflect(e.prototype,"ns_sirius.layer_stack_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var CharacterMachineState=function(){function t(){}return t.DEFAULT=0,t.BORN=1,t.MOVING=2,t.DYING=4,t.BATTLE_ASSAULTER=5,t.BATTLE_DEFENDER=6,t.ERROR=99,t}();__reflect(CharacterMachineState.prototype,"CharacterMachineState");var CharacterMachine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._states_init=function(t){this._s_born=new Character_State_BORN,this._s_born.state_init(this,t),this._s_dying=new Character_State_DYING,this._s_dying.state_init(this,t),this._s_error=new Character_State_ERROR,this._s_error.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case CharacterMachineState.BORN:return this._s_born;case CharacterMachineState.DYING:return this._s_dying;case CharacterMachineState.ERROR:return this._s_error;default:return this._s_default}},e.prototype._before_destroy=function(){this._s_born.destroy(),this._s_born=null,this._s_dying.destroy(),this._s_dying=null,this._s_error.destroy(),this._s_error=null,t.prototype._before_destroy.call(this)},e}(ns_sirius.GP_StateMachine);__reflect(CharacterMachine.prototype,"CharacterMachine");var GameCoreView=function(t){function e(){var e=t.call(this)||this;return e.height=sirius.device_info.design_height,e.width=sirius.device_info.initial_optimal_w,e.horizontalCenter=0,e.top=0,e.mask=new egret.Rectangle(0,0,e.width,e.height),e._bgimg=new eui.Image("game_bg_jpg"),e.addChild(e._bgimg),e._bgimg.top=0,e._bgimg.height=sirius.device_info.design_height,e._bgimg.width=sirius.device_info.design_width,e._bgimg.horizontalCenter=0,e._coord_convert_ref_view=new egret.DisplayObjectContainer,e.addChild(e._coord_convert_ref_view),e._coord_convert_ref_view.width=gp_core.layout_config.total_w,e._coord_convert_ref_view.height=gp_core.layout_config.total_h,e._repos_view(),e}return __extends(e,t),e.prototype.core_init=function(t){this._gc=t},e.prototype.prepare_view_before_game=function(){},e.prototype._repos_view=function(){var t=gp_core.layout_config.total_w,e=sirius.device_info.initial_optimal_w;if(this.map_view){var i=.5*(e-t);this.map_view.x=i,this._coord_convert_ref_view.x=i}this.painting_canvas&&(this.painting_canvas.x=.5*sirius.device_info.initial_optimal_w)},e.prototype.get_coord_convert_ref_view=function(){return this._coord_convert_ref_view},e.prototype.prepare_game=function(){this.painting_canvas=new MapPaintingCanvas,this.addChild(this.painting_canvas),this.painting_canvas.prepare_mesh(),this.painting_canvas.visible=!1,this.map_view=new GC_MapView,this.addChild(this.map_view),this.map_view.width=gp_core.layout_config.total_w,this.map_view.height=gp_core.layout_config.total_h,this._painting_src=new MapPaintingView,this.addChild(this._painting_src),this._painting_src.width=gp_core.layout_config.canvas_fixed_w,this._painting_src.height=gp_core.layout_config.canvas_fixed_h,this._painting_src.visible=!1,this._repos_view()},e.prototype.room_start_painting=function(){this._painting_src.redraw()},e.prototype.start_game=function(){this._draw_rt(),this.map_view.rooms_init()},e.prototype.game_res_dispose=function(){this.painting_canvas.game_res_dispose(),this.painting_canvas.destroy(),this.painting_canvas=null,this.map_view.game_res_dispose(),this.map_view.destroy(),this.map_view=null},e.prototype.perspective_update=function(){this.painting_canvas.update_pp_param(this._gc),this.map_view.update_pp_param()},e.prototype._draw_rt=function(){var t=gp_core.layout_config.canvas_fixed_w,e=gp_core.layout_config.canvas_fixed_h,i=new egret.RenderTexture;i.disposeBitmapData=!0,i.drawToTexture(this._painting_src,new egret.Rectangle(0,0,t,e)),this.painting_canvas.paint_room(i,this._gc),i=null,this.painting_canvas.visible=!0,this.removeChild(this._painting_src),this._painting_src=null},e.prototype.debug_born_pawn=function(){return this.map_view.debug_born_pawn()},e}(ns_sirius.sirius_view_base);__reflect(GameCoreView.prototype,"GameCoreView");var GP_State_PREPARE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.PREPARE},e.prototype.state_str=function(){return"PREPARE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_prepare()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_PREPARE.prototype,"GP_State_PREPARE");var GP_State_RUNNING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.RUNNING},e.prototype.state_str=function(){return"RUNNING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_running()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_RUNNING.prototype,"GP_State_RUNNING");var yxy_rtable=[{module_name:"GameWin",view:GameWinView,vm:GameWinVM}],zl_rtable=[],Test_Added=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/LK/skins/Test_AddedSkin.exml",e}return __extends(e,t),e}(eui.Component);__reflect(Test_Added.prototype,"Test_Added",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var _=RES.getRes(t);_?o(_):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BattleBehavior=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._is_active=!1,e._attack_cursor=0,e.attack_interval=120,e}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,this._target_character=null,t.prototype._before_destroy.call(this)},e.prototype.active=function(t){this._is_active=!0,this._target_character=t,this.attack_interval=100+Math.ceil(100*Math.random()),this._character.character_type()==GameCharacterType.Defender?this._attack_cursor=Math.floor(.5*this.attack_interval):this._attack_cursor=0},e.prototype.deactive=function(){this._is_active=!1,this._target_character=null,this._attack_cursor=-1},e.prototype.act=function(){this._is_active&&(this._character._binded_view.start_stride(),this._character._binded_view.change_state(GC_CharacterAnimState.ATTACKING))},e.prototype.target_deduct_life=function(){if(this._is_active){this._target_character.md_battle.is_immortal||(this._target_character.md_battle.current_life-=this._character.md_battle.attack);var t=this._target_character.md_battle.current_life/this._target_character.md_battle.total_life;0>t&&(t=0),this._target_character._binded_view.update_health(t),this._target_character.md_battle.current_life<=0?this._target_character.prepare_to_die():this._target_character._binded_view.start_vibration_anim()}},e.prototype.update=function(){this._is_active&&(this._attack_cursor++,this._attack_cursor==this.attack_interval&&(this.act(),this._attack_cursor=0))},e}(Character_Behavior);__reflect(BattleBehavior.prototype,"BattleBehavior");var Move_Behavior=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target_room_uindex=0,e.target_slot_index=-1,e.can_settle_down=!1,e.current_pos_3d=new egret.Point,e.current_scale_3d=new egret.Point,e._cur_pos_2d=new egret.Point,e._from_pos=new egret.Point,e._to_pos=new egret.Point,e._pos_step=new egret.Point,e._is_moving=!1,e
}return __extends(e,t),e.prototype.move=function(t,e,i,o,_){this.target_room_uindex=e.layout_info.unique_index,this.target_slot_index=o,this.can_settle_down=o>=0,this._move_cursor=0,i>=0?this._from_pos=t.layout_info.get_slot_2dpos_by_index(i,1):this._from_pos=t.layout_info.center_pos,this.can_settle_down?this._to_pos=e.layout_info.get_slot_2dpos_by_index(o,1):this._to_pos=e.layout_info.center_pos;var r=this._to_pos.x-this._from_pos.x,n=(this._to_pos.y-this._from_pos.y)*GPC_layout_config.distance_ratio_w_to_h,s=Math.sqrt(r*r+n*n),a=3.1;this._move_frame_count=Math.floor(s/a),this._pos_step.x=(this._to_pos.x-this._from_pos.x)/this._move_frame_count,this._pos_step.y=(this._to_pos.y-this._from_pos.y)/this._move_frame_count,this._is_moving=!0;var c=this._to_pos.x>this._from_pos.x,h=0;return _==RoomLinkDirection.LEFT&&(h=1),_==RoomLinkDirection.RIGHT?h=2:_==RoomLinkDirection.FRONT&&e.is_boss_room()&&(h=c?2:1),h},e.prototype.update=function(){this._is_moving?(this._cur_pos_2d.x=this._from_pos.x+this._pos_step.x*this._move_cursor,this._cur_pos_2d.y=this._from_pos.y+this._pos_step.y*this._move_cursor):(this._cur_pos_2d.x=this._to_pos.x,this._cur_pos_2d.y=this._to_pos.y),gp_core.ppc.cal_3d_pos(this._cur_pos_2d,this.current_pos_3d,this.current_scale_3d),this._move_cursor++,this._move_cursor>=this._move_frame_count&&(this._is_moving=!1,this._moved_to_target())},e.prototype._moved_to_target=function(){var t=this._character,e=this.target_room_uindex;if(e==GameMap.boss_room_id)return void t.sentence_to_death();if(this.can_settle_down)t.enter_room_and_start_battle(e,this.target_slot_index);else{t.enter_room(e,this.target_slot_index);var i=this._s;i._continue_move()}},e.move_round_count=1,e}(Character_Behavior);__reflect(Move_Behavior.prototype,"Move_Behavior");var FindRoom_Behavior=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixed_direction_weights=[5e4,3e4,2e4,3e4],e.cur_room_index=0,e.target_room_index=0,e.target_direction=0,e._previous_direction=-1,e}return __extends(e,t),e.prototype.find_next_room=function(t){this.cur_room_index=t,this.target_room_index=-1;var e=gp_core.map.get_room_by_index(t),i=this._array_multiply(this.fixed_direction_weights,e.link.availables,4),o=this._cal_direction_by_weights(i,this._previous_direction);this.target_direction=o;var _=e.link.neighbours[o];return _?(this.target_room_index=_.layout_info.unique_index,this._previous_direction=RoomLinkInfo.reverse_direciton(o),!0):(console.error("未找到下一个房间 : "+o),console.log(e.link.neighbours),!1)},e.prototype._array_multiply=function(t,e,i){for(var o=new Array,_=0;i>_;_++)o[_]=t[_]*e[_];return o},e.prototype._cal_direction_by_weights=function(t,e){for(var i=0,o=new Array(4),_=0;4>_;_++)_==e?o[_]=0:o[_]=Math.random()*t[_];for(var _=1;4>_;_++)o[i]<o[_]&&(i=_);return i},e}(Character_Behavior);__reflect(FindRoom_Behavior.prototype,"FindRoom_Behavior");var GamePawn_Assault=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._machine_init=function(){this._machine=new CharacterMachine_Assaulter,this._machine.machine_initialize(this,this)},e.prototype._set_machine_initial_state=function(){this._machine.state_change(CharacterMachineState.MOVING)},e.prototype.can_be_matched=function(){return this._machine?this._machine.get_current_state_enum()==CharacterMachineState.BATTLE_ASSAULTER:!1},e.prototype.can_match=function(){return this.can_be_matched()},e.prototype.enter_room=function(t,e){this._room_index=t,this._slot_index=e},e.prototype.enter_room_and_start_battle=function(t,e){this.enter_room(t,e),this._machine.state_change(CharacterMachineState.BATTLE_ASSAULTER)},e.prototype.end_battle_and_start_move=function(){this._machine.state_change(CharacterMachineState.MOVING)},e.prototype.sentence_to_death=function(){t.prototype.sentence_to_death.call(this),gp_core.am.mark_assaulters_check_death()},e.prototype.character_type=function(){return GameCharacterType.Assaulter},e.prototype.bind_view=function(e){t.prototype.bind_view.call(this,e),this._binded_view.change_direction(2)},e}(GameCharacter);__reflect(GamePawn_Assault.prototype,"GamePawn_Assault");var GamePawn_Defence=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._machine_init=function(){this._machine=new CharacterMachine_Defender,this._machine.machine_initialize(this,this)},e.prototype.can_be_matched=function(){return this._machine?this._machine.get_current_state_enum()==CharacterMachineState.BATTLE_DEFENDER:!1},e.prototype.can_match=function(){return this.can_be_matched()},e.prototype._set_machine_initial_state=function(){this._machine.state_change(CharacterMachineState.BATTLE_DEFENDER)},e.prototype.sentence_to_death=function(){t.prototype.sentence_to_death.call(this),gp_core.am.mark_defenders_check_death()},e.prototype.character_type=function(){return GameCharacterType.Defender},e}(GameCharacter);__reflect(GamePawn_Defence.prototype,"GamePawn_Defence");var Character_RPPS_Battle=function(t){function e(){var e=t.call(this)||this;return e.action_interval=0,e.is_immortal=!1,e}return __extends(e,t),e}(GamePlayEntityBase);__reflect(Character_RPPS_Battle.prototype,"Character_RPPS_Battle");var sirius,gp_core,appm,AppRootView=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.height=sirius.device_info.design_height,e.width=sirius.device_info.safe_width,e.horizontalCenter=0,e.top=0,e}return __extends(e,t),e}(ns_sirius.sirius_view_base);__reflect(AppRootView.prototype,"AppRootView",["ns_sirius.Isirius_app_root_view"]);var Main=function(t){function e(){var e=t.call(this)||this;return e._debug_flag=!1,e._debug_index=0,appm=new AppModel,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.load_crit_res().then(function(t){e.createGameScene()},function(t){console.log(t)})},e.prototype.load_crit_res=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[4,appm.crit_loader.load_res()];case 2:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,12,,13]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadConfig("resource/COMMON/COMMON.res.json","resource/")];case 2:return i.sent(),[4,RES.loadConfig("resource/ZL/ZL.res.json","resource/")];case 3:return i.sent(),[4,RES.loadConfig("resource/YXY/YXY.res.json","resource/")];case 4:return i.sent(),[4,RES.loadConfig("resource/LK/LK.res.json","resource/")];case 5:return i.sent(),[4,this.loadTheme()];case 6:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 7:return i.sent(),[4,RES.loadGroup("COMMON",0,t)];case 8:return i.sent(),[4,RES.loadGroup("ZL",0,t)];case 9:return i.sent(),[4,RES.loadGroup("YXY",0,t)];case 10:return i.sent(),[4,RES.loadGroup("LK",0,t)];case 11:return i.sent(),this.stage.removeChild(t),[3,13];case 12:return e=i.sent(),console.error(e),[3,13];case 13:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype._syn_stage_size=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;sirius.device_info.syn_stage_size(t,e)},e.prototype._resize_handler=function(t){this._syn_stage_size(),this._app_root_view.width=sirius.device_info.safe_width,gp_core.mark_perspective_needs_update()},e.prototype.createGameScene=function(){var t=new ns_sirius.SiriusCore;t.core_init(),sirius=t.sirius_public,this._syn_stage_size(),sirius.device_info.device_info_init(),COMMON_consts.generate_consts(),gp_core=new GamePlayCore,gp_core.core_init(this.stage);var e=new GameCoreView;this.addChild(e),gp_core.register_core_view(e,e.get_coord_convert_ref_view()),this._app_root_view=new AppRootView,this.addChild(this._app_root_view);var i=new GameUIView;this._app_root_view.addChild(i),sirius.view_manager.view_hierarchy_establish(this._app_root_view),this.addEventListener(egret.Event.RESIZE,this._resize_handler,this),this._resize_handler(null),setTimeout(function(){gp_core.prepare_game()},1e3)},e.prototype.onButtonClick=function(t){gp_core.start_game()},e.prototype.btn_debug_click2=function(t){gp_core.end_game()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var CharacterMachine_Assaulter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_battle_behavior=function(){if(this.get_current_state_enum()==CharacterMachineState.DYING)return null;if(this.get_current_state_enum()!=CharacterMachineState.BATTLE_ASSAULTER)throw"Assaulter get_battle_behavior   not in battle ? ";return this._s_battle.get_behavior_battle()},e.prototype._states_init=function(e){t.prototype._states_init.call(this,e),this._s_battle=new Character_State_Battle_Assaulter,this._s_battle.state_init(this,e),this._s_moving=new Character_State_MOVING,this._s_moving.state_init(this,e)},e.prototype.get_state_by_enum=function(e){switch(e){case CharacterMachineState.MOVING:return this._s_moving;case CharacterMachineState.BATTLE_ASSAULTER:return this._s_battle}return t.prototype.get_state_by_enum.call(this,e)},e.prototype._before_destroy=function(){this._s_moving.destroy(),this._s_moving=null,this._s_battle.destroy(),this._s_battle=null,t.prototype._before_destroy.call(this)},e}(CharacterMachine);__reflect(CharacterMachine_Assaulter.prototype,"CharacterMachine_Assaulter");var CharacterMachine_Defender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.get_battle_behavior=function(){if(this.get_current_state_enum()==CharacterMachineState.DYING)return null;if(this.get_current_state_enum()!=CharacterMachineState.BATTLE_DEFENDER)throw"Defender get_battle_behavior   not in battle ? ";return this._s_battle.get_behavior_battle()},e.prototype._states_init=function(e){t.prototype._states_init.call(this,e),this._s_battle=new Character_State_Battle_Defender,this._s_battle.state_init(this,e)},e.prototype.get_state_by_enum=function(e){switch(e){case CharacterMachineState.BATTLE_DEFENDER:return this._s_battle}return t.prototype.get_state_by_enum.call(this,e)},e.prototype._before_destroy=function(){this._s_battle.destroy(),this._s_battle=null,t.prototype._before_destroy.call(this)},e}(CharacterMachine);__reflect(CharacterMachine_Defender.prototype,"CharacterMachine_Defender");var Character_State_BORN=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.BORN},e.prototype.state_str=function(){return"BORN"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_BORN.prototype,"Character_State_BORN");var Character_State_DYING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.DYING},e.prototype.state_str=function(){return"DYING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null);var i=this._character.current_room();this._character.character_type()==GameCharacterType.Defender?i.defender_leave(this._character):i.assaulter_leave(this._character)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_DYING.prototype,"Character_State_DYING");var Character_State_ERROR=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.ERROR},e.prototype.state_str=function(){return"ERROR"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_ERROR.prototype,"Character_State_ERROR");var Character_State_MOVING=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._behavior_move.destroy(),this._behavior_move=null,this._behavior_findroom.destroy(),this._behavior_findroom=null,t.prototype._before_destroy.call(this)},e.prototype._behaviors_init=function(){this._behavior_move=new Move_Behavior(this._character,this),this._behavior_findroom=new FindRoom_Behavior(this._character,this)},e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.MOVING},e.prototype.state_str=function(){return"MOVING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._continue_move()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype._frame_update=function(){this._behavior_move.update()},e.prototype._syn_character_pos=function(){this._character._sm_modify_pos(this._behavior_move.current_pos_3d,this._behavior_move.current_scale_3d)},e.prototype._continue_move=function(){var t=this._character.get_room_index(),e=this._character.get_slot_index(),i=this._behavior_findroom.find_next_room(t);if(!i)return void this._machine.state_change(CharacterMachineState.ERROR,"find_room");var o=this._behavior_findroom.target_room_index,_=this._behavior_findroom.target_direction,r=gp_core.map.get_room_by_index(t),n=gp_core.map.get_room_by_index(o),s=-1;s=n.pawn_settle_down(this._character);var a=this._behavior_move.move(r,n,e,s,_);this._character._sm_modify_view_orientation(a)},e}(CharacterStateBase);__reflect(Character_State_MOVING.prototype,"Character_State_MOVING");var Character_State_Battle_Assaulter=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.state_enum=function(){return CharacterMachineState.BATTLE_ASSAULTER},e.prototype.state_str=function(){return"BATTLE_ASSAULTER"},e.prototype.state_enter=function(e,i){void 0===i&&(i=null),t.prototype.state_enter.call(this,e,i),this._character._sm_modify_view_orientation(2),this._character.current_room().mark_match_again()},e}(Character_State_Battle);__reflect(Character_State_Battle_Assaulter.prototype,"Character_State_Battle_Assaulter");var Character_State_Battle_Defender=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.state_enum=function(){return CharacterMachineState.BATTLE_DEFENDER},e.prototype.state_str=function(){return"BATTLE_DEFENDER"},e}(Character_State_Battle);__reflect(Character_State_Battle_Defender.prototype,"Character_State_Battle_Defender");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function _(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var a=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(o,generateJSON.paths[t])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,_,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameMap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._destroy_arr(this.rooms),this.rooms=null,this.boss_room&&(this.boss_room.destroy(),this.boss_room=null)},e.prototype.generate_map_layout=function(){this.born_room=new BornRoomEntity,this.born_room.room_layout_init(0,0);var t=gp_core.layout_config;this.rooms=new Array(t.element_count);for(var e=t.column_count,i=t.row_count,o=0;i>o;o++)for(var _=0;e>_;_++){var r=new RoomEntity;r.room_layout_init(_,o);var n=r.layout_info.unique_index;this.rooms[n]=r}this.boss_room=new BossRoomEntity,this.boss_room.room_layout_init(0,0),this.born_room.link_generate(this);for(var o=0;o<t.element_count;o++)this.rooms[o].link_generate(this);this.boss_room.link_generate(this);var s=0;3==t.column_count?s=1:5==t.column_count&&(s=2);var a=(t.row_count-1)*t.column_count+s;this.rooms[a].link.link_to_boss(this)},e.prototype.perspective_update=function(){for(var t=gp_core.map,e=t.rooms.length,i=0;e>i;i++){var o=t.rooms[i].layout_info;o.update_3d_layout()}t.born_room.layout_info.update_3d_layout(),t.boss_room.layout_info.update_3d_layout()},e.prototype.assault_depth_update=function(){for(var t=this.rooms.length,e=RoomEntity.SlotsMax,i=0;t>i;i++){var o=this.rooms[i];if(o._room_type==RoomTypeEnum.ARENA)for(var _=0;e>_;_++){var r=o.slots_assault[_];r&&r._binded_view.parent.addChild(r._binded_view)}}},e.prototype.get_room_by_index=function(t){if(0>t)return t==e.born_room_id?this.born_room:t==e.boss_room_id?this.boss_room:null;var i=this.rooms.length;return t>i-1?null:this.rooms[t]},e.prototype.get_room_by_row_column=function(t,e){var i=gp_core.layout_config.rowcolumn_to_uindex(t,e);return this.get_room_by_index(i)},e.prototype.debug_generate_defenders=function(){for(var t=this.rooms.length,e=0;t>e;e++){var i=this.rooms[e],o=i.layout_info.unique_index;10>o?(0==o||1==o||3==o||6==o||7==o||8==o)&&i.debug_generate_defenders():o%11==0&&i.debug_generate_defenders()}},e.born_room_id=-2,e.boss_room_id=-3,e}(GamePlayEntityBase);__reflect(GameMap.prototype,"GameMap");var BornRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.room_layout_init=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.born_layout_init()},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.born_link_init(t)},e.prototype.is_born_room=function(){return!0},e}(RoomEntity);__reflect(BornRoomEntity.prototype,"BornRoomEntity");var BossRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this.slot_boss&&(this.slot_boss.destroy(),this.slot_boss=null),t.prototype._before_destroy.call(this)},e.prototype.room_layout_init=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.boss_layout_init()},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.boss_link_init(t)},e.prototype.is_boss_room=function(){return!0},e}(RoomEntity);__reflect(BossRoomEntity.prototype,"BossRoomEntity");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.CommonIconItemView=e,__reflect(e.prototype,"game.CommonIconItemView")}(game||(game={}));var RoomLayoutInfo=function(t){function e(){var e=t.call(this)||this;return e.view_pos=new egret.Point,e.center_pos=new egret.Point,e.d3_point_local=new egret.Point,e.d3_scale=new egret.Point,e}return __extends(e,t),e.prototype.layout_init=function(t,e){var i=gp_core.layout_config;this.column_index=t,this.row_index=e,this.unique_index=gp_core.layout_config.rowcolumn_to_uindex(e,t),this.view_pos.x=Math.round(t*(i.column_gap+i.cell_w)),this.view_pos.y=i.room_orig_y+Math.round(e*(i.row_gap+i.cell_h)),this.center_pos.x=this.view_pos.x+Math.round(.5*i.cell_w),this.center_pos.y=this.view_pos.y+Math.round(.5*i.cell_h),this.view_w=i.cell_w,this.view_h=i.cell_h,this._def_slots_init(),this._assualt_slots_init()},e.prototype._def_slots_init=function(){var t=RoomEntity.SlotsMax,e=gp_core.layout_config;this._slots_def_2d=Array(t),this._slots_def_3d=Array(t);for(var i=0;t>i;i++)this._slots_def_2d[i]=new egret.Point(this.view_pos.x+e.cell_w-50,0),this._slots_def_3d[i]=new egret.Point(0,0);var o=.5*e.cell_h+30;this._slots_def_2d[0].y=this.view_pos.y+o-60,this._slots_def_2d[1].y=this.view_pos.y+o,this._slots_def_2d[2].y=this.view_pos.y+o+60},e.prototype._assualt_slots_init=function(){var t=RoomEntity.SlotsMax,e=gp_core.layout_config;this._slots_assault_2d=Array(t),this._slots_assault_3d=Array(t);for(var i=0;t>i;i++)this._slots_assault_2d[i]=new egret.Point(this.view_pos.x+50,0),this._slots_assault_3d[i]=new egret.Point(0,0);var o=.5*e.cell_h+30;this._slots_assault_2d[0].y=this.view_pos.y+o-60,this._slots_assault_2d[1].y=this.view_pos.y+o,this._slots_assault_2d[2].y=this.view_pos.y+o+60},e.prototype.boss_layout_init=function(){var t=gp_core.layout_config;this.column_index=GameMap.boss_room_id,this.row_index=GameMap.boss_room_id,this.unique_index=GameMap.boss_room_id;var e=t.boss_w,i=t.boss_h;this.view_pos.x=t.boss_x,this.view_pos.y=t.boss_y,this.center_pos.x=this.view_pos.x+Math.round(.5*e),this.center_pos.y=this.view_pos.y+Math.round(.5*i),this.view_w=e,this.view_h=i},e.prototype.born_layout_init=function(){var t=gp_core.layout_config;this.column_index=GameMap.born_room_id,this.row_index=GameMap.born_room_id,this.unique_index=GameMap.born_room_id,this.view_pos.x=t.pawn_born_x-.5*t.pawn_born_width,this.view_pos.y=t.pawn_born_y-.5*t.pawn_born_height,this.center_pos.x=t.pawn_born_x,this.center_pos.y=t.pawn_born_y,this.view_w=t.pawn_born_width,this.view_h=t.pawn_born_height},e.prototype.update_3d_layout=function(){gp_core.ppc.cal_3d_pos(this.center_pos,this.d3_point_local,this.d3_scale);var t=RoomEntity.SlotsMax;if(this._slots_def_2d)for(var e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_def_2d[e],this._slots_def_3d[e],null);if(this._slots_assault_2d)for(var e=0;t>e;e++)gp_core.ppc.cal_3d_pos(this._slots_assault_2d[e],this._slots_assault_3d[e],null)},e.prototype.get_slot_3dpos_by_index=function(t,e){if(0>t)return this.d3_point_local;var i=RoomEntity.SlotsMax;return t>i-1?this.d3_point_local:e==GameCharacterType.Defender?this._slots_def_3d[t]:e==GameCharacterType.Assaulter?this._slots_assault_3d[t]:void 0},e.prototype.get_slot_2dpos_by_index=function(t,e){if(0>t)return this.center_pos;var i=RoomEntity.SlotsMax;return t>i-1?this.center_pos:0==e?this._slots_def_2d[t]:this._slots_assault_2d[t]},e}(GamePlayEntityBase);__reflect(RoomLayoutInfo.prototype,"RoomLayoutInfo");var RoomLinkDirection=function(){function t(){}return t.FRONT=0,t.LEFT=1,t.BACK=2,t.RIGHT=3,t}();__reflect(RoomLinkDirection.prototype,"RoomLinkDirection");var RoomLinkInfo=function(t){function e(){var e=t.call(this)||this;return e.availables=[0,0,0,0],e.neighbours=[null,null,null,null],e}return __extends(e,t),e.reverse_direciton=function(t){switch(t){case RoomLinkDirection.FRONT:return RoomLinkDirection.BACK;case RoomLinkDirection.BACK:return RoomLinkDirection.FRONT;case RoomLinkDirection.LEFT:return RoomLinkDirection.RIGHT;case RoomLinkDirection.RIGHT:return RoomLinkDirection.LEFT}return-1},e.prototype._before_destroy=function(){this.availables=null,this.neighbours=null},e.prototype.link_init=function(t,e,i){var o=gp_core.layout_config.rowcolumn_to_uindex(e+1,i),_=gp_core.layout_config.rowcolumn_to_uindex(e,i-1),r=gp_core.layout_config.rowcolumn_to_uindex(e-1,i),n=gp_core.layout_config.rowcolumn_to_uindex(e,i+1);this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(o),this.neighbours[RoomLinkDirection.LEFT]=t.get_room_by_index(_),this.neighbours[RoomLinkDirection.BACK]=t.get_room_by_index(r),this.neighbours[RoomLinkDirection.RIGHT]=t.get_room_by_index(n),this.availables[0]=this.neighbours[RoomLinkDirection.FRONT]?1:0,this.availables[1]=this.neighbours[RoomLinkDirection.LEFT]?1:0,this.availables[2]=this.neighbours[RoomLinkDirection.BACK]?1:0,this.availables[3]=this.neighbours[RoomLinkDirection.RIGHT]?1:0},e.prototype.born_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(2),this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=1,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.boss_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=null,this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=0,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.link_to_boss=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(GameMap.boss_room_id),this.availables[0]=1},e}(GamePlayEntityBase);__reflect(RoomLinkInfo.prototype,"RoomLinkInfo");var RoomBossSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomBossSlotEntity.prototype,"RoomBossSlotEntity");var RoomSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomSlotEntity.prototype,"RoomSlotEntity");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AppModel=function(){function t(){this.lm=new LocalizationManager,this.lm.choose_language("cn"),this.crit_loader=new CriticalResLoader}return t.prototype.app_init=function(){this._post_login_req()},t.prototype._post_login_req=function(){(new ns_sirius.common_req).post("login").then(function(t){console.log("======= 登录成功 ======="),console.log(t)},function(t){console.log("======= 登录失败 =======")})},t}();__reflect(AppModel.prototype,"AppModel");var MapPaintingCanvas=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.game_res_dispose=function(){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null),this._dragon_display&&(this._dragon_display.dispose(),this.removeChild(this._dragon_display),this._dragon_display=null)},e.prototype.paint_room=function(t,e){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null),this._dragon_display&&(this._src_texture=t,this._dragon_display.scaleX=gp_core.layout_config.canvas_scale_x,this._dragon_display.scaleY=gp_core.layout_config.canvas_scale_y,this._dragon_display.armature.replaceTexture(this._src_texture),this.update_pp_param(e))},e.prototype.prepare_mesh=function(){var t=dragonBones.EgretFactory.factory,e=t.buildArmatureDisplay("Armature","canvas_mesh");this.addChild(e),this._dragon_display=e;var i="#define M_PI 3.1415926535897932384626433832795\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord; \n \nconst float near = 0.5;\nconst vec2 center = vec2(-1.0, 1.0);\n \nuniform float last_scale;\nuniform float offset_x;\nuniform float offset_y;\n \nuniform vec2 projectionVector;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\n \nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main(void) {\n\n    vec2 raw_pos =  (aVertexPosition / projectionVector) + center;\n   \n    //======= 先处理， 处理scale\n    raw_pos.x = raw_pos.x * last_scale;\n    raw_pos.y = raw_pos.y * last_scale + last_scale - 1.0;\n      \n    float rx = raw_pos.x;\n    float ry = raw_pos.y;\n      \n    //根据 ry [-1, 1] 映射 z 值 到  [0, m] 上 ，近平面为 x-o-y平面\n    const float m = 0.2;\n    float rz = (ry + 1.0) * 0.5 * m + offset_y * 0.1;\n    \n    float input_x = rx + offset_x;\n    float input_y = ry + offset_y;\n\n    float res_x =  (input_x * near) / (rz + near);\n    float res_y =  (input_y * near) / (rz + near);\n  \n    vec2 normal_pos = vec2(res_x, res_y);\n  \n    vec2 color_pos = aTextureCoord;  \n    color_pos.x = rx;\n    color_pos.y = ry;\n \n    gl_Position = vec4( normal_pos, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vColor = vec4(color_pos.x, color_pos.y, 0.0,1.0);\n    }\n",o="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\n\nuniform float customUniform;\n\nvoid main(void) { \n     \n    vec4 fg = texture2D(uSampler, vTextureCoord); \n    // fg += (vColor * 0.5);\n    gl_FragColor = fg;\n\n    // gl_FragColor = vColor;\n\n    // gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n}",_=new egret.CustomFilter(i,o,{offset_x:0,offset_y:0,last_scale:1});e.filters=[_],this._customFilter1=_},e.prototype.update_pp_param=function(t){this._customFilter1.uniforms.offset_x=t.ppc._shader_offset_x,this._customFilter1.uniforms.offset_y=t.ppc._shader_offset_y,this._customFilter1.uniforms.last_scale=t.ppc._shader_last_scale},e}(GC_Ele_BaseView);__reflect(MapPaintingCanvas.prototype,"MapPaintingCanvas");var MapPaintingView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.redraw=function(){gp_core.layout_config.canvas_fixed_w,gp_core.layout_config.canvas_fixed_h;this._draw_lines(),this._draw_normal_rooms(),this._draw_boss_room()},e.prototype._draw_normal_rooms=function(){for(var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.rooms.length,_=new Array(o),r=0;o>r;r++){var n=t.rooms[r],s=n.layout_info.unique_index,a=new eui.Image;_[s]=a,a.fillMode=egret.BitmapFillMode.SCALE,a.width=n.layout_info.view_w*e,a.height=n.layout_info.view_h*i,a.x=n.layout_info.view_pos.x*e,a.y=n.layout_info.view_pos.y*i,this.addChild(a),s%7==0?a.source="room_battle_png":s%7==2?a.source="room_f_png":a.source="room_blank_png"}},e.prototype._draw_boss_room=function(){var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.boss_room,_=new eui.Image;_.source="room_boss_png",_.width=o.layout_info.view_w*e,_.height=o.layout_info.view_h*i,_.x=o.layout_info.view_pos.x*e,_.y=o.layout_info.view_pos.y*i,this.addChild(_),_.fillMode=egret.BitmapFillMode.SCALE},e.prototype._draw_lines=function(){for(var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=gp_core.layout_config.row_count,_=gp_core.layout_config.column_count,r=5,n=gp_core.layout_config.column_gap+2*r,s=Math.ceil(.5*n),a=gp_core.layout_config.row_gap+2*r,c=Math.ceil(.5*a),h=0;o>h;h++)for(var u=0;_>u;u++){var l=gp_core.layout_config.rowcolumn_to_uindex(h,u),p=t.rooms[l];if(u!=_-1){var d=new egret.Point(p.layout_info.view_pos.x+p.layout_info.view_w-r,p.layout_info.center_pos.y),f=new eui.Image("line_horizontal_png");f.fillMode=egret.BitmapFillMode.SCALE,f.width=n*e,f.height=s*i,f.x=d.x*e,f.y=(d.y-.5*s)*i,this.addChild(f)}if(h!=o-1){var m=new egret.Point(p.layout_info.center_pos.x,p.layout_info.view_pos.y+p.layout_info.view_h-r),y=new eui.Image("line_vertical_png");y.fillMode=egret.BitmapFillMode.SCALE,y.width=c*e,y.height=a*i,y.x=(m.x-.5*c)*e,y.y=m.y*i,this.addChild(y)}}},e}(GC_Ele_BaseView);__reflect(MapPaintingView.prototype,"MapPaintingView");
var GC_CharacterAnimState=function(){function t(){}return t.IDLE=0,t.MOVING=1,t.ATTACKING=2,t.DYING=4,t}();__reflect(GC_CharacterAnimState.prototype,"GC_CharacterAnimState");var GC_CharacterView=function(t){function e(){var e=t.call(this)||this;e._fixed_scale=1,e._current_anim_state=-1,e._attack_trigger=!1,e._character_x=0;var i=[1,0,0,0,0,0,.3,0,0,0,0,0,.3,0,0,0,0,0,1,0];e._vibration_filter=new egret.ColorMatrixFilter(i),e._vibration_comp=new GCCV_vibration(e),e._stride_comp=new GCCV_stride,e._death_comp=new GCCV_death(e);var o=Math.floor(3.5*Math.random());return e._res_index=o,e._init_character_anim(),e._health_view=new CharacterHealthView,e.addChild(e._health_view),e._health_view.x=-25,e._health_view.y=-70,2==e._res_index?e._health_view.y=-90:3==e._res_index&&(e._health_view.y=-120),e}return __extends(e,t),e.prototype.bind_entity=function(t){this._binded_entity=t},e.prototype._before_destroy=function(){this._character_display&&(this._character_display.animation.stop(),this._character_display.removeEvent(dragonBones.EgretEvent.COMPLETE,this._animation_play_end,this),this._character_display.removeEvent(dragonBones.EgretEvent.ANIMATION_FRAME_EVENT,this._ANIM_FRAME_EVENT,this),this._character_display.dispose(),this._character_display=null),this.removeChild(this._health_view),this._health_view=null,this._binded_entity=null,this._vibration_comp.destroy(),this._vibration_comp=null,this._stride_comp.destroy(),this._stride_comp=null,this._death_comp.destroy(),this._death_comp=null,this.remove_from_parent()},e.prototype._init_character_anim=function(){var t=gp_core.resm._resources[this._res_index],e=dragonBones.EgretFactory.factory,i=e.buildArmatureDisplay(t.armature_name,t.character_name);this.addChild(i),i.scaleX=this._fixed_scale,i.scaleY=this._fixed_scale,this._character_display=i,this._character_display.addEvent(dragonBones.EgretEvent.COMPLETE,this._animation_play_end,this),this._character_display.addEvent(dragonBones.EgretEvent.ANIMATION_FRAME_EVENT,this._ANIM_FRAME_EVENT,this)},e.prototype._animation_play_end=function(t){this.change_state(GC_CharacterAnimState.IDLE)},e.prototype._ANIM_FRAME_EVENT=function(t){var e=this._character_display.animation.lastAnimationState.name,i=gp_core.resm._resources[this._res_index];if(e==i.attack_anim_name){t.frameLabel;this._attack_trigger&&(this._attack_trigger=!1,this._binded_entity.target_deduct_life())}},e.prototype.listen_death_anim_comp=function(){this._binded_entity.sentence_to_death()},e.prototype.change_direction=function(t){0!=t&&(1==t?this._character_display.scaleX=this._fixed_scale:2==t&&(this._character_display.scaleX=-this._fixed_scale))},e.prototype.update_health=function(t){this._health_view.update_prog(t)},e.prototype.change_state=function(t){if(t!=GC_CharacterAnimState.IDLE&&t!=GC_CharacterAnimState.MOVING||t!=this._current_anim_state){this._current_anim_state=t;var e=gp_core.resm._resources[this._res_index];switch(t){case GC_CharacterAnimState.IDLE:this._character_display.animation.play(e.idle_anim_name);break;case GC_CharacterAnimState.MOVING:this._character_display.animation.play(e.move_anim_name);break;case GC_CharacterAnimState.ATTACKING:this._character_display.animation.play(e.attack_anim_name,1),this._attack_trigger=!0;break;case GC_CharacterAnimState.DYING:this._death_comp.start_die(this._binded_entity.character_type()==GameCharacterType.Assaulter),this._health_view.visible=!1;break;default:this._character_display.animation.play(e.idle_anim_name)}}},e.prototype.start_vibration_anim=function(){this._vibration_comp.vibrate(),this._character_display.filters=[this._vibration_filter]},e.prototype.vibration_comp=function(){this._character_display.filters=null},e.prototype.start_stride=function(){this._stride_comp.stride(this._binded_entity.character_type()==GameCharacterType.Assaulter)},e.prototype.update_frame=function(){var t=this._death_comp.is_dying(),e=this._vibration_comp.is_vibrating(),i=this._stride_comp.is_striding();if(t)return this._death_comp.update(),this._modify_character_x(this._death_comp.current_x()),this._modify_character_y(this._death_comp.current_y()),void this._modify_character_alpha(this._death_comp.current_alpha());if(!e&&!i)return void this._modify_character_x(0);var o=0;i&&(this._stride_comp.update(),o=this._stride_comp.stride_pos());var _=o;e&&(this._vibration_comp.update(),_+=this._vibration_comp.vibration_offset()),this._modify_character_x(_)},e.prototype._modify_character_x=function(t){(0!=this._character_x||0!=t)&&(this._character_x=t,this._character_display.x=this._character_x)},e.prototype._modify_character_y=function(t){this._character_display.y=t},e.prototype._modify_character_alpha=function(t){this._character_display.alpha=t},e}(GC_Ele_BaseView);__reflect(GC_CharacterView.prototype,"GC_CharacterView",["IGCCV_death_listener","IGCCV_vibrationListener"]);var GCCV_death=function(t){function e(e){var i=t.call(this)||this;return i._is_reverse=!1,i._is_dying=!1,i._current_x=0,i._current_y=0,i._current_alpha=0,i._x_offset=0,i._anim_cursor=0,i._listener=e,i}return __extends(e,t),e.prototype.is_dying=function(){return this._is_dying},e.prototype.current_x=function(){return this._current_x},e.prototype.current_y=function(){return this._current_y},e.prototype.current_alpha=function(){return this._current_alpha},e.prototype.start_die=function(t){this._anim_cursor=0,this._x_offset=t?-200:200,this._is_dying=!0,this._is_reverse=t},e.prototype.update=function(){if(!this._is_dying)return!1;var t=60,e=this._anim_cursor/t,i=1-Math.pow(e-1,2);this._current_x=this._x_offset*i;var o=150,_=Math.pow(i-.5,2);return this._current_y=-o+4*o*_,this._current_alpha=1-e,this._anim_cursor++,this._anim_cursor==t&&(this._is_dying=!1,this._anim_cursor=0,this._listener.listen_death_anim_comp()),!0},e}(ns_sirius.sirius_base_object);__reflect(GCCV_death.prototype,"GCCV_death");var CharacterHealthView=function(t){function e(){var e=t.call(this)||this,i=50,o=4,_=new egret.Shape,r=_.graphics;r.clear(),r.beginFill(15610702),r.drawRect(0,0,i,o),r.endFill(),e.addChild(_);var n=new egret.Shape;return r=n.graphics,r.clear(),r.beginFill(5170750),r.drawRect(0,0,i,o),r.endFill(),e.addChild(n),e.front=n,e.visible=!1,e}return __extends(e,t),e.prototype.update_prog=function(t){this.front.scaleX=t,this.visible=!0},e}(egret.DisplayObjectContainer);__reflect(CharacterHealthView.prototype,"CharacterHealthView");var GCCV_stride=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._stride_start_pos=0,e._stride_end_offset=0,e._is_striding=!1,e._stride_pos=0,e._stride_anim_cursor=0,e}return __extends(e,t),e.prototype.is_striding=function(){return this._is_striding},e.prototype.stride_pos=function(){return this._stride_pos},e.prototype.stride=function(t){this._stride_anim_cursor=0,this._stride_end_offset=t?50:-50,this._is_striding=!0},e.prototype.update=function(){if(!this._is_striding)return!1;var t=40,e=this._stride_anim_cursor/t,i=Math.sqrt(1-Math.pow(e-1,2));return this._stride_pos=this._stride_start_pos+this._stride_end_offset*i,this._stride_anim_cursor++,this._stride_anim_cursor==t&&(this._is_striding=!1,this._stride_anim_cursor=0),!0},e}(ns_sirius.sirius_base_object);__reflect(GCCV_stride.prototype,"GCCV_stride");var GCCV_vibration=function(t){function e(e){var i=t.call(this)||this;return i._is_vibrating=!1,i._vibration_offset=0,i._anim_cursor=0,i._listener=e,i}return __extends(e,t),e.prototype._before_destroy=function(){this._listener=null},e.prototype.is_vibrating=function(){return this._is_vibrating},e.prototype.vibration_offset=function(){return this._vibration_offset},e.prototype.vibrate=function(){this._anim_cursor=0,this._is_vibrating=!0},e.prototype.update=function(){if(!this._is_vibrating)return!1;var t=15,e=35,i=this._anim_cursor/t,o=e-i*e,_=4*Math.PI*i,r=o*Math.sin(_);return this._vibration_offset=r,this._anim_cursor++,this._anim_cursor==t?(this._is_vibrating=!1,this._anim_cursor=0,this._listener.vibration_comp(),!1):!0},e}(ns_sirius.sirius_base_object);__reflect(GCCV_vibration.prototype,"GCCV_vibration");var GC_MapView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.rooms_init=function(){this._born_room_init(),this._boss_room_init()},e.prototype.game_res_dispose=function(){this.boss_room&&(this.boss_room.destroy(),this.boss_room=null),this.born_room&&(this.born_room.destroy(),this.born_room=null)},e.prototype._boss_room_init=function(){var t=new GC_BossRoomView;this.boss_room=t,this.addChild(t),this._update_boss_room_pos()},e.prototype._born_room_init=function(){var t=new GC_BornRoomView;this.born_room=t,this.addChild(t),this._update_born_room_pos()},e.prototype.update_pp_param=function(){this._update_boss_room_pos(),this._update_born_room_pos()},e.prototype._update_boss_room_pos=function(){var t=gp_core.map;if(t){var e=t.boss_room;this.boss_room.x=e.layout_info.d3_point_local.x,this.boss_room.y=e.layout_info.d3_point_local.y,this.boss_room.scaleX=e.layout_info.d3_scale.x,this.boss_room.scaleY=e.layout_info.d3_scale.y}},e.prototype._update_born_room_pos=function(){var t=gp_core.map;if(t){var e=t.born_room;this.born_room.x=e.layout_info.d3_point_local.x,this.born_room.y=e.layout_info.d3_point_local.y,this.born_room.scaleX=e.layout_info.d3_scale.x,this.born_room.scaleY=e.layout_info.d3_scale.y}},e.prototype.debug_born_pawn=function(){var t=new GC_CharacterView;return this.addChild(t),t},e}(GC_Ele_BaseView);__reflect(GC_MapView.prototype,"GC_MapView");var GC_BornRoomView=function(t){function e(){var e=t.call(this)||this;return e.load(e.createView),e}return __extends(e,t),e.prototype.createView=function(){var t=new egret.MovieClipDataFactory(this._mcData,this._mcTexture),e=new egret.MovieClip(t.generateMovieClipData("NewProject"));this.addChild(e),e.gotoAndPlay(1,-1),e.x=0,e.y=0,e.scaleX=2,e.scaleY=2},e.prototype.load=function(t){var e=this,i=0,o=this,_=function(){i++,2==i&&t.call(o)},r=new egret.URLLoader;r.addEventListener(egret.Event.COMPLETE,function(t){var i=t.currentTarget;e._mcTexture=i.data,_()},this),r.dataFormat=egret.URLLoaderDataFormat.TEXTURE;var n=new egret.URLRequest("resource/LK/game_core/portal/portal_tex.png");r.load(n);var r=new egret.URLLoader;r.addEventListener(egret.Event.COMPLETE,function(t){var i=t.currentTarget;e._mcData=JSON.parse(i.data),_()},this),r.dataFormat=egret.URLLoaderDataFormat.TEXT;var n=new egret.URLRequest("resource/LK/game_core/portal/portal_mc.json");r.load(n)},e}(GC_RoomView);__reflect(GC_BornRoomView.prototype,"GC_BornRoomView");var GC_BossRoomView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_RoomView);__reflect(GC_BossRoomView.prototype,"GC_BossRoomView");var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.CommonRedBtnView=e,__reflect(e.prototype,"game.CommonRedBtnView")}(game||(game={}));var AnimRes=function(){function t(t,e,i,o,_,r,n,s,a,c){void 0===t&&(t=0),void 0===e&&(e=""),void 0===i&&(i=""),void 0===o&&(o=""),void 0===_&&(_=""),void 0===r&&(r=""),void 0===n&&(n=""),void 0===s&&(s="attack"),void 0===a&&(a="standby"),void 0===c&&(c="run"),this.all_loaded=!1,this.idle_anim_name="standby",this.move_anim_name="run",this.attack_anim_name="attack",this.res_id=t,this.res_data_key=e,this.path_ske=i,this.path_tex_config=o,this.path_tex_img=_,this.armature_name=r,this.character_name=n,this.idle_anim_name=a,this.move_anim_name=c,this.attack_anim_name=s}return t}();__reflect(AnimRes.prototype,"AnimRes");var CriticalResLoader=function(){function t(){var t=new Array;this._resources=t,t.push(new AnimRes(1,"map","resource/LK/game_core/canvas_mesh/canvas_mesh_ske.json","resource/LK/game_core/canvas_mesh/canvas_mesh_tex.json","resource/LK/game_core/canvas_mesh/canvas_mesh_tex.png","",""))}return t.prototype.load_res=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o=this;return __generator(this,function(_){for(this._load_count=this._resources.length,t=0,e=this._resources;t<e.length;t++)i=e[t],this._load_ske_res(i);return[2,new Promise(function(t,e){o._cb_s=t,o._cb_f=e})]})})},t.prototype._load_ske_res=function(t){var e=this;RES.getResByUrl(t.path_ske,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this;RES.getResByUrl(t.path_tex_config,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this;RES.getResByUrl(t.path_tex_img,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&(console.log("ALL loaded"),this._cb_s())},t.prototype.find_res_by_name=function(t){return this._resources[0]},t}();__reflect(CriticalResLoader.prototype,"CriticalResLoader");var EffectResLoader=function(){function t(){}return t.prototype.load_res=function(){},t.prototype._load_ske_res=function(t){var e=this;RES.getResByUrl(t.path_ske,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this;RES.getResByUrl(t.path_tex_config,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this;RES.getResByUrl(t.path_tex_img,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){t.all_loaded=!0;var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&console.log("特效资源加载完毕")},t}();__reflect(EffectResLoader.prototype,"EffectResLoader");var GameCoreResManager=function(){function t(){var t=new Array;this._resources=t,t.push(new AnimRes(1,"gugong","resource/LK/game_core/characters/gugong/gugong_ske.json","resource/LK/game_core/characters/gugong/gugong_tex.json","resource/LK/game_core/characters/gugong/gugong_tex.png","Armature","gugong","attack01")),t.push(new AnimRes(2,"kulouzhanshizhengti","resource/LK/game_core/characters/kulouzhanshizhengti/kulouzhanshizhengti_ske.json","resource/LK/game_core/characters/kulouzhanshizhengti/kulouzhanshizhengti_tex.json","resource/LK/game_core/characters/kulouzhanshizhengti/kulouzhanshizhengti_tex.png","Armature","kulouzhanshizhengti")),t.push(new AnimRes(3,"silingfazhengti","resource/LK/game_core/characters/silingfazhengti/silingfazhengti_ske.json","resource/LK/game_core/characters/silingfazhengti/silingfazhengti_tex.json","resource/LK/game_core/characters/silingfazhengti/silingfazhengti_tex.png","Armature死灵法_切图","silingfazhengti")),t.push(new AnimRes(4,"knight","resource/LK/game_core/characters/knight/knight_ske.json","resource/LK/game_core/characters/knight/knight_tex.json","resource/LK/game_core/characters/knight/knight_tex.png","Armature","无头骑士-优化效果","attack01"))}return t.prototype.load_res=function(){this._load_count=this._resources.length;for(var t=0,e=this._resources;t<e.length;t++){var i=e[t];this._load_ske_res(i)}},t.prototype._load_ske_res=function(t){var e=this;RES.getResByUrl(t.path_ske,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this;RES.getResByUrl(t.path_tex_config,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this;RES.getResByUrl(t.path_tex_img,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&gp_core.start_game()},t}();__reflect(GameCoreResManager.prototype,"GameCoreResManager");var GameUIView=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e.topView=new GameUIViewTop,e.addChild(e.topView),e.topView.top=0,e.topView.left=0,e.topView.right=0,e.topView.height=230*COMMON_consts.scaleW,e.bottomView=new GameUIViewBottom,e.addChild(e.bottomView),e.bottomView.bottom=0,e.bottomView.left=0,e.bottomView.right=0,e.bottomView.height=112*COMMON_consts.scaleW,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.btn_debug_click2=function(t){sirius.view_manager.show_popup_text_msg("你点击了 GameUIView 上的按钮")},e}(ns_sirius.sirius_view_base);__reflect(GameUIView.prototype,"GameUIView");var GameUIViewBottom=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/ZL/skins/bottom/GameUIViewBottom.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),console.log(this.group_skill),this.skill.height=90*COMMON_consts.scaleW,this.skill.count.size=COMMON_consts.font_size_22,this.skill.total.size=COMMON_consts.font_size_22,this.group_skill_01.count.size=this.group_skill_02.count.size=this.group_skill_03.count.size=this.group_skill_04.count.size=COMMON_consts.font_size_18,this.group_skill_01.height=this.group_skill_02.height=this.group_skill_03.height=this.group_skill_04.height=88*COMMON_consts.scaleW,this.skill.count.text="10",this.skill.total.text="10",this.group_skill_01.image.source="bottom_button_skill01",this.group_skill_01.count.text="2",this.group_skill_02.image.source="bottom_button_skill02",this.group_skill_03.image.source="bottom_button_skill03",this.group_skill_04.image.source="bottom_button_skill04",this.group_skill_01.index=0,this.group_skill_02.index=1,this.group_skill_03.index=2,this.group_skill_04.index=3,this.group_skill_01.touchEnabled=!0,this.group_skill_02.touchEnabled=!0,this.group_skill_03.touchEnabled=!0,this.group_skill_04.touchEnabled=!0,this.group_skill_01.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_02.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_03.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this),this.group_skill_04.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillClick,this)},e.prototype.skillClick=function(t){var e=t.target,i=parseInt(e.count.text);if(!(0>=i)){i--,e.count.text=i+"";var o=e.index;switch(o){case 0:console.log("bottom 1");break;case 1:console.log("bottom 2");break;case 2:console.log("bottom 3");break;case 3:console.log("bottom 4")}}},e}(eui.Component);__reflect(GameUIViewBottom.prototype,"GameUIViewBottom",["eui.UIComponent","egret.DisplayObject"]);var GameUIViewTop=function(t){function e(){var e=t.call(this)||this;return e.debug_flag=!1,e.skinName="resource/ZL/skins/top/GameUIViewTop.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),console.log(this.btn_area),this.progress.label.size=COMMON_consts.font_size_22,this.coin.label.size=COMMON_consts.font_size_22,this.times.label.size=COMMON_consts.font_size_22,this.btn_area.$children[1].size=COMMON_consts.font_size_22,this.btn_x.$children[1].size=COMMON_consts.font_size_22,this.btn_auto.$children[1].size=COMMON_consts.font_size_22,this.btn_area.touchEnabled=!0,this.btn_area.currentState="goFar",this.btn_area.addEventListener(egret.TouchEvent.TOUCH_TAP,this.areaClick,this),this.btn_x.touchEnabled=!0,this.btn_x.currentState="x1",this.btn_x.addEventListener(egret.TouchEvent.TOUCH_TAP,this.xClick,this),this.btn_auto.touchEnabled=!0,this.btn_auto.currentState="auto",this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,this.autoClick,this),this.setProgress(200,320),this.coin.icon.source="top_icon_gold",this.coin.label.text="55",this.times.icon.source="top_icon_task",this.times.label.text="X5"},e.prototype.setProgress=function(t,e){this.progress.label.text=t+"\\"+e;var i=t/e;this.progress.value=100*i},e.prototype.areaClick=function(){gp_core.swap_scale_x(),console.log(this.btn_area),"goFar"==this.btn_area.currentState?this.btn_area.currentState="goNear":this.btn_area.currentState="goFar"},e.prototype.xClick=function(){this.debug_flag=!this.debug_flag,this.debug_flag?sirius.view_manager.show_module("GameWin"):sirius.view_manager.pop_top_module(),"x1"==this.btn_x.currentState?this.btn_x.currentState="x2":this.btn_x.currentState="x1"},e.prototype.autoClick=function(){"auto"==this.btn_auto.currentState?this.btn_auto.currentState="handMove":this.btn_auto.currentState="auto"},e}(eui.Component);__reflect(GameUIViewTop.prototype,"GameUIViewTop",["eui.UIComponent","egret.DisplayObject"]);var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.BottomSkill=e,__reflect(e.prototype,"game.BottomSkill")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);t.BottomSkillItem=e,__reflect(e.prototype,"game.BottomSkillItem")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.TopCoin=e,__reflect(e.prototype,"game.TopCoin")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setPosition=function(t,e){e>2&&98>e?(this.stick.visible=!0,this.stick.x=t*(.01*e)):this.stick.visible=!1},e}(t.CommonProcessBar);t.ExpProcessBarView=e,__reflect(e.prototype,"game.ExpProcessBarView")}(game||(game={}));var GamePlayCore=function(t){function e(){var e=t.call(this)||this;return e.layout_config=new GPC_layout_config,e._pan_handler=new GameCorePanHandler,e.ppc=new PerspectiveCore,e._machine=new MWN_machine,e._machine.machine_initialize(e,e,null),e}return __extends(e,t),e.prototype.core_init=function(t){this.stage=t,this._pan_handler.core_init(this,t)},e.prototype.register_core_view=function(t,e){this.ppc.core_init(this.stage,e),this._game_core_view=t,this._game_core_view.core_init(this)},e.prototype.prepare_game=function(){this._machine.state_change(MWN_GM_State_Enum.PREPARE)},e.prototype.start_game=function(){this._machine.state_change(MWN_GM_State_Enum.RUNNING)},e.prototype.end_game=function(){this._machine.state_change(MWN_GM_State_Enum.END)},e.prototype.sm_state_changed=function(t,e,i){console.log("from : "+t.state_str()+" to : "+e.state_str())},e.prototype._sm_prepare=function(){var t=5,e=5;this.layout_config.cal_layout(t,e),this.ppc._shader_offset_y=this.layout_config.shader_offset_y_max,this._game_core_view.prepare_game(),this._generate_map_layout(),this._game_core_view.room_start_painting(),console.log("========== LAYOUT =========="),console.log(this.layout_config),console.log("========== MAP =========="),console.log(this.map),this.resm=new GameCoreResManager,this.resm.load_res(),this.effect_resm=new EffectResLoader,this.effect_resm.load_res()},e.prototype._sm_running=function(){this.am=new GP_ActorManager,this.am.manager_init(this),this._game_core_view.start_game(),this.map.debug_generate_defenders()},e.prototype._sm_end=function(){this._dispose_res()},e.prototype.swap_scale_x=function(){this._pan_handler.swap_anim()},e.prototype.mark_perspective_needs_update=function(){this._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING&&(this.map.perspective_update(),this._game_core_view.perspective_update())},e.prototype._generate_map_layout=function(){this.map&&this.map.destroy(),this.map=new GameMap,this.map.generate_map_layout(),this.map.perspective_update()},e.prototype._dispose_res=function(){this.map&&(this.map.destroy(),this.map=null),this.am&&(this.am.destroy(),this.am=null),this._game_core_view.game_res_dispose()},e}(ns_sirius.sirius_base_object);__reflect(GamePlayCore.prototype,"GamePlayCore",["ns_sirius.IGP_StateMachineListener"]);var COMMON_consts=function(){function t(){}return t.generate_consts=function(){t.scaleW=sirius.device_info.safe_width/sirius.device_info.design_width,t.font_size_22=22*t.scaleW,t.font_size_18=18*t.scaleW},t}();__reflect(COMMON_consts.prototype,"COMMON_consts");var GPC_layout_config=function(){function t(){this.row_gap=20,this.column_gap=20,this.header_height=100,this.footer_height=110,this.canvas_fixed_w=512,this.canvas_fixed_h=1024,this.row_count=-1,this.column_count=-1,this.shader_offset_x_min=0,this.shader_offset_x_max=0,this.shader_offset_y_min=0,this.shader_offset_y_max=0,this.canvas_scale_x=0,this.canvas_scale_y=0,this.horizontal_fixed=!1}return t.prototype.cal_layout=function(e,i){this.column_count=i,this.row_count=e,this.element_count=this.column_count*this.row_count,this.cell_w=Math.ceil(sirius.device_info.initial_optimal_w/3),this.cell_h=Math.ceil(209*this.cell_w/170),t.distance_ratio_w_to_h=(this.cell_w+this.column_gap)/(this.cell_h+this.row_gap),this.boss_w=3*this.cell_w,this.boss_h=this.cell_h,this.pawn_born_width=this.cell_w,this.pawn_born_height=this.cell_h,this.room_orig_y=this.header_height+this.pawn_born_height;var o=this.row_count*(this.cell_h+this.row_gap);this.total_w=this.column_count*this.cell_w+(this.column_count-1)*this.column_gap,this.total_h=o+this.header_height+this.boss_h+this.footer_height+this.pawn_born_height,this.boss_x=.5*(this.total_w-this.boss_w),this.boss_y=this.room_orig_y+o,this.pawn_born_x=.5*this.total_w,this.pawn_born_y=this.header_height+.5*this.pawn_born_height,this.canvas_scale_x=this.total_w/this.canvas_fixed_w,this.canvas_scale_y=this.total_h/this.canvas_fixed_h;var _=2*this.total_h/sirius.device_info.stage_height;this.shader_offset_y_max=_-2;var r=2*this.total_w/sirius.device_info.initial_optimal_w,n=.5*Math.abs(r-1);this.shader_offset_x_min=-n,this.shader_offset_x_max=n,this.pr_w_ratio=this.canvas_fixed_w/this.total_w,this.pr_h_ratio=this.canvas_fixed_h/this.total_h},t.prototype.rowcolumn_to_uindex=function(t,e){if(0>t||0>e)return-1;if(t>this.row_count-1||e>this.column_count-1)return-1;var i=t*this.column_count+e;return i},t.prototype.uindex_to_rowcolumn=function(t){if(0>t||t>this.element_count-1)return new egret.Point(-1,-1);var e=Math.floor(t/this.column_count),i=t-e*this.column_count;return new egret.Point(e,i)},t.distance_ratio_w_to_h=1,t}();__reflect(GPC_layout_config.prototype,"GPC_layout_config");var GP_ActorManager=function(t){function e(){var e=t.call(this)||this;return e._pawn_born_cursor=0,e._defenders_needs_check_death=!1,e._assaulters_needs_check_death=!1,e._assault_depth_needs_update=!1,e._actors_defence=new Array,e._actors_assault=new Array,e}return __extends(e,t),e.prototype.mark_defenders_check_death=function(){this._defenders_needs_check_death=!0},e.prototype.mark_assaulters_check_death=function(){this._assaulters_needs_check_death=!0},e.prototype.mark_assault_depth_update=function(){this._assault_depth_needs_update=!0},e.prototype._before_destroy=function(){for(var t=this._actors_defence.length,e=0;t>e;e++)this._actors_defence[e].destroy();this._actors_defence=null,t=this._actors_assault.length;for(var e=0;t>e;e++)this._actors_assault[e].destroy();this._actors_assault=null,this._gc.stage.removeEventListener(egret.Event.ENTER_FRAME,this._gc_update,this),this._gc=null},e.prototype.manager_init=function(t){this._gc=t,this._gc.stage.addEventListener(egret.Event.ENTER_FRAME,this._gc_update,this)},e.prototype._gc_update=function(t){if(this._gc._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING){var e=this._actors_assault.length;this._pawn_born_cursor++;var i=120;if(this._pawn_born_cursor==i&&(this._pawn_born_cursor=0,20>e)){var o=this.born_pawn(GameCharacterType.Assaulter);o.character_init(GameMap.born_room_id,-1)}this._frame_update()}},e.prototype._frame_update=function(){var t=0;t=this._actors_defence.length;for(var e=0;t>e;e++){var i=this._actors_defence[e];i.is_dead()||this._actors_defence[e].frame_update()}t=this._actors_assault.length;for(var e=0;t>e;e++){var o=this._actors_assault[e];o.is_dead()||o.frame_update()}this._defenders_needs_check_death&&(this._defenders_needs_check_death=!1,this._actors_defence=this._check_dead_actors(this._actors_defence)),this._assaulters_needs_check_death&&(this._assaulters_needs_check_death=!1,this._actors_assault=this._check_dead_actors(this._actors_assault)),this._assault_depth_needs_update&&(this._assault_depth_needs_update=!1,this._gc.map.assault_depth_update())},e.prototype.born_pawn=function(t){var e,i=this._gc._game_core_view.debug_born_pawn();return t==GameCharacterType.Defender?(e=new GamePawn_Defence,this._actors_defence.push(e)):t==GameCharacterType.Assaulter&&(e=new GamePawn_Assault,this._actors_assault.push(e)),e.bind_view(i),i.bind_entity(e),this.debug_init_battle_infop(e,t),e},e.prototype.debug_init_battle_infop=function(t,e){e==GameCharacterType.Defender?(t.md_battle.current_life=t.md_battle.total_life=1e3,t.md_battle.attack=200,t.md_battle.accuracy=1e3,t.md_battle.dodge=1e3,t.md_battle.action_interval=1e3):e==GameCharacterType.Assaulter?(t.md_battle.current_life=t.md_battle.total_life=700,t.md_battle.attack=300,t.md_battle.accuracy=1e3,t.md_battle.dodge=1e3,t.md_battle.action_interval=1e3):console.error("ERROR !")},e.prototype._check_dead_actors=function(t){for(var e=t.length,i=new Array,o=0;e>o;o++){var _=t[o];_.is_dead()?_.destroy():i.push(_)}return i},e}(ns_sirius.sirius_base_object);__reflect(GP_ActorManager.prototype,"GP_ActorManager");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.mm=new t.module_marshal,i.layes=new t.layer_partition,i.sirius_public=new t.SiriusPublic,i}return __extends(i,e),i.prototype.core_init=function(){this.mm.core_init(this),this.layes.core_init(this),this.sirius_public.core_init(this)},i}(t.sirius_base_object);t.SiriusCore=e,__reflect(e.prototype,"ns_sirius.SiriusCore")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.view_manager=new t.app_vh_manager,i.device_info=new t.sirius_device_info,i}return __extends(i,e),i.prototype.core_init=function(t){this._sirius=t,this.view_manager.core_init(t)},i.prototype.debug_foo=function(){this.view_manager.show_popup_text_msg("You are connected to the sirius hierarchy.")},i}(t.sirius_element_module);t.SiriusPublic=e,__reflect(e.prototype,"ns_sirius.SiriusPublic")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.design_width=640,e.design_height=1136,e.stage_width=0,e.stage_height=0,e.safe_width=0,e.safe_height=0,e.initial_optimal_w=0,e}return __extends(e,t),e.prototype.syn_stage_size=function(t,e){this.stage_width=t,this.stage_height=e,this.safe_height=e,this.safe_width=t>this.design_width?this.design_width:t},e.prototype.device_info_init=function(){var t=Math.ceil(1125*this.design_height/2436);this.stage_width>=this.design_width?this.initial_optimal_w=this.design_width:this.stage_width<t?this.initial_optimal_w=t:this.initial_optimal_w=this.stage_width},e}(t.sirius_base_object);t.sirius_device_info=e,__reflect(e.prototype,"ns_sirius.sirius_device_info")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return"Default"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(t.GP_StateBase);t.GP_State_Default=e,__reflect(e.prototype,"ns_sirius.GP_State_Default")}(ns_sirius||(ns_sirius={}));var GameCorePanHandler=function(t){function e(){var e=t.call(this)||this;return e._scale_is_anim=!1,e._anim_count=20,e._anim_cursor=0,e._start_ox=0,e._start_mouse_x=0,e._start_oy=0,e._start_mouse_y=0,e}return __extends(e,t),e.prototype.core_init=function(t,e){this._gc=t,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouse_down,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouse_move,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.mouse_up,this),e.addEventListener(egret.Event.ENTER_FRAME,this._handle_update,this)
},e.prototype.swap_anim=function(){this._scale_is_anim||(this._anim_cursor=0,this._gc.layout_config.horizontal_fixed=!this._gc.layout_config.horizontal_fixed,this._start_scale=this._gc.ppc._shader_last_scale,this._end_scale=this._gc.layout_config.horizontal_fixed?.6:1,this._scale_step=this._end_scale-this._start_scale,this._start_offset_x=this._gc.ppc._shader_offset_x,this._gc.ppc._shader_offset_x=0,this._end_offset_x=0,this._offsetx_step=this._end_offset_x-this._start_offset_x,this._scale_is_anim=!0)},e.prototype._handle_update=function(t){if(this._scale_is_anim){var e=1e3*this._anim_cursor/this._anim_count/1e3,i=this._start_scale+e*this._scale_step,o=this._start_offset_x+e*this._offsetx_step;this._gc.ppc._shader_offset_x=o,this._gc.ppc._shader_last_scale=i,this._gc.mark_perspective_needs_update(),this._anim_cursor++,this._anim_cursor>=this._anim_count&&(this._scale_is_anim=!1)}},e.prototype.mouse_down=function(t){this._scale_is_anim||(this._start_mouse_x=t.stageX,this._start_ox=this._gc.ppc._shader_offset_x,this._start_mouse_y=t.stageY,this._start_oy=this._gc.ppc._shader_offset_y)},e.prototype.mouse_move=function(t){this._scale_is_anim||(this._move_x(t),this._move_y(t),this._gc.mark_perspective_needs_update())},e.prototype._move_x=function(t){if(this._gc.layout_config.horizontal_fixed)return void(this._gc.ppc._shader_offset_x=0);var e=t.stageX-this._start_mouse_x,i=this._start_ox+.003*e;i>gp_core.layout_config.shader_offset_x_max?i=gp_core.layout_config.shader_offset_x_max:i<gp_core.layout_config.shader_offset_x_min&&(i=gp_core.layout_config.shader_offset_x_min),this._gc.ppc._shader_offset_x=i},e.prototype._move_y=function(t){var e=t.stageY-this._start_mouse_y,i=this._start_oy-.004*e;i>gp_core.layout_config.shader_offset_y_max?i=gp_core.layout_config.shader_offset_y_max:i<gp_core.layout_config.shader_offset_y_min&&(i=gp_core.layout_config.shader_offset_y_min),this._gc.ppc._shader_offset_y=i},e.prototype.mouse_up=function(t){},e}(egret.HashObject);__reflect(GameCorePanHandler.prototype,"GameCorePanHandler");var PerspectiveCore=function(){function t(){this.buffer_point_2d_glboal=new egret.Point,this.buffer_point_3d_glboal=new egret.Point,this._shader_offset_x=0,this._shader_offset_y=0,this._shader_last_scale=1}return t.prototype.core_init=function(t,e){this._stage=t,this._ref_view=e},t.prototype.convert_2_to_3_global=function(t,e,i){var o=.2,_=.5,r=this._stage.stageWidth,n=this._stage.stageHeight,s=2*t.x/r-1,a=2*-t.y/n+1,c=s*this._shader_last_scale,h=a*this._shader_last_scale+this._shader_last_scale-1,u=.5*(h+1)*o+.1*this._shader_offset_y,l=c+this._shader_offset_x,p=h+this._shader_offset_y,d=l*_/(u+_),f=p*_/(u+_);i&&(i.x=this._shader_last_scale*_/(u+_),i.y=i.x),e.x=(d+1)*r*.5,e.y=-(f-1)*n*.5},t.prototype.cal_3d_pos=function(t,e,i){this._ref_view.localToGlobal(t.x,t.y,this.buffer_point_2d_glboal),this.convert_2_to_3_global(this.buffer_point_2d_glboal,this.buffer_point_3d_glboal,i),this._ref_view.globalToLocal(this.buffer_point_3d_glboal.x,this.buffer_point_3d_glboal.y,e)},t}();__reflect(PerspectiveCore.prototype,"PerspectiveCore");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.establish_reflection_table(),e}return __extends(e,t),e.prototype.establish_reflection_table=function(){this._rtable=lk_rtable.concat(yxy_rtable).concat(zl_rtable);for(var t=this._rtable.length,e=0;t>e;e++)this._rtable[e].index=e},e.prototype.register_sm=function(t){this._sm=t},e.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null);var _=this._find_module_by_name(t);if(!_)return void console.error("不存在模块 ： "+t);var r=new _.vm,n=new _.view;this._sm.show_module(n,r,e,i,o)},e.prototype._find_module_by_name=function(t){if(!this._rtable)return null;for(var e=this._rtable.length,i=0;e>i;i++){var o=this._rtable[i];if(o.module_name==t)return o}return null},e}(t.sirius_element_module);t.module_marshal=e,__reflect(e.prototype,"ns_sirius.module_marshal")}(ns_sirius||(ns_sirius={}));var MWN_GM_State_Enum=function(){function t(){}return t.DEFAULT=0,t.IDLE=1,t.PREPARE=2,t.RUNNING=3,t.END=5,t}();__reflect(MWN_GM_State_Enum.prototype,"MWN_GM_State_Enum");var MWN_machine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._s_idle&&(this._s_idle.destroy(),this._s_idle=null),this._s_prepare&&(this._s_prepare.destroy(),this._s_prepare=null),this._s_running&&(this._s_running.destroy(),this._s_running=null),this._s_end&&(this._s_end.destroy(),this._s_end=null),t.prototype._before_destroy.call(this)},e.prototype._states_init=function(t){this._s_idle=new GP_State_IDLE,this._s_idle.state_init(this,t),this._s_prepare=new GP_State_PREPARE,this._s_prepare.state_init(this,t),this._s_running=new GP_State_RUNNING,this._s_running.state_init(this,t),this._s_end=new GP_State_END,this._s_end.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case MWN_GM_State_Enum.IDLE:return this._s_idle;case MWN_GM_State_Enum.PREPARE:return this._s_prepare;case MWN_GM_State_Enum.RUNNING:return this._s_running;case MWN_GM_State_Enum.END:return this._s_end;default:return this._s_default}},e}(ns_sirius.GP_StateMachine);__reflect(MWN_machine.prototype,"MWN_machine");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e.touchEnabled=!1,e}return __extends(e,t),e}(t.sirius_view_base);t.sirius_root_layer=e,__reflect(e.prototype,"ns_sirius.sirius_root_layer");var i=function(i){function o(){return i.call(this)||this}return __extends(o,i),o.prototype.view_hierarchy_establish=function(e){this._app_root_view=e;var i=t.app_layer_def,o=i.length;this.sms=new Array(o);for(var _=0;o>_;_++){var r=i[_],n=this._create_layer_by_def(r);this.sms[_]=n}},o.prototype._create_layer_by_def=function(i){var o=new e;this._app_root_view.addChild(o),o.update_visible(!1),i.disable_touch&&(o.touchEnabled=!1);var _=null;return _=i.exclusive?new t.layer_exclusive_manager:1==i.sm_type?new t.layer_module_sm:new t.layer_stack_manager,_.manager_init(o,i.lid,this._sirius),_},o}(t.sirius_element_module);t.layer_partition=i,__reflect(i.prototype,"ns_sirius.layer_partition")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_visible=!1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype.attach_target_view=function(t){this._target_view=t},e.prototype.show=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),this._is_visible=!0,this._root_view.addChild(this._target_view),this._target_view.attached_to_display_tree(t),this._update_container_visible(),this._target_view},e.prototype.hide=function(){this._is_visible=!1,this._target_view.detaching_from_display_tree(),this._target_view.remove_from_parent(),this._update_container_visible()},e.prototype.clear_all=function(){this.hide()},e.prototype._update_container_visible=function(){this._root_view.update_visible(this._is_visible)},e}(t.sirius_base_object);t.layer_exclusive_manager=e,__reflect(e.prototype,"ns_sirius.layer_exclusive_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show_module=function(t,e,i,o,_){return void 0===i&&(i=null),void 0===o&&(o=null),void 0===_&&(_=null),this._root_view.addChild(t),t.attached_to_display_tree(i),e.vm_pre_init(o,t,this._sirius),t.view_pre_init(i,e,this._sirius),t.view_init(),e.vm_init(),this._s_push(e),this._update_container_visible(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t],i=e.pair_view;i.detaching_from_display_tree(),i.destroy(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_shift(),this._update_container_visible()},e}(t.layer_stack_manager);t.layer_module_sm=e,__reflect(e.prototype,"ns_sirius.layer_module_sm")}(ns_sirius||(ns_sirius={}));var lk_rtable=[{module_name:"Test",view:TestModuleView,vm:TestModuleVM}],GP_State_END=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.END},e.prototype.state_str=function(){return"END"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_end(),this._machine.state_change(MWN_GM_State_Enum.IDLE)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_END.prototype,"GP_State_END");var GP_State_IDLE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.IDLE},e.prototype.state_str=function(){return"IDLE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_IDLE.prototype,"GP_State_IDLE");var ns_sirius;!function(t){t.sirius_network_consts={protocol:"http",host_address:"10.0.2.158:8080"}}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(t){void 0===t&&(t=!0),this.should_parse_json=t}return t}();t.common_req_param=e,__reflect(e.prototype,"ns_sirius.common_req_param");var i=function(i){function o(t){void 0===t&&(t=null);var o=i.call(this)||this;return o._req_param=null,t?o._req_param=t:o._req_param=new e,o}return __extends(o,i),o.prototype._before_destroy=function(){this._req_param=null,this._cb_s=null,this._cb_f=null},o.prototype._handle_fail=function(t){this._cb_f&&this._cb_f(t),this.destroy()},o.prototype._handle_success=function(t){this._cb_s&&this._cb_s(t),this.destroy()},o.prototype.generate_expire=function(){this._expire_dis=new t.DelayDispatcher,this._expire_dis.dispatch(2e4,this,this.handle_req_expired)},o.prototype.handle_req_expired=function(){this._handle_fail("expire")},o.prototype.clear_expire=function(){this._expire_dis&&(this._expire_dis.destroy(),this._expire_dis=null)},o.prototype._combine_url=function(e){var i=t.sirius_network_consts.protocol+"://"+t.sirius_network_consts.host_address+"/"+e;return i},o.prototype.get=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t?(this._url_str=this._combine_url(t),[2,new Promise(function(t,i){e._cb_s=t,e._cb_f=i,e._send_get(e._url_str)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype.post=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){return t?(this._url_str=this._combine_url(t),[2,new Promise(function(t,o){i._cb_s=t,i._cb_f=o,i._send_post(i._url_str,e)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype._send_get=function(t){this.generate_expire();var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.open(t,egret.HttpMethod.GET),e.send(),e.addEventListener(egret.Event.COMPLETE,this.comp,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype._send_post=function(t,e){this.generate_expire();var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(t,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json"),e?i.send(e):i.send(),i.addEventListener(egret.Event.COMPLETE,this.comp,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype.comp=function(t){this.clear_expire();var e=(this._url_str,t.currentTarget),i=e.response;if(this._req_param.should_parse_json){var o=JSON.parse(i);this._handle_success(o)}else this._handle_success(i)},o.prototype.fail=function(t){this.clear_expire();var e=t.currentTarget,i=e.response;this._handle_fail(i)},o}(t.sirius_base_object);t.common_req=i,__reflect(i.prototype,"ns_sirius.common_req")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e.set_bg_color(0,.4),e._icon=new eui.Image,e.addChild(e._icon),e._icon.horizontalCenter=0,e._icon.verticalCenter=0,e._icon.width=100,e._icon.height=100,e._icon.source="loading_icon_png",e._icon.rotation,e}return __extends(e,t),e.prototype.start_anim=function(){egret.Tween.get(this._icon,{loop:!0}).to({rotation:360},5e3)},e.prototype.stop_anim=function(){egret.Tween.removeTweens(this._icon)},e}(t.sirius_view_base);t.sirius_default_loading_view=e,__reflect(e.prototype,"ns_sirius.sirius_default_loading_view")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.set_bg_color(0,.4);return i.ellipseWidth=40,i.ellipseHeight=40,e.left=20,e.right=20,e.height=40,e.verticalCenter=100,e._txt=new eui.Label,e.addChild(e._txt),e._txt.textColor=16777215,e._txt.left=10,e._txt.right=10,e._txt.size=26,e._txt.percentHeight=100,e._txt.textAlign=egret.HorizontalAlign.CENTER,e._txt.verticalAlign=egret.VerticalAlign.MIDDLE,e}return __extends(e,t),e.prototype.show=function(t){this._txt.text=t,egret.Tween.get(this).to({verticalCenter:0},2e3,egret.Ease.cubicOut).to({alpha:0},1e3,egret.Ease.cubicOut)},e}(t.sirius_view_base);t.popup_text_msg=e,__reflect(e.prototype,"ns_sirius.popup_text_msg")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.view_hierarchy_establish=function(e){this._sirius.layes.view_hierarchy_establish(e),this._module_sm=this._sirius.layes.sms[0],this._alert_sm=this._sirius.layes.sms[1],this._fs_cover_sm=this._sirius.layes.sms[2],this._message_sm=this._sirius.layes.sms[3],this._loading_sm=this._sirius.layes.sms[4],this._global_loading_view=new t.sirius_default_loading_view,this._loading_sm.attach_target_view(this._global_loading_view),this._sirius.mm.register_sm(this._module_sm)},i.prototype.switch_global_loading=function(t){t?(this._global_loading_view.start_anim(),this._loading_sm.show()):(this._global_loading_view.stop_anim(),this._loading_sm.hide())},i.prototype.show_popup_text_msg=function(e){var i=this,o=new t.popup_text_msg;this._message_sm.show_view(o),o.show(e),setTimeout(function(){i._message_sm.shift_first()},3500)},i.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null),this._sirius.mm.show_module(t,e,i,o)},i.prototype.pop_top_module=function(){this._module_sm.pop_top()},i}(t.sirius_element_module);t.app_vh_manager=e,__reflect(e.prototype,"ns_sirius.app_vh_manager")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){t.app_layer_def=[{lid:"modules",index:0,exclusive:!1,sm_type:1},{lid:"alert_panel",index:1,exclusive:!1,sm_type:0},{lid:"fullscreen_cover",index:2,exclusive:!1,sm_type:0},{lid:"messages",index:3,exclusive:!1,sm_type:0,disable_touch:!0},{lid:"loading",index:4,exclusive:!0}]}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.ddid=0,e}return __extends(e,t),e.prototype._before_destroy=function(){this._target=null,this._fun=null,this._param=null},e.prototype.dispatch=function(t,e,i,o){var _=this;void 0===o&&(o=null),this._is_destroyed=!1,this._delay_time=t,this._target=e,this._fun=i,this._param=o,setTimeout(function(){_.execute_fun()},t)},e.prototype.execute_fun=function(){this._is_destroyed||this._target&&this._fun&&(this._fun.apply(this._target,this._param),this.destroy())},e}(t.sirius_base_object);t.DelayDispatcher=e,__reflect(e.prototype,"ns_sirius.DelayDispatcher")}(ns_sirius||(ns_sirius={}));var ns_sirius_math;!function(t){function e(t,e,i,o){var _=t-i,r=e-o;return Math.sqrt(_*_+r*r)}t.points_distance=e}(ns_sirius_math||(ns_sirius_math={}));var LocalizationManager=function(){function t(){}return t.prototype.choose_language=function(t){this.lan_key=t,"en"===this.lan_key?(this.COMMON=ui_local_common_en,this.LK=ui_local_lk_en,this.YXY=ui_local_yxy_en,this.ZL=ui_local_zl_en):"cn"===this.lan_key&&(this.COMMON=ui_local_common_cn,this.LK=ui_local_lk_cn,this.YXY=ui_local_yxy_cn,this.ZL=ui_local_zl_cn)},t.prototype.s=function(t,e,i){return void 0===i&&(i="COMMON"),this[i][t][e]},t.prototype.s1=function(t,e,i,o){void 0===o&&(o="COMMON");var _=this[o][t][e],r=_.replace("@{0}",i);return r},t.prototype.sn=function(t,e,i,o){void 0===o&&(o="COMMON");for(var _=this[o][t][e],r=_,n=i.length,s=0;n>s;s++)r=r.replace("@{"+s+"}",i[s]);return r},t}();__reflect(LocalizationManager.prototype,"LocalizationManager");var ui_local_common_cn={global:{confirm:"confirm!",xixi:"DARK"}},ui_local_lk_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"}},ui_local_yxy_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"},gamewin:{jump:"跳过"}},ui_local_zl_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"}},ui_local_common_en={test:{haha:"Sissinghurst Castle Garden, \n        at Sissinghurst in the Weald of Kent in England, \n        was created by Vita Sackville-West, \n        poet and writer, \n        and her husband Harold Nicolson",xixi:"DARK"}},ui_local_lk_en={test:{haha:"Sissinghurst Castle Garden, \n        at Sissinghurst in the Weald of Kent in England, \n        was created by Vita Sackville-West, \n        poet and writer, \n        and her husband Harold Nicolson",xixi:"DARK"}},ui_local_yxy_en={},ui_local_zl_en={};