var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(_,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function n(t){try{a(o["throw"](t))}catch(e){r(e)}}function a(t){t.done?_(t.value):new i(function(e){e(t.value)}).then(s,n)}a((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(_)throw new TypeError("Generator is already executing.");for(;a;)try{if(_=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(o){i=[6,o],r=0}finally{_=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var _,r,s,n,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},ns_sirius;!function(t){var e=function(){function t(){this._is_destroyed=!1}return t.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},t.prototype._before_destroy=function(){},t}();t.sirius_base_object=e,__reflect(e.prototype,"ns_sirius.sirius_base_object",["ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var GamePlayEntityBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++)t[i].destroy()},e.prototype._should_report_dealloc=function(){return!0},e.prototype.destroy=function(){this._should_report_dealloc(),t.prototype.destroy.call(this)},e}(ns_sirius.sirius_base_object);__reflect(GamePlayEntityBase.prototype,"GamePlayEntityBase");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype.destroy=function(){this._before_destroy(),this._is_destroyed=!0},e.prototype._before_destroy=function(){console.log("======= sirius_view_base  destroy ======= "),console.log(this.constructor.name+" destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent()},e.prototype.attached_to_display_tree=function(t){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e.prototype.remove_all_children=function(){this.removeChildren()},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.update_visible=function(t){this.visible=t},e.prototype.mark_as_fullfill=function(){this.percentWidth=100,this.percentHeight=100,this.x=0,this.y=0},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e}(eui.Component);t.sirius_view_base=e,__reflect(e.prototype,"ns_sirius.sirius_view_base",["ns_sirius.Isirius_base_object"])}(ns_sirius||(ns_sirius={}));var GameActor=function(t){function e(){var e=t.call(this)||this;return e._is_dead=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"is_dead",{get:function(){return this._is_dead},enumerable:!0,configurable:!0}),e.prototype._should_report_dealloc=function(){return!1},e.prototype.sentenced_to_death=function(){this._is_dead=!0},e.prototype.round_start=function(){},e.prototype.round_end=function(){},e.prototype.frame_update=function(t){},e}(GamePlayEntityBase);__reflect(GameActor.prototype,"GameActor");var GC_Ele_BaseView=function(t){function e(){var e=t.call(this)||this;return e._is_destroyed=!1,e}return __extends(e,t),e.prototype._destroy_arr=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];o.destroy()}},e.prototype.destroy=function(){console.log(this.constructor.name+" destroy"),this._before_destroy(),this.parent&&this.parent.removeChild(this),this._is_destroyed=!0},e.prototype._before_destroy=function(){},e.prototype.set_bg_color=function(t,e){void 0===e&&(e=1);var i=new eui.Rect;return this.addChildAt(i,0),i.fillColor=t,i.percentWidth=100,i.percentHeight=100,i.alpha=e,i},e.prototype.remove_from_parent=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Group);__reflect(GC_Ele_BaseView.prototype,"GC_Ele_BaseView");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._machine=null,e}return __extends(e,t),e.prototype._before_destroy=function(){this._machine=null},e.prototype.state_init=function(t,e){this._machine=t,this._convert_context(e),this._after_state_init()},e.prototype._convert_context=function(t){},e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return""},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype.state_running=function(t,e){void 0===e&&(e=null)},e}(t.sirius_base_object);t.GP_StateBase=e,__reflect(e.prototype,"ns_sirius.GP_StateBase")}(ns_sirius||(ns_sirius={}));var RoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this.layout_info.destroy(),this.layout_info=null,this.link&&(this.link.destroy(),this.link=null),this._destroy_arr(this.slots_defence),this.slots_defence=null,this._destroy_arr(this.slots_attack),this.slots_attack=null},e.prototype.room_generate=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.layout_init(t,e)},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.link_init(t,this.layout_info.row_index,this.layout_info.column_index)},e}(GamePlayEntityBase);__reflect(RoomEntity.prototype,"RoomEntity");var GC_RoomView=function(t){function e(){var e=t.call(this)||this;return e._room_container=new eui.Group,e.addChild(e._room_container),e._room_container.width=gp_core.layout_config.cell_w,e._room_container.height=gp_core.layout_config.cell_h,e._room_container.x=.5*-gp_core.layout_config.cell_w,e._room_container.y=.5*-gp_core.layout_config.cell_h,e}return __extends(e,t),e}(GC_Ele_BaseView);__reflect(GC_RoomView.prototype,"GC_RoomView");var MWN_State_Base=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._gpcore=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._gpcore=t},e}(ns_sirius.GP_StateBase);__reflect(MWN_State_Base.prototype,"MWN_State_Base");var GameCharacter=function(t){function e(){var e=t.call(this)||this;return e.fixed_direction_weights=[5e4,3e4,2e4,3e4],e.slot_index=-1,e.is_free_to_move=!0,e._from_room_direction=-1,e._current_pos_3d=new egret.Point,e._current_scale_3d=new egret.Point,e.rpps_battle=new Character_RPPS_Battle,e._behavior_move=new Character_Move_Behavior(e),e.room_index=GameMap.born_room_id,e}return __extends(e,t),e.prototype._before_destroy=function(){this._binded_view&&(this._binded_view.destroy(),this._binded_view=null),this._machine=null,this._behavior_move.destroy(),this._behavior_move=null,this.rpps_battle.destroy(),this.rpps_battle=null,t.prototype._before_destroy.call(this)},e.prototype.character_init=function(){this._machine=new CharacterMachine,this._machine.machine_initialize(this,this)},e.prototype.sm_state_changed=function(t,e,i){e.state_enum()==CharacterMachineState.RESIDING&&console.log("RESIDING!!")},e.prototype._sm_start_move_to_next_room=function(){var t=gp_core.map.get_room_by_index(this.room_index),e=this._array_multiply(this.fixed_direction_weights,t.link.availables,4),i=this._cal_direction_by_weights(e,this._from_room_direction),o=t.link.neighbours[i];if(!o)return console.error("未找到下一个房间 : "+i),console.log(t.link.neighbours),void this._machine.state_change(CharacterMachineState.RESIDING);this._from_room_direction=RoomLinkInfo.reverse_direction(i);var _=this._behavior_move.move(t,o),r=0;i==RoomLinkDirection.LEFT?r=1:i==RoomLinkDirection.RIGHT?r=2:i==RoomLinkDirection.FRONT&&o.layout_info.unique_index==GameMap.boss_room_id&&(r=_?2:1),this._binded_view.change_orientation(r)},e.prototype._sm_moved_to_room=function(){return this.room_index=this._behavior_move.to_room.layout_info.unique_index,this.room_index==GameMap.boss_room_id?(this.sentenced_to_death(),2):0},e.prototype.bind_view=function(t){this._binded_view=t},e.prototype.round_start=function(){this._machine.get_current_state_enum()!=CharacterMachineState.MOVING&&this.is_free_to_move&&this._machine.state_change(CharacterMachineState.MOVING),this._machine.round_start()},e.prototype.round_end=function(){this._machine.round_end()},e.prototype.frame_update=function(e){t.prototype.frame_update.call(this,e),this._machine.get_current_state_enum()==CharacterMachineState.MOVING&&this._behavior_move.update(),this._syn_pos(),this._view_update_pos()},e.prototype._syn_pos=function(){if(this._machine.get_current_state_enum()==CharacterMachineState.MOVING)this._current_pos_3d.x=this._behavior_move.current_pos_3d.x,this._current_pos_3d.y=this._behavior_move.current_pos_3d.y,this._current_scale_3d.x=this._behavior_move.current_scale_3d.x,this._current_scale_3d.y=this._behavior_move.current_scale_3d.y;else{var t=gp_core.map.get_room_by_index(this.room_index);this._current_pos_3d.x=t.layout_info.d3_point_local.x,this._current_pos_3d.y=t.layout_info.d3_point_local.y,this._current_scale_3d.x=t.layout_info.d3_scale.x,this._current_scale_3d.y=t.layout_info.d3_scale.y}},e.prototype._view_update_pos=function(){this._binded_view.x=this._current_pos_3d.x,this._binded_view.y=this._current_pos_3d.y,this._binded_view.scaleX=this._current_scale_3d.x,this._binded_view.scaleY=this._current_scale_3d.y},e.prototype._array_multiply=function(t,e,i){for(var o=new Array,_=0;i>_;_++)o[_]=t[_]*e[_];return o},e.prototype._cal_direction_by_weights=function(t,e){for(var i=0,o=new Array(4),_=0;4>_;_++)e==_?o[_]=0:o[_]=Math.random()*t[_];for(var _=1;4>_;_++)o[i]<o[_]&&(i=_);return i},e.prototype._revert_direction=function(){},e}(GameActor);__reflect(GameCharacter.prototype,"GameCharacter",["ns_sirius.IGP_StateMachineListener"]);var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.core_init=function(t){this._sirius=t},e}(t.sirius_base_object);t.sirius_element_module=e,__reflect(e.prototype,"ns_sirius.sirius_element_module")}(ns_sirius||(ns_sirius={}));var CharacterStateBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._character=null,t.prototype._before_destroy.call(this)},e.prototype._convert_context=function(t){this._character=t},e.prototype.round_start=function(){},e.prototype.round_end=function(){},e}(ns_sirius.GP_StateBase);__reflect(CharacterStateBase.prototype,"CharacterStateBase");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._s_default=new t.GP_State_Default,i._current_state=new t.GP_State_Default,i._listener=null,i._ctx=null,i}return __extends(i,e),i.prototype._before_destroy=function(){console.log("[ MACHINE ] DESTROY"),this._ctx=null,this._listener=null,this._current_state=null,this._s_default.destroy(),this._s_default=null},i.prototype.get_current_state=function(){return this._current_state},i.prototype.get_current_state_str=function(){return this._current_state.state_str()},i.prototype.get_current_state_enum=function(){return this._current_state.state_enum()},i.prototype.machine_initialize=function(t,e,i){void 0===i&&(i=null),this._listener=t,this._ctx=e,this._s_default.state_init(this,e),this._states_init(e)},i.prototype._states_init=function(t){},i.prototype.get_state_by_enum=function(t){return null},i.prototype.state_change=function(t,e){void 0===e&&(e=null);var i=this.get_state_by_enum(t);i||console.log("invalid game machine enum "+t);var o=this._current_state;this._current_state=i,o.state_leave(i,e),i.state_enter(o,e),this._listener.sm_state_changed(o,i,e),i.state_running(o,e)},i}(t.sirius_base_object);t.GP_StateMachine=e,__reflect(e.prototype,"ns_sirius.GP_StateMachine")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),console.log("[ "+e.constructor.name+" ] ALLOC"),e}return __extends(e,t),e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._view_before_destroy(),this.remove_all_children(),this.remove_from_parent(),this.init_param=null,this.pair_vm=null},e.prototype.view_pre_init=function(t,e,i){this.init_param=t,this.pair_vm=e,this._sirius=i.sirius_public,this._view_before_init()},e.prototype.view_init=function(){this._view_start_init()},e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(t.sirius_view_base);t.module_view_base=e,__reflect(e.prototype,"ns_sirius.module_view_base")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return console.log("[ "+e.constructor.name+" ] ALLOC"),e.pair_view=null,e.init_param=null,e}return __extends(e,t),e.prototype._before_destroy=function(){console.log("[ "+this.constructor.name+" ] destroy"),this._vm_before_destroy(),this.init_param=null,this.pair_view=null},e.prototype.vm_pre_init=function(t,e,i){this.init_param=t,this.pair_view=e,this._sirius=i.sirius_public,this._vm_before_init()},e.prototype.vm_init=function(){this._vm_start_init()},e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(t.sirius_base_object);t.module_vm_base=e,__reflect(e.prototype,"ns_sirius.module_vm_base")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._mstack=new Array,e._top=-1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype._s_is_empty=function(){return this._top<0?!0:!1},e.prototype._s_push=function(t){this._top<0&&(this._top=-1),this._top++,this._mstack[this._top]=t},e.prototype._s_pop=function(){this._s_is_empty()||(this._mstack[this._top]=null,this._top--)},e.prototype._s_shift=function(){if(!this._s_is_empty()){for(var t=0;t<this._top;t++)this._mstack[t]=this._mstack[t+1];this._top--}},e.prototype._s_clear=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++)this._mstack[t]=null;this._top=-1}},e.prototype._s_top=function(){return this._s_is_empty()?null:this._mstack[this._top]},e.prototype._s_bottom=function(){return this._s_is_empty()?null:this._mstack[0]},e.prototype.show_view=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this._root_view.addChild(t),t.attached_to_display_tree(e),this._s_push(t),this._update_container_visible(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t];e.detaching_from_display_tree(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top();t.detaching_from_display_tree(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom();t.detaching_from_display_tree(),t.destroy(),this._s_shift(),this._update_container_visible()},e.prototype.is_empty=function(){return this._s_is_empty()},e.prototype._update_container_visible=function(){this._s_is_empty()?this._root_view.update_visible(!1):this._root_view.update_visible(!0)},e}(t.sirius_base_object);t.layer_stack_manager=e,__reflect(e.prototype,"ns_sirius.layer_stack_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var GC_MapView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.rooms_init=function(){this._normal_rooms_init(),this._boss_rooms_init()},e.prototype.game_res_dispose=function(){this._destroy_arr(this.rooms),this.rooms=null,this.boss_room&&(this.boss_room.destroy(),this.boss_room=null)},e.prototype._normal_rooms_init=function(){var t=gp_core.map,e=t.rooms.length;this.rooms=new Array(e);for(var i=0;e>i;i++){var o=t.rooms[i],_=o.layout_info.unique_index,r=new GC_RoomView;this.rooms[_]=r,r.x=o.layout_info.d3_point_local.x,r.y=o.layout_info.d3_point_local.y,r.scaleX=o.layout_info.d3_scale.x,r.scaleY=o.layout_info.d3_scale.y,this.addChild(r)}},e.prototype._boss_rooms_init=function(){var t=gp_core.map,e=t.boss_room,i=new GC_BossRoomView;this.boss_room=i,i.x=e.layout_info.d3_point_local.x,i.y=e.layout_info.d3_point_local.y,i.scaleX=e.layout_info.d3_scale.x,i.scaleY=e.layout_info.d3_scale.y,this.addChild(i)},e.prototype.update_pp_param=function(){this._update_normal_rooms_pos(),this._update_boss_room_pos()},e.prototype._update_normal_rooms_pos=function(){var t=gp_core.map;if(t)for(var e=t.rooms.length,i=0;e>i;i++){var o=t.rooms[i],_=this.rooms[i];_.x=o.layout_info.d3_point_local.x,_.y=o.layout_info.d3_point_local.y,_.scaleX=o.layout_info.d3_scale.x,_.scaleY=o.layout_info.d3_scale.y}},e.prototype._update_boss_room_pos=function(){var t=gp_core.map;if(t){var e=t.boss_room;this.boss_room.x=e.layout_info.d3_point_local.x,this.boss_room.y=e.layout_info.d3_point_local.y,this.boss_room.scaleX=e.layout_info.d3_scale.x,this.boss_room.scaleY=e.layout_info.d3_scale.y}},e.prototype.debug_born_pawn=function(){var t=new GC_CharacterView;return this.addChild(t),t},e}(GC_Ele_BaseView);__reflect(GC_MapView.prototype,"GC_MapView");var sirius,gp_core,app_model,AppRootView=function(t){function e(){var e=t.call(this)||this;return e.height=sirius.device_info.design_height,e.width=sirius.device_info.safe_width,e.horizontalCenter=0,e.top=0,e}return __extends(e,t),e}(ns_sirius.sirius_view_base);__reflect(AppRootView.prototype,"AppRootView",["ns_sirius.Isirius_app_root_view"]);var Main=function(t){function e(){var e=t.call(this)||this;return e._debug_flag=!1,e._debug_index=0,app_model=new AppModel,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.load_crit_res().then(function(t){e.createGameScene()},function(t){console.log(t)})},e.prototype.load_crit_res=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[4,app_model.crit_loader.load_res()];case 2:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype._syn_stage_size=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;sirius.device_info.syn_stage_size(t,e)},e.prototype._resize_handler=function(t){this._syn_stage_size(),this._app_root_view.width=sirius.device_info.safe_width,gp_core.ci_perspective_needs_update()},e.prototype.createGameScene=function(){var t=new ns_sirius.SiriusCore;t.core_init(),sirius=t.sirius_public,this._syn_stage_size(),sirius.device_info.device_info_init(),gp_core=new GamePlayCore,gp_core.core_init(this.stage);var e=new GameCoreView;this.addChild(e),gp_core.register_core_view(e,e.get_coord_convert_ref_view()),this._app_root_view=new AppRootView,this.addChild(this._app_root_view),sirius.view_manager.view_hierarchy_establish(this._app_root_view),this.addEventListener(egret.Event.RESIZE,this._resize_handler,this),this._resize_handler(null),setTimeout(function(){gp_core.prepare_game()},1e3)},e.prototype.onButtonClick=function(t){gp_core.start_game()},e.prototype.btn_debug_click2=function(t){var e=gp_core.am._actors;console.log(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function _(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var n=t.split("/");n.pop();var a=n.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(o,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,_,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameBossEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GameCharacter);__reflect(GameBossEntity.prototype,"GameBossEntity");var Character_Move_Behavior=function(t){function e(e){var i=t.call(this)||this;return i._cur_pos_2d=new egret.Point,i.current_pos_3d=new egret.Point,i.current_scale_3d=new egret.Point,i._from_pos=new egret.Point,i._to_pos=new egret.Point,i._pos_step=new egret.Point,i._is_moving=!1,i._character=e,i}return __extends(e,t),e.prototype._before_destroy=function(){this.from_room=null,this.to_room=null,this._character=null,t.prototype._before_destroy.call(this)},e.prototype.move=function(t,e){return this.from_room=t,this.to_room=e,this._move_frame_count=90,this._move_cursor=0,this._from_pos=this.from_room.layout_info.center_pos,this._to_pos=this.to_room.layout_info.center_pos,this._pos_step.x=(this._to_pos.x-this._from_pos.x)/this._move_frame_count,this._pos_step.y=(this._to_pos.y-this._from_pos.y)/this._move_frame_count,this._is_moving=!0,this._to_pos.x>this._from_pos.x},e.prototype.update=function(){this._is_moving?(this._cur_pos_2d.x=this._from_pos.x+this._pos_step.x*this._move_cursor,this._cur_pos_2d.y=this._from_pos.y+this._pos_step.y*this._move_cursor):(this._cur_pos_2d.x=this._to_pos.x,this._cur_pos_2d.y=this._to_pos.y),gp_core.ppc.cal_3d_pos(this._cur_pos_2d,this.current_pos_3d,this.current_scale_3d),this._move_cursor++,this._move_cursor>=this._move_frame_count&&(this._is_moving=!1)},e}(GamePlayEntityBase);__reflect(Character_Move_Behavior.prototype,"Character_Move_Behavior");var GamePawnEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GameCharacter);__reflect(GamePawnEntity.prototype,"GamePawnEntity");var Character_RPPS_Battle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(Character_RPPS_Battle.prototype,"Character_RPPS_Battle");var CharacterMachineState=function(){function t(){}return t.DEFAULT=0,t.IDLE=1,t.MOVING=2,t.RESIDING=3,t.DEATH=4,t}();__reflect(CharacterMachineState.prototype,"CharacterMachineState");var CharacterMachine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._states_init=function(t){this._s_idle=new Character_State_IDLE,this._s_idle.state_init(this,t),this._s_residing=new Character_State_RESIDING,this._s_residing.state_init(this,t),this._s_moving=new Character_State_MOVING,this._s_moving.state_init(this,t),this._s_death=new Character_State_DEATH,this._s_death.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case CharacterMachineState.IDLE:return this._s_idle;case CharacterMachineState.MOVING:return this._s_moving;case CharacterMachineState.RESIDING:return this._s_residing;case CharacterMachineState.DEATH:return this._s_death;default:return this._s_default}},e.prototype._before_destroy=function(){this._s_idle&&(this._s_idle.destroy(),this._s_idle=null),this._s_residing&&(this._s_residing.destroy(),this._s_residing=null),this._s_moving&&(this._s_moving.destroy(),this._s_moving=null),this._s_death&&(this._s_death.destroy(),this._s_death=null)},e.prototype.round_start=function(){var t=this._current_state;t.round_start()},e.prototype.round_end=function(){var t=this._current_state;t.round_end()},e}(ns_sirius.GP_StateMachine);__reflect(CharacterMachine.prototype,"CharacterMachine");var AppModel=function(){function t(){this.lm=new LocalizationManager,this.lm.choose_language("cn"),this.crit_loader=new CriticalResLoader}return t.prototype.app_init=function(){this._post_login_req()},t.prototype._post_login_req=function(){(new ns_sirius.common_req).post("login").then(function(t){console.log("======= 登录成功 ======="),console.log(t)},function(t){console.log("======= 登录失败 =======")})},t}();__reflect(AppModel.prototype,"AppModel");var Character_State_DEATH=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.DEATH},e.prototype.state_str=function(){return"DEATH"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype.state_running=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_DEATH.prototype,"Character_State_DEATH");var Character_State_IDLE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.IDLE},e.prototype.state_str=function(){return"IDLE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_IDLE.prototype,"Character_State_IDLE");var Character_State_MOVING=function(t){function e(){var e=t.call(this)||this;return e._round_cursor=0,e}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.MOVING},e.prototype.state_str=function(){return"MOVING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._character._sm_start_move_to_next_room(),this._round_cursor=0},e.prototype.state_leave=function(t,e){void 0===e&&(e=null),this._round_cursor=0},e.prototype.round_end=function(){if(this._round_cursor++,3==this._round_cursor){var t=this._character._sm_moved_to_room();0==t?(this._round_cursor=0,this._character._sm_start_move_to_next_room()):1==t&&(console.log("停止寻找房间"),this._machine.state_change(CharacterMachineState.RESIDING))}},e}(CharacterStateBase);__reflect(Character_State_MOVING.prototype,"Character_State_MOVING");var Character_State_RESIDING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return CharacterMachineState.RESIDING},e.prototype.state_str=function(){return"RESIDING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(CharacterStateBase);__reflect(Character_State_RESIDING.prototype,"Character_State_RESIDING");var GameMap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._destroy_arr(this.rooms),this.rooms=null,this.boss_room&&(this.boss_room.destroy(),this.boss_room=null)},e.prototype.generate_map_layout=function(){this.born_room=new BornRoomEntity,this.born_room.room_generate(0,0);var t=gp_core.layout_config;this.rooms=new Array(t.element_count);for(var e=t.column_count,i=t.row_count,o=0;i>o;o++)for(var _=0;e>_;_++){var r=new RoomEntity;r.room_generate(_,o);var s=r.layout_info.unique_index;this.rooms[s]=r}this.boss_room=new BossRoomEntity,this.boss_room.room_generate(0,0),this.born_room.link_generate(this);for(var o=0;o<t.element_count;o++)this.rooms[o].link_generate(this);this.boss_room.link_generate(this);for(var _=0;_<t.column_count;_++){var s=(t.row_count-1)*t.column_count+_;this.rooms[s].link.link_to_boss(this)}},e.prototype.perspective_needs_update=function(){for(var t=gp_core.map,e=t.rooms.length,i=0;e>i;i++){var o=t.rooms[i].layout_info;o.update_3d_layout()}t.born_room.layout_info.update_3d_layout(),t.boss_room.layout_info.update_3d_layout()},e.prototype.get_room_by_index=function(t){if(0>t)return t==e.born_room_id?this.born_room:t==e.boss_room_id?this.boss_room:null;var i=this.rooms.length;return t>i-1?null:this.rooms[t]},e.prototype.get_room_by_row_column=function(t,e){var i=gp_core.layout_config.rowcolumn_to_uindex(t,e);return this.get_room_by_index(i)},e.born_room_id=-2,e.boss_room_id=-3,e}(GamePlayEntityBase);__reflect(GameMap.prototype,"GameMap");var BornRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.room_generate=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.born_layout_init()},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.born_link_init(t)},e}(RoomEntity);__reflect(BornRoomEntity.prototype,"BornRoomEntity");var BossRoomEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this.slot_boss&&(this.slot_boss.destroy(),this.slot_boss=null),t.prototype._before_destroy.call(this)},e.prototype.room_generate=function(t,e){this.layout_info=new RoomLayoutInfo,this.layout_info.boss_layout_init()},e.prototype.link_generate=function(t){this.link=new RoomLinkInfo,this.link.boss_link_init(t)},e}(RoomEntity);__reflect(BossRoomEntity.prototype,"BossRoomEntity");var GamePlayCore=function(t){function e(){var e=t.call(this)||this;return e.layout_config=new GPC_layout_config,e._pan_handler=new GameCorePanHandler,e.ppc=new PerspectiveCore,e._machine=new MWN_machine,e._machine.machine_initialize(e,e,null),e}return __extends(e,t),e.prototype.core_init=function(t){this.stage=t,this._pan_handler.core_init(this,t)
},e.prototype.register_core_view=function(t,e){this.ppc.core_init(this.stage,e),this._game_core_view=t,this._game_core_view.core_init(this)},e.prototype.prepare_game=function(){this._machine.state_change(MWN_GM_State_Enum.PREPARE)},e.prototype.start_game=function(){this._machine.state_change(MWN_GM_State_Enum.RUNNING)},e.prototype.end_game=function(){this._machine.state_change(MWN_GM_State_Enum.END)},e.prototype.sm_state_changed=function(t,e,i){console.log("from : "+t.state_str()+" to : "+e.state_str())},e.prototype._sm_prepare=function(){var t=5,e=5;this.layout_config.cal_layout(t,e),this.ppc._shader_offset_y=gp_core.layout_config.shader_offset_y_max,this._game_core_view.prepare_game(),this._generate_map_layout(),this._game_core_view.room_start_painting(),console.log("========== LAYOUT =========="),console.log(this.layout_config),console.log("========== MAP =========="),console.log(this.map),this.resm=new GameCoreResManager,this.resm.load_res()},e.prototype._sm_running=function(){this.am=new GP_ActorManager,this.am.manager_init(this),this._game_core_view.start_game()},e.prototype._sm_end=function(){this._dispose_res()},e.prototype.swap_scale_x=function(){this._pan_handler.swap_anim()},e.prototype.ci_perspective_needs_update=function(){this._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING&&(this.map.perspective_needs_update(),this._game_core_view.perspective_needs_update())},e.prototype._generate_map_layout=function(){this.map&&this.map.destroy(),this.map=new GameMap,this.map.generate_map_layout(),this.map.perspective_needs_update()},e.prototype._dispose_res=function(){this.map&&(this.map.destroy(),this.map=null),this.am&&(this.am.destroy(),this.am=null),this._game_core_view.game_res_dispose()},e}(ns_sirius.sirius_base_object);__reflect(GamePlayCore.prototype,"GamePlayCore",["ns_sirius.IGP_StateMachineListener"]);var RoomLayoutInfo=function(t){function e(){var e=t.call(this)||this;return e.view_pos=new egret.Point,e.center_pos=new egret.Point,e.d3_point_local=new egret.Point,e.d3_scale=new egret.Point,e}return __extends(e,t),e.prototype.layout_init=function(t,e){var i=gp_core.layout_config;this.column_index=t,this.row_index=e,this.unique_index=gp_core.layout_config.rowcolumn_to_uindex(e,t),this.view_pos.x=Math.round(t*(i.column_gap+i.cell_w)),this.view_pos.y=i.room_orig_y+Math.round(e*(i.row_gap+i.cell_h)),this.center_pos.x=this.view_pos.x+Math.round(.5*i.cell_w),this.center_pos.y=this.view_pos.y+Math.round(.5*i.cell_h),this.view_w=i.cell_w,this.view_h=i.cell_h},e.prototype.boss_layout_init=function(){var t=gp_core.layout_config;this.column_index=-2,this.row_index=-2,this.unique_index=GameMap.boss_room_id;var e=t.boss_w,i=t.boss_h;this.view_pos.x=t.boss_x,this.view_pos.y=t.boss_y,this.center_pos.x=this.view_pos.x+Math.round(.5*e),this.center_pos.y=this.view_pos.y+Math.round(.5*i),this.view_w=e,this.view_h=i},e.prototype.born_layout_init=function(){var t=gp_core.layout_config;this.column_index=-2,this.row_index=-2,this.unique_index=GameMap.born_room_id,this.view_pos.x=t.pawn_born_x-.5*t.pawn_born_width,this.view_pos.y=t.pawn_born_y-.5*t.pawn_born_height,this.center_pos.x=t.pawn_born_x,this.center_pos.y=t.pawn_born_y,this.view_w=t.pawn_born_width,this.view_h=t.pawn_born_height},e.prototype.update_3d_layout=function(){gp_core.ppc.cal_3d_pos(this.center_pos,this.d3_point_local,this.d3_scale)},e}(GamePlayEntityBase);__reflect(RoomLayoutInfo.prototype,"RoomLayoutInfo");var RoomLinkDirection=function(){function t(){}return t.FRONT=0,t.LEFT=1,t.BACK=2,t.RIGHT=3,t}();__reflect(RoomLinkDirection.prototype,"RoomLinkDirection");var RoomLinkInfo=function(t){function e(){var e=t.call(this)||this;return e.availables=[0,0,0,0],e.neighbours=[null,null,null,null],e}return __extends(e,t),e.reverse_direction=function(t){switch(t){case RoomLinkDirection.FRONT:return RoomLinkDirection.BACK;case RoomLinkDirection.BACK:return RoomLinkDirection.FRONT;case RoomLinkDirection.LEFT:return RoomLinkDirection.RIGHT;case RoomLinkDirection.RIGHT:return RoomLinkDirection.LEFT}return-1},e.prototype._before_destroy=function(){this.availables=null,this.neighbours=null},e.prototype.link_init=function(t,e,i){var o=gp_core.layout_config.rowcolumn_to_uindex(e+1,i),_=gp_core.layout_config.rowcolumn_to_uindex(e,i-1),r=gp_core.layout_config.rowcolumn_to_uindex(e-1,i),s=gp_core.layout_config.rowcolumn_to_uindex(e,i+1);this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(o),this.neighbours[RoomLinkDirection.LEFT]=t.get_room_by_index(_),this.neighbours[RoomLinkDirection.BACK]=t.get_room_by_index(r),this.neighbours[RoomLinkDirection.RIGHT]=t.get_room_by_index(s),this.availables[0]=this.neighbours[RoomLinkDirection.FRONT]?1:0,this.availables[1]=this.neighbours[RoomLinkDirection.LEFT]?1:0,this.availables[2]=this.neighbours[RoomLinkDirection.BACK]?1:0,this.availables[3]=this.neighbours[RoomLinkDirection.RIGHT]?1:0},e.prototype.born_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(2),this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=1,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.boss_link_init=function(t){this.neighbours[RoomLinkDirection.FRONT]=null,this.neighbours[RoomLinkDirection.LEFT]=null,this.neighbours[RoomLinkDirection.BACK]=null,this.neighbours[RoomLinkDirection.RIGHT]=null,this.availables[0]=0,this.availables[1]=0,this.availables[2]=0,this.availables[3]=0},e.prototype.link_to_boss=function(t){this.neighbours[RoomLinkDirection.FRONT]=t.get_room_by_index(GameMap.boss_room_id),this.availables[0]=1},e}(GamePlayEntityBase);__reflect(RoomLinkInfo.prototype,"RoomLinkInfo");var RoomBossSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomBossSlotEntity.prototype,"RoomBossSlotEntity");var RoomSlotEntity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GamePlayEntityBase);__reflect(RoomSlotEntity.prototype,"RoomSlotEntity");var GameCoreView=function(t){function e(){var e=t.call(this)||this;return e.height=sirius.device_info.design_height,e.width=sirius.device_info.initial_optimal_w,e.horizontalCenter=0,e.top=0,e._bgimg=new eui.Image("game_bg_jpg"),e.addChild(e._bgimg),e._bgimg.top=0,e._bgimg.height=sirius.device_info.design_height,e._bgimg.width=sirius.device_info.design_width,e._bgimg.horizontalCenter=0,e._coord_convert_ref_view=new egret.DisplayObjectContainer,e.addChild(e._coord_convert_ref_view),e._coord_convert_ref_view.width=gp_core.layout_config.total_w,e._coord_convert_ref_view.height=gp_core.layout_config.total_h,e._repos_view(),e}return __extends(e,t),e.prototype.core_init=function(t){this._gc=t},e.prototype.prepare_view_before_game=function(){},e.prototype._repos_view=function(){var t=gp_core.layout_config.total_w,e=sirius.device_info.initial_optimal_w;if(this.map_view){var i=.5*(e-t);this.map_view.x=i,this._coord_convert_ref_view.x=i}this.painting_canvas&&(this.painting_canvas.x=.5*sirius.device_info.initial_optimal_w)},e.prototype.get_coord_convert_ref_view=function(){return this._coord_convert_ref_view},e.prototype.prepare_game=function(){this.painting_canvas=new MapPaintingCanvas,this.addChild(this.painting_canvas),this.painting_canvas.prepare_mesh(),this.painting_canvas.visible=!1,this.map_view=new GC_MapView,this.addChild(this.map_view),this.map_view.width=gp_core.layout_config.total_w,this.map_view.height=gp_core.layout_config.total_h,this._painting_src=new MapPaintingView,this.addChild(this._painting_src),this._painting_src.width=gp_core.layout_config.canvas_fixed_w,this._painting_src.height=gp_core.layout_config.canvas_fixed_h,this._painting_src.visible=!1,this._repos_view()},e.prototype.room_start_painting=function(){this._painting_src.redraw()},e.prototype.start_game=function(){this._draw_rt(),this.map_view.rooms_init()},e.prototype.game_res_dispose=function(){this.painting_canvas.game_res_dispose(),this.painting_canvas.destroy(),this.painting_canvas=null,this.map_view.game_res_dispose(),this.map_view.destroy(),this.map_view=null},e.prototype.perspective_needs_update=function(){this.painting_canvas.update_pp_param(this._gc),this.map_view.update_pp_param()},e.prototype._draw_rt=function(){var t=gp_core.layout_config.canvas_fixed_w,e=gp_core.layout_config.canvas_fixed_h,i=new egret.RenderTexture;i.disposeBitmapData=!0,i.drawToTexture(this._painting_src,new egret.Rectangle(0,0,t,e)),this.painting_canvas.paint_room(i,this._gc),i=null,this.painting_canvas.visible=!0,this.removeChild(this._painting_src),this._painting_src=null},e.prototype.debug_born_pawn=function(){return this.map_view.debug_born_pawn()},e}(ns_sirius.sirius_view_base);__reflect(GameCoreView.prototype,"GameCoreView");var GPC_layout_config=function(){function t(){this.row_gap=10,this.column_gap=10,this.header_height=100,this.footer_height=40,this.canvas_fixed_w=512,this.canvas_fixed_h=1024,this.row_count=-1,this.column_count=-1,this.shader_offset_x_min=0,this.shader_offset_x_max=0,this.shader_offset_y_min=0,this.shader_offset_y_max=0,this.canvas_scale_x=0,this.canvas_scale_y=0,this.horizontal_fixed=!1}return t.prototype.cal_layout=function(t,e){this.column_count=e,this.row_count=t,this.element_count=this.column_count*this.row_count,this.cell_w=Math.ceil(sirius.device_info.initial_optimal_w/3),this.cell_h=Math.ceil(209*this.cell_w/170),this.boss_w=3*this.cell_w,this.boss_h=this.cell_h,this.pawn_born_width=this.cell_w,this.pawn_born_height=this.cell_h,this.room_orig_y=this.header_height+this.pawn_born_height;var i=this.row_count*(this.cell_h+this.row_gap);this.total_w=this.column_count*this.cell_w+(this.column_count-1)*this.column_gap,this.total_h=i+this.header_height+this.boss_h+this.footer_height+this.pawn_born_height,this.boss_x=.5*(this.total_w-this.boss_w),this.boss_y=this.room_orig_y+i,this.pawn_born_x=.5*this.total_w,this.pawn_born_y=this.header_height+.5*this.pawn_born_height,this.canvas_scale_x=this.total_w/this.canvas_fixed_w,this.canvas_scale_y=this.total_h/this.canvas_fixed_h;var o=2*this.total_h/sirius.device_info.stage_height;this.shader_offset_y_max=o-2;var _=2*this.total_w/sirius.device_info.initial_optimal_w,r=.5*Math.abs(_-1);this.shader_offset_x_min=-r,this.shader_offset_x_max=r,this.pr_w_ratio=this.canvas_fixed_w/this.total_w,this.pr_h_ratio=this.canvas_fixed_h/this.total_h},t.prototype.rowcolumn_to_uindex=function(t,e){if(0>t||0>e)return-1;if(t>this.row_count-1||e>this.column_count-1)return-1;var i=t*this.column_count+e;return i},t.prototype.uindex_to_rowcolumn=function(t){if(0>t||t>this.element_count-1)return new egret.Point(-1,-1);var e=Math.floor(t/this.column_count),i=t-e*this.column_count;return new egret.Point(e,i)},t}();__reflect(GPC_layout_config.prototype,"GPC_layout_config");var MapPaintingCanvas=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.game_res_dispose=function(){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null)},e.prototype.paint_room=function(t,e){this._src_texture&&(this._src_texture.disposeBitmapData=!0,this._src_texture.dispose(),this._src_texture=null),this._dragon_display&&(this._src_texture=t,this._dragon_display.scaleX=gp_core.layout_config.canvas_scale_x,this._dragon_display.scaleY=gp_core.layout_config.canvas_scale_y,this._dragon_display.armature.replaceTexture(this._src_texture),this.update_pp_param(e))},e.prototype.prepare_mesh=function(){var t=dragonBones.EgretFactory.factory,e=t.buildArmatureDisplay("Armature","canvas_mesh");this.addChild(e),this._dragon_display=e;var i="#define M_PI 3.1415926535897932384626433832795\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord; \n \nconst float near = 0.5;\nconst vec2 center = vec2(-1.0, 1.0);\n \nuniform float last_scale;\nuniform float offset_x;\nuniform float offset_y;\n \nuniform vec2 projectionVector;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\n \nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main(void) {\n\n    vec2 raw_pos =  (aVertexPosition / projectionVector) + center;\n   \n    //======= 先处理， 处理scale\n    raw_pos.x = raw_pos.x * last_scale;\n    raw_pos.y = raw_pos.y * last_scale + last_scale - 1.0;\n      \n    float rx = raw_pos.x;\n    float ry = raw_pos.y;\n      \n    //根据 ry [-1, 1] 映射 z 值 到  [0, m] 上 ，近平面为 x-o-y平面\n    const float m = 0.2;\n    float rz = (ry + 1.0) * 0.5 * m + offset_y * 0.1;\n    \n    float input_x = rx + offset_x;\n    float input_y = ry + offset_y;\n\n    float res_x =  (input_x * near) / (rz + near);\n    float res_y =  (input_y * near) / (rz + near);\n  \n    vec2 normal_pos = vec2(res_x, res_y);\n  \n    vec2 color_pos = aTextureCoord;  \n    color_pos.x = rx;\n    color_pos.y = ry;\n \n    gl_Position = vec4( normal_pos, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vColor = vec4(color_pos.x, color_pos.y, 0.0,1.0);\n    }\n",o="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\n\nuniform float customUniform;\n\nvoid main(void) { \n     \n    vec4 fg = texture2D(uSampler, vTextureCoord); \n    // fg += (vColor * 0.5);\n    gl_FragColor = fg;\n\n    // gl_FragColor = vColor;\n\n    // gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n}",_=new egret.CustomFilter(i,o,{offset_x:0,offset_y:0,last_scale:1});e.filters=[_],this._customFilter1=_},e.prototype.update_pp_param=function(t){this._customFilter1.uniforms.offset_x=t.ppc._shader_offset_x,this._customFilter1.uniforms.offset_y=t.ppc._shader_offset_y,this._customFilter1.uniforms.last_scale=t.ppc._shader_last_scale},e}(GC_Ele_BaseView);__reflect(MapPaintingCanvas.prototype,"MapPaintingCanvas");var MapPaintingView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.redraw=function(){gp_core.layout_config.canvas_fixed_w,gp_core.layout_config.canvas_fixed_h;this._draw_lines(),this._draw_normal_rooms(),this._draw_boss_room()},e.prototype._draw_normal_rooms=function(){for(var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.rooms.length,_=new Array(o),r=0;o>r;r++){var s=t.rooms[r],n=s.layout_info.unique_index,a=new eui.Image;_[n]=a,a.fillMode=egret.BitmapFillMode.SCALE,a.width=s.layout_info.view_w*e,a.height=s.layout_info.view_h*i,a.x=s.layout_info.view_pos.x*e,a.y=s.layout_info.view_pos.y*i,this.addChild(a),n%7==0?a.source="room_battle_png":n%7==2?a.source="room_f_png":a.source="room_blank_png"}},e.prototype._draw_boss_room=function(){var t=gp_core.map,e=gp_core.layout_config.pr_w_ratio,i=gp_core.layout_config.pr_h_ratio,o=t.boss_room,_=new eui.Image;_.source="room_boss_png",_.width=o.layout_info.view_w*e,_.height=o.layout_info.view_h*i,_.x=o.layout_info.view_pos.x*e,_.y=o.layout_info.view_pos.y*i,this.addChild(_),_.fillMode=egret.BitmapFillMode.SCALE},e.prototype._draw_lines=function(){},e}(GC_Ele_BaseView);__reflect(MapPaintingView.prototype,"MapPaintingView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GC_CharacterView=function(t){function e(){var e=t.call(this)||this,i=Math.floor(3.5*Math.random());e.res_index=i;var o=gp_core.resm._resources[i],_=dragonBones.EgretFactory.factory;return e._character_display=_.buildArmatureDisplay(o.armature_name,o.character_name),e.addChild(e._character_display),e._character_display.animation.play("移动"),e._character_display.scaleX=.5,e._character_display.scaleY=.5,e}return __extends(e,t),e.prototype._before_destroy=function(){this._character_display.dispose(),this._character_display.removeChildren(),this.removeChild(this._character_display),this._character_display=null,this.remove_from_parent()},e.prototype.change_orientation=function(t){0!=t&&(1==t?3==this.res_index?this._character_display.scaleX=-.5:this._character_display.scaleX=.5:3==this.res_index?this._character_display.scaleX=.5:this._character_display.scaleX=-.5)},e}(GC_Ele_BaseView);__reflect(GC_CharacterView.prototype,"GC_CharacterView");var GC_BossRoomView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_RoomView);__reflect(GC_BossRoomView.prototype,"GC_BossRoomView");var GP_ActorManager=function(t){function e(){var e=t.call(this)||this;return e._frame_cursor=0,e._actors=new Array,e}return __extends(e,t),e.prototype._before_destroy=function(){if(this._actors){for(var t=this._actors.length,e=0;t>e;e++)this._actors[e].destroy();this._actors=null}this._gc.stage.removeEventListener(egret.Event.ENTER_FRAME,this._gc_update,this),this._gc=null},e.prototype.manager_init=function(t){this._gc=t,this._gc.stage.addEventListener(egret.Event.ENTER_FRAME,this._gc_update,this)},e.prototype._gc_update=function(t){this._gc._machine.get_current_state_enum()==MWN_GM_State_Enum.RUNNING&&(0==this._frame_cursor?(this._round_start(),this._frame_update(this._frame_cursor),this._frame_cursor++):this._frame_cursor>=e.round_frame_count?(this._frame_update(this._frame_cursor),this._round_end(),this._frame_cursor=0):(this._frame_update(this._frame_cursor),this._frame_cursor++))},e.prototype._born_pawn=function(){var t=this._gc._game_core_view.debug_born_pawn(),e=new GamePawnEntity;e.character_init(),e.bind_view(t),this._actors.push(e)},e.prototype._round_start=function(){var t=this._actors.length;if(30>t)for(var e=0;10>e;e++)this._born_pawn();t=this._actors.length;for(var e=0;t>e;e++)this._actors[e].round_start()},e.prototype._round_end=function(){for(var t=this._actors.length,e=0;t>e;e++)this._actors[e].round_end();for(var i=new Array,e=0;t>e;e++){var o=this._actors[e];o.is_dead?o.destroy():i.push(o)}this._actors=i},e.prototype._frame_update=function(t){for(var e=this._actors.length,i=0;e>i;i++)this._actors[i].frame_update(t)},e.round_frame_count=30,e}(ns_sirius.sirius_base_object);__reflect(GP_ActorManager.prototype,"GP_ActorManager");var GC_BossSlotView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_Ele_BaseView);__reflect(GC_BossSlotView.prototype,"GC_BossSlotView");var GC_SlotView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(GC_Ele_BaseView);__reflect(GC_SlotView.prototype,"GC_SlotView");var AnimRes=function(){function t(t,e,i,o,_,r,s){void 0===t&&(t=0),void 0===e&&(e=""),void 0===i&&(i=""),void 0===o&&(o=""),void 0===_&&(_=""),void 0===r&&(r=""),void 0===s&&(s=""),this.res_id=t,this.res_data_key=e,this.path_ske=i,this.path_tex_config=o,this.path_tex_img=_,this.armature_name=r,this.character_name=s}return t}();__reflect(AnimRes.prototype,"AnimRes");var CriticalResLoader=function(){function t(){var t=new Array;this._resources=t,t.push(new AnimRes(1,"map","resource/game_core/canvas_mesh/canvas_mesh_ske.json","resource/game_core/canvas_mesh/canvas_mesh_tex.json","resource/game_core/canvas_mesh/canvas_mesh_tex.png","",""))}return t.prototype.load_res=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o=this;return __generator(this,function(_){for(this._load_count=this._resources.length,t=0,e=this._resources;t<e.length;t++)i=e[t],this._load_ske_res(i);return[2,new Promise(function(t,e){o._cb_s=t,o._cb_f=e})]})})},t.prototype._load_ske_res=function(t){var e=this;RES.getResByUrl(t.path_ske,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this;RES.getResByUrl(t.path_tex_config,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this;RES.getResByUrl(t.path_tex_img,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&(console.log("ALL loaded"),this._cb_s())},t.prototype.find_res_by_name=function(t){return this._resources[0]},t}();__reflect(CriticalResLoader.prototype,"CriticalResLoader");var GameCoreResManager=function(){function t(){var t=new Array;this._resources=t,t.push(new AnimRes(1,"role1","resource/game_core/characters/role_01/role_01_ske.json","resource/game_core/characters/role_01/role_01_tex.json","resource/game_core/characters/role_01/role_01_tex.png","Armature","角色01")),t.push(new AnimRes(2,"role2","resource/game_core/characters/role_02/role_02_ske.json","resource/game_core/characters/role_02/role_02_tex.json","resource/game_core/characters/role_02/role_02_tex.png","Armature","角色02")),t.push(new AnimRes(3,"role3","resource/game_core/characters/role_03/role_03_ske.json","resource/game_core/characters/role_03/role_03_tex.json","resource/game_core/characters/role_03/role_03_tex.png","Armature","角色3")),t.push(new AnimRes(4,"role4","resource/game_core/characters/skull/skull_ske.json","resource/game_core/characters/skull/skull_tex.json","resource/game_core/characters/skull/skull_tex.png","Armature","skull"))}return t.prototype.load_res=function(){this._load_count=this._resources.length;for(var t=0,e=this._resources;t<e.length;t++){var i=e[t];this._load_ske_res(i)}},t.prototype._load_ske_res=function(t){var e=this;RES.getResByUrl(t.path_ske,function(i,o){t.data_ske=i,e._load_tex_config_res(t)},this,null)},t.prototype._load_tex_config_res=function(t){var e=this;RES.getResByUrl(t.path_tex_config,function(i,o){t.data_tex_config=i,e._load_tex_img_res(t)},this,null)},t.prototype._load_tex_img_res=function(t){var e=this;RES.getResByUrl(t.path_tex_img,function(i,o){t.data_tex_img=i,e._one_res_loaded(t)},this,null)},t.prototype._one_res_loaded=function(t){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(t.data_ske),e.parseTextureAtlasData(t.data_tex_config,t.data_tex_img),this._load_count--,this._load_count<=0&&gp_core.start_game()},t}();__reflect(GameCoreResManager.prototype,"GameCoreResManager");var AppModuleViewBase=function(t){function e(){var e=t.call(this)||this;return e.set_bg_color(0,.4),e}return __extends(e,t),e.prototype.attached_to_display_tree=function(t){},e.prototype._view_before_init=function(){},e.prototype._view_start_init=function(){},e.prototype.detaching_from_display_tree=function(t){void 0===t&&(t=null)},e.prototype._view_before_destroy=function(){},e}(ns_sirius.module_view_base);__reflect(AppModuleViewBase.prototype,"AppModuleViewBase");var AppModuleVMBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._vm_before_init=function(){},e.prototype._vm_start_init=function(){},e.prototype._vm_before_destroy=function(){},e}(ns_sirius.module_vm_base);__reflect(AppModuleVMBase.prototype,"AppModuleVMBase");var GameCorePanHandler=function(t){function e(){var e=t.call(this)||this;return e._scale_is_anim=!1,e._anim_count=20,e._anim_cursor=0,e._start_ox=0,e._start_mouse_x=0,e._start_oy=0,e._start_mouse_y=0,e}return __extends(e,t),e.prototype.core_init=function(t,e){this._gc=t,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouse_down,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouse_move,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.mouse_up,this),e.addEventListener(egret.Event.ENTER_FRAME,this._handle_update,this)},e.prototype.swap_anim=function(){this._scale_is_anim||(this._anim_cursor=0,this._gc.layout_config.horizontal_fixed=!this._gc.layout_config.horizontal_fixed,this._start_scale=this._gc.ppc._shader_last_scale,this._end_scale=this._gc.layout_config.horizontal_fixed?.7:1,this._scale_step=this._end_scale-this._start_scale,this._start_offset_x=this._gc.ppc._shader_offset_x,this._gc.ppc._shader_offset_x=0,this._end_offset_x=0,this._offsetx_step=this._end_offset_x-this._start_offset_x,this._scale_is_anim=!0)},e.prototype._handle_update=function(t){if(this._scale_is_anim){var e=1e3*this._anim_cursor/this._anim_count/1e3,i=this._start_scale+e*this._scale_step,o=this._start_offset_x+e*this._offsetx_step;this._gc.ppc._shader_offset_x=o,this._gc.ppc._shader_last_scale=i,this._gc.ci_perspective_needs_update(),this._anim_cursor++,this._anim_cursor>=this._anim_count&&(this._scale_is_anim=!1)}},e.prototype.mouse_down=function(t){this._scale_is_anim||(this._start_mouse_x=t.stageX,this._start_ox=this._gc.ppc._shader_offset_x,this._start_mouse_y=t.stageY,this._start_oy=this._gc.ppc._shader_offset_y)},e.prototype.mouse_move=function(t){this._scale_is_anim||(this._move_x(t),this._move_y(t),this._gc.ci_perspective_needs_update())},e.prototype._move_x=function(t){if(this._gc.layout_config.horizontal_fixed)return void(this._gc.ppc._shader_offset_x=0);var e=t.stageX-this._start_mouse_x,i=this._start_ox+.003*e;i>gp_core.layout_config.shader_offset_x_max?i=gp_core.layout_config.shader_offset_x_max:i<gp_core.layout_config.shader_offset_x_min&&(i=gp_core.layout_config.shader_offset_x_min),this._gc.ppc._shader_offset_x=i},e.prototype._move_y=function(t){var e=t.stageY-this._start_mouse_y,i=this._start_oy-.004*e;i>gp_core.layout_config.shader_offset_y_max?i=gp_core.layout_config.shader_offset_y_max:i<gp_core.layout_config.shader_offset_y_min&&(i=gp_core.layout_config.shader_offset_y_min),this._gc.ppc._shader_offset_y=i},e.prototype.mouse_up=function(t){},e}(egret.HashObject);__reflect(GameCorePanHandler.prototype,"GameCorePanHandler");var PerspectiveCore=function(){function t(){this.buffer_point_2d_glboal=new egret.Point,this.buffer_point_3d_glboal=new egret.Point,this._shader_offset_x=0,this._shader_offset_y=0,this._shader_last_scale=1}return t.prototype.core_init=function(t,e){this._stage=t,this._ref_view=e},t.prototype.convert_2_to_3_global=function(t,e,i){var o=.2,_=.5,r=this._stage.stageWidth,s=this._stage.stageHeight,n=2*t.x/r-1,a=2*-t.y/s+1,c=n*this._shader_last_scale,u=a*this._shader_last_scale+this._shader_last_scale-1,h=.5*(u+1)*o+.1*this._shader_offset_y,l=c+this._shader_offset_x,p=u+this._shader_offset_y,f=l*_/(h+_),d=p*_/(h+_);i.x=this._shader_last_scale*_/(h+_),i.y=i.x,e.x=(f+1)*r*.5,e.y=-(d-1)*s*.5},t.prototype.cal_3d_pos=function(t,e,i){this._ref_view.localToGlobal(t.x,t.y,this.buffer_point_2d_glboal),this.convert_2_to_3_global(this.buffer_point_2d_glboal,this.buffer_point_3d_glboal,i),this._ref_view.globalToLocal(this.buffer_point_3d_glboal.x,this.buffer_point_3d_glboal.y,e)},t}();__reflect(PerspectiveCore.prototype,"PerspectiveCore");var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.mm=new t.module_marshal,i.layes=new t.layer_partition,i.sirius_public=new t.SiriusPublic,i}return __extends(i,e),i.prototype.core_init=function(){this.mm.core_init(this),this.layes.core_init(this),this.sirius_public.core_init(this)},i}(t.sirius_base_object);t.SiriusCore=e,__reflect(e.prototype,"ns_sirius.SiriusCore")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.view_manager=new t.app_vh_manager,i.device_info=new t.sirius_device_info,i}return __extends(i,e),i.prototype.core_init=function(t){this._sirius=t,this.view_manager.core_init(t)},i.prototype.debug_foo=function(){this.view_manager.show_popup_text_msg("You are connected to the sirius hierarchy.")},i}(t.sirius_element_module);t.SiriusPublic=e,__reflect(e.prototype,"ns_sirius.SiriusPublic")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.design_width=640,e.design_height=1136,e.stage_width=0,e.stage_height=0,e.safe_width=0,e.safe_height=0,e.initial_optimal_w=0,e}return __extends(e,t),e.prototype.device_info_init=function(){var t=Math.ceil(1125*this.design_height/2436);this.stage_width>=this.design_width?this.initial_optimal_w=this.design_width:this.initial_optimal_w=t},e.prototype.syn_stage_size=function(t,e){this.stage_width=t,this.stage_height=e,this.safe_height=e,this.safe_width=t>this.design_width?this.design_width:t},e}(t.sirius_base_object);t.sirius_device_info=e,__reflect(e.prototype,"ns_sirius.sirius_device_info")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.after_state_init=function(){},e.prototype.state_enum=function(){return 0},e.prototype.state_str=function(){return"Default"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(t.GP_StateBase);t.GP_State_Default=e,__reflect(e.prototype,"ns_sirius.GP_State_Default")}(ns_sirius||(ns_sirius={}));var MWN_GM_State_Enum=function(){function t(){}return t.DEFAULT=0,t.IDLE=1,t.PREPARE=2,t.RUNNING=3,t.END=5,t}();__reflect(MWN_GM_State_Enum.prototype,"MWN_GM_State_Enum");var MWN_machine=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._before_destroy=function(){this._s_idle&&(this._s_idle.destroy(),this._s_idle=null),this._s_prepare&&(this._s_prepare.destroy(),this._s_prepare=null),this._s_running&&(this._s_running.destroy(),this._s_running=null),this._s_end&&(this._s_end.destroy(),this._s_end=null)},e.prototype._states_init=function(t){this._s_idle=new GP_State_IDLE,this._s_idle.state_init(this,t),this._s_prepare=new GP_State_PREPARE,this._s_prepare.state_init(this,t),this._s_running=new GP_State_RUNNING,this._s_running.state_init(this,t),this._s_end=new GP_State_END,this._s_end.state_init(this,t)},e.prototype.get_state_by_enum=function(t){switch(t){case MWN_GM_State_Enum.IDLE:return this._s_idle;case MWN_GM_State_Enum.PREPARE:return this._s_prepare;case MWN_GM_State_Enum.RUNNING:return this._s_running;case MWN_GM_State_Enum.END:return this._s_end;default:return this._s_default}},e}(ns_sirius.GP_StateMachine);__reflect(MWN_machine.prototype,"MWN_machine");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var _=RES.getRes(t);_?o(_):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.establish_reflection_table(),e}return __extends(e,t),e.prototype.establish_reflection_table=function(){},e.prototype.register_sm=function(t){this._sm=t},e.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null);var _=this._find_module_by_name(t);if(!_)return void console.error("不存在模块 ： "+t);var r=new _.vm,s=new _.view;this._sm.show_module(s,r,e,i,o)},e.prototype._find_module_by_name=function(t){if(!this._rtable)return null;for(var e=this._rtable.length,i=0;e>i;i++){var o=this._rtable[i];if(o.module_name==t)return o}return null},e}(t.sirius_element_module);t.module_marshal=e,__reflect(e.prototype,"ns_sirius.module_marshal")}(ns_sirius||(ns_sirius={}));var GP_State_END=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.END},e.prototype.state_str=function(){return"END"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_end()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e.prototype.state_running=function(t,e){void 0===e&&(e=null),this._machine.state_change(MWN_GM_State_Enum.IDLE)},e}(MWN_State_Base);__reflect(GP_State_END.prototype,"GP_State_END");var GP_State_IDLE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.IDLE},e.prototype.state_str=function(){return"IDLE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null)
},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_IDLE.prototype,"GP_State_IDLE");var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e}return __extends(e,t),e}(t.sirius_view_base);t.sirius_root_layer=e,__reflect(e.prototype,"ns_sirius.sirius_root_layer");var i=function(i){function o(){return i.call(this)||this}return __extends(o,i),o.prototype.view_hierarchy_establish=function(e){this._app_root_view=e;var i=t.app_layer_def,o=i.length;this.sms=new Array(o);for(var _=0;o>_;_++){var r=i[_],s=this._create_layer_by_def(r);this.sms[_]=s}},o.prototype._create_layer_by_def=function(i){var o=new e;this._app_root_view.addChild(o),o.update_visible(!1),i.disable_touch&&(o.touchEnabled=!1);var _=null;return _=i.exclusive?new t.layer_exclusive_manager:1==i.sm_type?new t.layer_module_sm:new t.layer_stack_manager,_.manager_init(o,i.lid,this._sirius),_},o}(t.sirius_element_module);t.layer_partition=i,__reflect(i.prototype,"ns_sirius.layer_partition")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._is_visible=!1,e}return __extends(e,t),e.prototype.manager_init=function(t,e,i){this._root_view=t,this.layer_id=e,this._sirius=i},e.prototype.get_root_view=function(){return this._root_view},e.prototype.attach_target_view=function(t){this._target_view=t},e.prototype.show=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),this._is_visible=!0,this._root_view.addChild(this._target_view),this._target_view.attached_to_display_tree(t),this._update_container_visible(),this._target_view},e.prototype.hide=function(){this._is_visible=!1,this._target_view.detaching_from_display_tree(),this._target_view.remove_from_parent(),this._update_container_visible()},e.prototype.clear_all=function(){this.hide()},e.prototype._update_container_visible=function(){this._root_view.update_visible(this._is_visible)},e}(t.sirius_base_object);t.layer_exclusive_manager=e,__reflect(e.prototype,"ns_sirius.layer_exclusive_manager",["ns_sirius.Isirius_layer_manager"])}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show_module=function(t,e,i,o,_){return void 0===i&&(i=null),void 0===o&&(o=null),void 0===_&&(_=null),this._root_view.addChild(t),t.attached_to_display_tree(i),e.vm_pre_init(o,t,this._sirius),t.view_pre_init(i,e,this._sirius),t.view_init(),e.vm_init(),this._s_push(e),this._update_container_visible(),t},e.prototype.clear_all=function(){if(!this._s_is_empty()){for(var t=0;t<=this._top;t++){var e=this._mstack[t],i=e.pair_view;i.detaching_from_display_tree(),i.destroy(),e.destroy()}this._s_clear(),this._update_container_visible()}},e.prototype.pop_top=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_top(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_pop(),this._update_container_visible()},e.prototype.shift_first=function(){if(this._s_is_empty())return void console.log("视图栈已经为空了");var t=this._s_bottom(),e=t.pair_view;e.detaching_from_display_tree(),e.destroy(),t.destroy(),this._s_shift(),this._update_container_visible()},e}(t.layer_stack_manager);t.layer_module_sm=e,__reflect(e.prototype,"ns_sirius.layer_module_sm")}(ns_sirius||(ns_sirius={}));var GP_State_PREPARE=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.PREPARE},e.prototype.state_str=function(){return"PREPARE"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_prepare()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_PREPARE.prototype,"GP_State_PREPARE");var GP_State_RUNNING=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._after_state_init=function(){},e.prototype.state_enum=function(){return MWN_GM_State_Enum.RUNNING},e.prototype.state_str=function(){return"RUNNING"},e.prototype.state_enter=function(t,e){void 0===e&&(e=null),this._gpcore._sm_running()},e.prototype.state_leave=function(t,e){void 0===e&&(e=null)},e}(MWN_State_Base);__reflect(GP_State_RUNNING.prototype,"GP_State_RUNNING");var ns_sirius;!function(t){t.sirius_network_consts={protocol:"http",host_address:"10.0.2.158:8080"}}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(){function t(t){void 0===t&&(t=!0),this.should_parse_json=t}return t}();t.common_req_param=e,__reflect(e.prototype,"ns_sirius.common_req_param");var i=function(i){function o(t){void 0===t&&(t=null);var o=i.call(this)||this;return o._req_param=null,t?o._req_param=t:o._req_param=new e,o}return __extends(o,i),o.prototype._before_destroy=function(){this._req_param=null,this._cb_s=null,this._cb_f=null},o.prototype._handle_fail=function(t){this._cb_f&&this._cb_f(t),this.destroy()},o.prototype._handle_success=function(t){this._cb_s&&this._cb_s(t),this.destroy()},o.prototype.generate_expire=function(){this._expire_dis=new t.DelayDispatcher,this._expire_dis.dispatch(2e4,this,this.handle_req_expired)},o.prototype.handle_req_expired=function(){this._handle_fail("expire")},o.prototype.clear_expire=function(){this._expire_dis&&(this._expire_dis.destroy(),this._expire_dis=null)},o.prototype._combine_url=function(e){var i=t.sirius_network_consts.protocol+"://"+t.sirius_network_consts.host_address+"/"+e;return i},o.prototype.get=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t?(this._url_str=this._combine_url(t),[2,new Promise(function(t,i){e._cb_s=t,e._cb_f=i,e._send_get(e._url_str)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype.post=function(t,e){return void 0===e&&(e=void 0),__awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){return t?(this._url_str=this._combine_url(t),[2,new Promise(function(t,o){i._cb_s=t,i._cb_f=o,i._send_post(i._url_str,e)})]):[2,new Promise(function(t,e){e("url_error")})]})})},o.prototype._send_get=function(t){this.generate_expire();var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.open(t,egret.HttpMethod.GET),e.send(),e.addEventListener(egret.Event.COMPLETE,this.comp,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype._send_post=function(t,e){this.generate_expire();var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(t,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json"),e?i.send(e):i.send(),i.addEventListener(egret.Event.COMPLETE,this.comp,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.fail,this)},o.prototype.comp=function(t){this.clear_expire();var e=(this._url_str,t.currentTarget),i=e.response;if(this._req_param.should_parse_json){var o=JSON.parse(i);this._handle_success(o)}else this._handle_success(i)},o.prototype.fail=function(t){this.clear_expire();var e=t.currentTarget,i=e.response;this._handle_fail(i)},o}(t.sirius_base_object);t.common_req=i,__reflect(i.prototype,"ns_sirius.common_req")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mark_as_fullfill(),e.set_bg_color(0,.4),e._icon=new eui.Image,e.addChild(e._icon),e._icon.horizontalCenter=0,e._icon.verticalCenter=0,e._icon.width=100,e._icon.height=100,e._icon.source="loading_icon_png",e._icon.rotation,e}return __extends(e,t),e.prototype.start_anim=function(){egret.Tween.get(this._icon,{loop:!0}).to({rotation:360},5e3)},e.prototype.stop_anim=function(){egret.Tween.removeTweens(this._icon)},e}(t.sirius_view_base);t.sirius_default_loading_view=e,__reflect(e.prototype,"ns_sirius.sirius_default_loading_view")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.set_bg_color(0,.4);return i.ellipseWidth=40,i.ellipseHeight=40,e.left=20,e.right=20,e.height=40,e.verticalCenter=100,e._txt=new eui.Label,e.addChild(e._txt),e._txt.textColor=16777215,e._txt.left=10,e._txt.right=10,e._txt.size=26,e._txt.percentHeight=100,e._txt.textAlign=egret.HorizontalAlign.CENTER,e._txt.verticalAlign=egret.VerticalAlign.MIDDLE,e}return __extends(e,t),e.prototype.show=function(t){this._txt.text=t,egret.Tween.get(this).to({verticalCenter:0},2e3,egret.Ease.cubicOut).to({alpha:0},1e3,egret.Ease.cubicOut)},e}(t.sirius_view_base);t.popup_text_msg=e,__reflect(e.prototype,"ns_sirius.popup_text_msg")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.view_hierarchy_establish=function(e){this._sirius.layes.view_hierarchy_establish(e),this._module_sm=this._sirius.layes.sms[0],this._alert_sm=this._sirius.layes.sms[1],this._fs_cover_sm=this._sirius.layes.sms[2],this._message_sm=this._sirius.layes.sms[3],this._loading_sm=this._sirius.layes.sms[4],this._global_loading_view=new t.sirius_default_loading_view,this._loading_sm.attach_target_view(this._global_loading_view),this._sirius.mm.register_sm(this._module_sm)},i.prototype.switch_global_loading=function(t){t?(this._global_loading_view.start_anim(),this._loading_sm.show()):(this._global_loading_view.stop_anim(),this._loading_sm.hide())},i.prototype.show_popup_text_msg=function(e){var i=this,o=new t.popup_text_msg;this._message_sm.show_view(o),o.show(e),setTimeout(function(){i._message_sm.shift_first()},3500)},i.prototype.show_module=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null),this._sirius.mm.show_module(t,e,i,o)},i.prototype.pop_top_module=function(){this._module_sm.pop_top()},i}(t.sirius_element_module);t.app_vh_manager=e,__reflect(e.prototype,"ns_sirius.app_vh_manager")}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){t.app_layer_def=[{lid:"modules",index:0,exclusive:!1,sm_type:1},{lid:"alert_panel",index:1,exclusive:!1,sm_type:0},{lid:"fullscreen_cover",index:2,exclusive:!1,sm_type:0},{lid:"messages",index:3,exclusive:!1,sm_type:0,disable_touch:!0},{lid:"loading",index:4,exclusive:!0}]}(ns_sirius||(ns_sirius={}));var ns_sirius;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.ddid=0,e}return __extends(e,t),e.prototype._before_destroy=function(){this._target=null,this._fun=null,this._param=null},e.prototype.dispatch=function(t,e,i,o){var _=this;void 0===o&&(o=null),this._is_destroyed=!1,this._delay_time=t,this._target=e,this._fun=i,this._param=o,setTimeout(function(){_.execute_fun()},t)},e.prototype.execute_fun=function(){this._is_destroyed||this._target&&this._fun&&(this._fun.apply(this._target,this._param),this.destroy())},e}(t.sirius_base_object);t.DelayDispatcher=e,__reflect(e.prototype,"ns_sirius.DelayDispatcher")}(ns_sirius||(ns_sirius={}));var LocalizationManager=function(){function t(){}return t.prototype.choose_language=function(t){this.lan_key=t,"en"===this.lan_key?(this.COMMON=ui_local_common_en,this.LK=ui_local_lk_en,this.YXY=ui_local_yxy_en,this.ZL=ui_local_zl_en):"cn"===this.lan_key&&(this.COMMON=ui_local_common_cn,this.LK=ui_local_lk_cn,this.YXY=ui_local_yxy_cn,this.ZL=ui_local_zl_cn)},t.prototype.s=function(t,e,i){return void 0===i&&(i="COMMON"),this[i][t][e]},t.prototype.s1=function(t,e,i,o){void 0===o&&(o="COMMON");var _=this[o][t][e],r=_.replace("@{0}",i);return r},t.prototype.sn=function(t,e,i,o){void 0===o&&(o="COMMON");for(var _=this[o][t][e],r=_,s=i.length,n=0;s>n;n++)r=r.replace("@{"+n+"}",i[n]);return r},t}();__reflect(LocalizationManager.prototype,"LocalizationManager");var ui_local_common_cn={global:{confirm:"confirm!",xixi:"DARK"}},ui_local_lk_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"}},ui_local_yxy_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"}},ui_local_zl_cn={test:{haha:"钢铁侠托尼·史塔克只是一个有血有肉的人，\n        而他的盔甲让他成为了钢铁侠。",xixi:"王小明"}},ui_local_common_en={test:{haha:"Sissinghurst Castle Garden, \n        at Sissinghurst in the Weald of Kent in England, \n        was created by Vita Sackville-West, \n        poet and writer, \n        and her husband Harold Nicolson",xixi:"DARK"}},ui_local_lk_en={test:{haha:"Sissinghurst Castle Garden, \n        at Sissinghurst in the Weald of Kent in England, \n        was created by Vita Sackville-West, \n        poet and writer, \n        and her husband Harold Nicolson",xixi:"DARK"}},ui_local_yxy_en={},ui_local_zl_en={};